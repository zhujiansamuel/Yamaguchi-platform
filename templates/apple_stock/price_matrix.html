<!doctype html>
<html lang="ja">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    {#    <script src="https://cdn.jsdelivr.net/npm/twitter-api-v1@1.3.0/lib/index.min.js"></script>#}
    <script src="https://cdn.jsdelivr.net/npm/twitter-v1-oauth@1.0.15/lib/helpers.min.js"></script>
    <title>iPhone17 買取相場 – 統合テンプレート（店舗列付き）</title>
    <style>
        .nodata {
            background: #ffffff !important;
            color: #000000 !important;
            font-weight: 200;
        }

        :root {
            --bg: #ffffff;
            --card: #ffffff;
            --grid-border: #d9deea;
            --header-bg: #ff9900;
            --text: #1f2430;
            --muted: #6b7380;
            --positive: #0f9d58;
            --negative: #d93025;
            --gap: -1px;

            --row-h: 22px; /* 行高（包含内容区高度） */
            --cell-px: 8px; /* 水平内边距 */
            --cell-py: 4px; /* 垂直内边距；若想严格固定行高，可设为 0 */
            --col-model-w: 140px;
            --col-capacity-w: 100px;
            --col-color-w: 120px;
            --col-num-w: 120px;
            --col-shop-w: 120px;
            --all-cell-font: 15px;/* ALL行字体大小 */
            --table-font-front: 16px; /* 表格大字字体大小 */
            --table-font: 12px; /* 表格小字 */
            --table-font-name:20px ;
            --num-head-font-size: 15px;
        }

        .front-num {
            font-size: var(--table-font-front);
        }

        .front-name{
            font-size: var(--table-font-name);
        }


        body {
            font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", "PingFang SC", "Hiragino Sans", "Noto Sans CJK JP", Roboto, Arial;
            margin: 16px;
        }

        .wrap {
            margin: 3px 3px;
            margin-inline: auto; /* 等价于左右 auto，现代语法 */
            box-sizing: border-box;

        }

        fieldset {
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 12px;
        }

        legend {
            padding: 0 6px;
            color: #111827;
            font-weight: 600;
        }

        label {
            font-size: 10px;
            color: #374151;
            display: block;
            margin-bottom: 6px;
        }

        * {
            box-sizing: border-box;
        }

        .card {
            background: var(--card);
            border: 1px solid var(--grid-border);
            border-radius: 8px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, .05);
            margin: 30px auto;
            padding: 20px;
            overflow-x: auto;
        }

        .model-section {
            margin-bottom: -15px;
        }

        .model-header {
            background: var(--header-bg);
            padding: 10px 12px;
            font-weight: bold;
            border-bottom: 1px solid var(--grid-border);
        }

        table {
            width: 200px;
            border-collapse: collapse;
            table-layout: fixed;
        }

        th, td {
            height: var(--row-h); /* 固定行高 */
            line-height: calc(var(--row-h) - 2px); /* 粗略抵消边框高度；更严谨可把 cell-py 设为 0 */
            border: 1px solid var(--grid-border);
            padding: 6px 8px;
            text-align: right;
            text-overflow: ellipsis;
            font-size: var(--table-font);
            font-weight: 700;

        }


        .all-price {
            font-weight: 700;
            font-size: var(--all-cell-font);
        }

        .marge {

        }

        th {
            background: var(--header-bg);
            text-align: center;
            height: var(--row-h);
            line-height: calc(var(--row-h) - 1px);
            vertical-align: middle; /* 垂直居中 */
            align-items: center; /* 垂直居中 */
        }

        .row3 {
            display: grid;
            grid-template-columns: 1.2fr .9fr .9fr;
            gap: 10px;
        }

        .row4 {
            display: grid;
            grid-template-columns: .2fr .4fr .4fr .6fr;
            gap: 10px;
            max-width: 1500px;
        }

        label {
            font-size: 13px;
            color: #374151;
            display: block;
            margin-bottom: 6px;
        }

        input[type="text"], input[type="datetime-local"] {
            width: 80%;
            padding: 8px 10px;
            border-radius: 10px;
            border: 1px solid #d1d5db;
            outline: none;
        }

        input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, .15);
        }

        .btns {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }

        button {
            border: 0;
            padding: 9px 12px;
            border-radius: 10px;
            cursor: pointer;
            background: #111827;
            color: #fff;
        }

        button.secondary {
            background: #374151;
        }


        .col-model {
            width: 130px;
            text-align: center;

        }

        .col-capacity {
            width: 65px;
            text-align: center;
        }

        .col-color {
            width: 65px;
            text-align: center;
        }

        .col-num {
            width: 80px;
            text-align: center;
        }

        .shop-col {
            width: 90px;
            text-align: center;
            vertical-align: middle; /* 垂直居中 */
            align-items: center; /* 垂直居中 */
        }


        .diff.pos {
            color: var(--positive);
            font-weight: bold;
        }

        .diff.neg {
            color: var(--negative);
            font-weight: bold;
        }

        #shops {
            display: grid;
            grid-template-columns: repeat(8, minmax(0, 1fr));
            gap: 6px 10px;
            max-height: 180px;
            overflow: auto;
        }
        .num-head{
            color: #fff;
            font-size: var(--num-head-font-size);
        }


        /* 店舗ヘッダーの色（白文字）*/
        .shop-head {
            color: #fff;
            background: #351c75;
            font-weight: 500;
            line-height: 0.9; /* 行间距更紧凑，可在 1.0~1.2 间微调 */
            font-size: 14px;
        }

        .text-all{
            font-size: 15px;
        }

        .shop-time {
            font-size: 9px;
        }

        .shop-date {
            font-size: 7px;
        }

        .shop-買取商店 {
            background: #351c75
        }

        .shop-海峡通信 {
            background: #351c75
        }

        .shop-買取１丁目 {
            background: #351c75
        }

        .shop-モバイルミックス {
            background: #351c75
        }

        .shop-森森買取 {
            background: #351c75
        }

        .shop-買取ルデヤ {
            background: #351c75
        }

        .shop-買取Wiki {
            background: #351c75
        }

        .shop-買取ホムラ {
            background: #351c75
        }

        .shop-トゥインクル {
            background: #351c75
        }

        .shop-家電市場 {
            background: #351c75;
        }

        .shop-買取楽園 {
            background: #351c75
        }

        .shop-買取当番 {
            background: #351c75
        }

        .shop-携帯空間 {
            background: #351c75
        }

        .shop-ゲストモバイル {
            background: #351c75
        }

        .shop-買取オク {
            background: #351c75
        }

        .shop-毎日買取 {
            background: #351c75
        }

        .shop-MobileZone {
            background: #351c75
        }

        /* 旧名や表記ゆれ対策（末尾ハイフン表記にも色を適用）*/
        .shop-ドラゴンモバイル- {
            background: #351c75
        }

        .shop-モバステ- {
            background: #351c75
        }

        .shop-アキモバ- {
            background: #351c75
        }

        .is-hidden {
            display: none !important;
        }

        .c {
            height: 1px !important;
            padding: 0 !important;
        }

        .dc {
            border: 0 !important;
        }

        /* thead 高さ0指定 */
        table thead.thead-zero,
        table thead.thead-zero tr,
        table thead.thead-zero th,
        table thead[style*="height:0"],
        table thead[style*="height:0"] tr,
        table thead[style*="height:0"] th {
            height: 0 !important;
            padding: 0 !important;
            border: 0 !important;
            line-height: 0 !important;
            font-size: 0 !important;
            overflow: hidden !important;
            visibility: collapse !important;
        }

        table thead.thead-zero th::before,
        table thead[style*="height:0"] th::before {
            content: "";
            display: block;
            width: 100%;
            height: 0;
        }


    </style>
</head>
<body>

<div class="wrap">
    <fieldset>
        <legend>選択条件</legend>
        <div class="row4">
            <div>
                <label>時間（JST）</label>
            </div>
            <div>
                <input id="start" type="datetime-local" step="60">
            </div>
            <div>
                <button class="ghost" id="pick-time" type="button">選択時刻</button>
                <button class="ghost" id="latest" type="button">最新</button>
            </div>
            <div>

                <button class="ghost" id="clear-" type="button">画像保存</button>
                <button class="ghost" id="clear-a" type="button">Xへ公開</button>
            </div>
        </div>

        <legend>選択条件</legend>

        <div style="margin-top:10px">
            <label>店舗</label>
            <div id="shops"></div>
            <div class="btns" style="margin-top:8px">
                <button class="ghost" id="select-all-btn" type="button">すべて選択</button>
                <button class="ghost" id="clear-all-btn" type="button">すべて解除</button>
            </div>

            <div class="btns" style="margin-top:8px">
                <div>
                    <button class="ghost" id="do-not-display" type="button">非表示</button>
                    <button class="ghost" id="display-again" type="button">再表示</button>
                    <button class="ghost" id="replace-text" type="button">置換文字</button>
                    <button class="ghost" id="display-text" type="button">元文字</button>
                </div>
            </div>
        </div>
    </fieldset>

</div>


<div class="card">
    <h4 style="margin:1px 24px">iPhone17 買取相場 – 統合テンプレート</h4>
    <h4 id="main-title" style="margin:-1px 24px">iPhone17 買取相場20251006</h4>
    <h4 id="updated-at" style="margin:-1px 24px">更新日時：2025/10/6 13時00分</h4>

    <!-- ================= iPhone 17 Pro Max ================= -->
    <div class="model-section">
        <!--       <div class="model-header">iPhone 17 Pro Max</div> -->
        <table>
            <thead>
            <tr>
                <th class="col-model num-head">機種</th>
                <th class="col-capacity num-head">容量</th>
                <th class="col-num num-head">定価</th>
                <th class="col-num num-head">最高</th>
                <th class="col-num num-head">差額</th>
                <th class="col-num num-head">利益</th>
                <th class="col-num num-head">前日比</th>
                <th class="col-num num-head is-hidden">平均値</th>
                <th class="col-color num-head">カラー</th>
                <!-- Stores -->
                <th class="shop-col shop-head shop-買取商店">買取商店
{#                    <p class="shop-time">営業時間</p>#}
{#                    <p class="shop-time">11:00~18:00</p>#}
{#                    <p class="shop-date">(月火水木金　　　)</p>#}
                </th>


                <th class="shop-col shop-head shop-海峡通信">海峡通信
{#                    <p class="shop-time">営業時間</p>#}
{#                    <p class="shop-time">10:00~19:00</p>#}
{#                    <p class="shop-date">(月火水木金土日祝)</p>#}
                </th>
                <th class="shop-col shop-head shop-買取１丁目">買取<br>一丁目
{#                    <p class="shop-time">営業時間</p>#}
{#                    <p class="shop-time">10:00~19:00</p>#}
{#                    <p class="shop-date">(月火水木金土　　)</p>#}
                </th>
                <th class="shop-col shop-head shop-モバイルミックス">モバイル<br>ミックス
{#                    <p class="shop-time">営業時間</p>#}
{#                    <p class="shop-time">11:00~19:00</p>#}
{#                    <p class="shop-date">(月火水木金土　　)</p>#}
                </th>
                <th class="shop-col shop-head shop-森森買取">森森買取
{#                    <p class="shop-time">営業時間</p>#}
{#                    <p class="shop-time">11:00~20:00</p>#}
{#                    <p class="shop-date">(月火水木金土日祝)</p>#}
                </th>
                <th class="shop-col shop-head shop-買取ルデヤ">買取<br>ルデヤ
{#                    <p class="shop-time">営業時間</p>#}
{#                    <p class="shop-time">11:00~19:00</p>#}
{#                    <p class="shop-date">(月火水木金土　　)</p>#}
                </th>
                <th class="shop-col shop-head shop-買取Wiki">買取<br>Wiki
{#                    <p class="shop-time">営業時間</p>#}
{#                    <p class="shop-time">10:30~19:30</p>#}
{#                    <p class="shop-date">(月火水木金土日祝)</p>#}
                </th>
                <th class="shop-col shop-head shop-買取ホムラ">買取<br>ホムラ
{#                    <p class="shop-time">営業時間</p>#}
{#                    <p class="shop-time">11:00~19:00</p>#}
{#                    <p class="shop-date">(月火水木金土日祝)</p>#}
                </th>
                <th class="shop-col shop-head shop-ドラゴンモバイル-">ドラゴン<br>モバイル
{#                    <p class="shop-time">営業時間</p>#}
{#                    <p class="shop-time">11:00~19:30</p>#}
{#                    <p class="shop-date">(月火水木金土　　)</p>#}
                </th>
                <th class="shop-col shop-head shop-モバステ-">モバステ
{#                    <p class="shop-time">営業時間</p>#}
{#                    <p class="shop-time">11:00~19:30</p>#}
{#                    <p class="shop-date">(月火水木金土日祝)</p>#}
                </th>
                <th class="shop-col shop-head shop-アキモバ-">アキモバ
{#                    <p class="shop-time">営業時間</p>#}
{#                    <p class="shop-time">12:00~20:00</p>#}
{#                    <p class="shop-date">(月火水木金土　　)</p>#}
                </th>
                <th class="shop-col shop-head shop-トゥインクル">トゥイン<br>クル
{#                    <p class="shop-time">営業時間</p>#}
{#                    <p class="shop-time">10:30~19:30</p>#}
{#                    <p class="shop-date">(月火水木金土日祝)</p>#}
                </th>
                <th class="shop-col shop-head shop-家電市場">家電市場
{#                    <p class="shop-time">営業時間</p>#}
{#                    <p class="shop-time">11:00~19:00</p>#}
{#                    <p class="shop-date">(月火水木金　　　)</p>#}
                </th>
                <th class="shop-col shop-head shop-買取楽園">買取楽園
{#                    <p class="shop-time">営業時間</p>#}
{#                    <p class="shop-time">10:00~19:00</p>#}
{#                    <p class="shop-date">(月火水木金土　祝)</p>#}
                </th>
{#                <th class="shop-col shop-head shop-買取当番 is-hidden">買取当番<br>　#}
{#                    <p class="shop-time">営業時間</p>#}
{#                    <p class="shop-time">11:00~19:00</p>#}
{#                    <p class="shop-date">(月火水木金土　　)</p>#}
{#                </th>#}
                <th class="shop-col shop-head shop-携帯空間">携帯空間
{#                    <p class="shop-time">営業時間</p>#}
{#                    <p class="shop-time">11:00~19:00</p>#}
{#                    <p class="shop-date">(月火水木金土　祝)</p>#}
                </th>
                <th class="shop-col shop-head shop-ゲストモバイル">ゲストモ<br>バイル
{#                    <p class="shop-time">営業時間</p>#}
{#                    <p class="shop-time">11:30~19:00</p>#}
{#                    <p class="shop-date">(月火水木金　　　)</p>#}
                </th>
{#                <th class="shop-col shop-head shop-買取オク is-hidden">買取オク<br>　#}
{#                    <p class="shop-time">営業時間</p>#}
{#                    <p class="shop-time">11:00~19:00</p>#}
{#                    <p class="shop-date">(月火水木金土　祝)</p>#}
{#                </th>#}
                <th class="shop-col shop-head shop-毎日買取">毎日買取
{#                    <p class="shop-time">営業時間</p>#}
{#                    <p class="shop-time">10:30~20:00</p>#}
{#                    <p class="shop-date">(月火水木金土日祝)</p>#}
                </th>
                <th class="shop-col shop-head shop-MobileZone">Mobile<br>Zone
{#                    <p class="shop-time">営業時間</p>#}
{#                    <p class="shop-time">10:00~18:00</p>#}
{#                    <p class="shop-date">(月火水木金土　祝)</p>#}
                </th>
                <th style="width: 10px;background: #ffffff;border:0"></th>

            </tr>
            </thead>
            <tbody>
            <!-- 256GB -->
            <tr>
                <td class="front-name" rowspan="25" style="text-align: center;">17 Pro Max</td>
                <td class="front-num" rowspan="5" style="text-align:left;">256GB</td>
                <td class="front-num" rowspan="5" data-issue-pricing>194,800</td>
                <td class="front-num" rowspan="5"
                    data-range-shop-id="14 1 8 13 7 9 10 21 18 16 12 17 3 4 5 11 15 20"
                    data-range-iphen-id="20 21 22"
                    data-highest>
                    -
                </td>
                <td class="front-num" rowspan="5" data-diff>-</td>
                <td class="front-num" rowspan="5" data-rate>-</td>
                <td class="front-num" rowspan="5"
                    data-range-shop-id="14 1 8 13 7 9 10 21 18 16 12 17 3 4 5 11 15 20"
                    data-range-iphen-id="20 21 22"
                    data-change-from-crevious-day>-
                </td>
                <td rowspan="5" class="is-hidden front-num"
                    data-range-shop-id="14 1 8 13 7 9 10 21 18 16 12 17 3 4 5 11 15 20"
                    data-range-iphen-id="20 21 22"
                    data-average>
                    -
                </td>
            </tr>
            <tr data-color="all">
                <td class="text-all" style="text-align:left;">ALL</td>
                <td class="nodata all-price" data-shop-id="14" data-iphen-average-id="21 22 20">※要問</td>
                <td class="nodata all-price" data-shop-id="1" data-iphen-average-id="21 22 20">※要問</td>
                <td class="nodata all-price" data-shop-id="8" data-iphen-average-id="21 22 20">※要問</td>
                <td class="nodata all-price" data-shop-id="13" data-iphen-average-id="21 22 20">※要問</td>
                <td class="nodata all-price" data-shop-id="7" data-iphen-average-id="21 22 20">※要問</td>
                <td class="nodata all-price" data-shop-id="9" data-iphen-average-id="21 22 20">※要問</td>
                <td class="nodata all-price" data-shop-id="10" data-iphen-average-id="21 22 20">※要問</td>
                <td class="nodata all-price" data-shop-id="21" data-iphen-average-id="21 22 20">※要問</td>
                <td class="nodata all-price" data-shop-id="16" data-iphen-average-id="21 22 20">※要問</td>
                <td class="nodata all-price" data-shop-id="18" data-iphen-average-id="21 22 20">※要問</td>
                <td class="nodata all-price" data-shop-id="12" data-iphen-average-id="21 22 20">※要問</td>
                <td class="nodata all-price" data-shop-id="17" data-iphen-average-id="21 22 20">※要問</td>
                <td class="nodata all-price" data-shop-id="3" data-iphen-average-id="21 22 20">※要問</td>
                <td class="nodata all-price" data-shop-id="4" data-iphen-average-id="21 22 20">※要問</td>
{#                <td class="nodata all-price" style="display: none !important;" data-shop-id="2"#}
{#                    data-iphen-average-id="21 22 20">※要問#}
{#                </td>#}
                <td class="nodata all-price" data-shop-id="5" data-iphen-average-id="21 22 20">※要問</td>
                <td class="nodata all-price" data-shop-id="11" data-iphen-average-id="21 22 20">※要問</td>
{#                <td class="nodata all-price" style="display: none !important;" data-shop-id="6"#}
{#                    data-iphen-average-id="21 22 20">※要問#}
{#                </td>#}
                <td class="nodata all-price" data-shop-id="15" data-iphen-average-id="21 22 20">※要問</td>
                <td class="nodata all-price" data-shop-id="20" data-iphen-average-id="21 22 20">※要問</td>
            </tr>
            <tr data-color="orange">
                <td style="text-align:left;">Orange</td>
                <td class="nodata" data-shop-id="14" data-iphen-id="21" data-to-marge-iphone-id="21 22 20">※要問</td>
                <td class="nodata" data-shop-id="1" data-iphen-id="21" data-to-marge-iphone-id="21 22 20">※要問</td>
                <td class="nodata" data-shop-id="8" data-iphen-id="21" data-to-marge-iphone-id="21 22 20">※要問</td>
                <td class="nodata" data-shop-id="13" data-iphen-id="21" data-to-marge-iphone-id="21 22 20">※要問</td>
                <td class="nodata" data-shop-id="7" data-iphen-id="21" data-to-marge-iphone-id="21 22 20">※要問</td>
                <td class="nodata" data-shop-id="9" data-iphen-id="21" data-to-marge-iphone-id="21 22 20">※要問</td>
                <td class="nodata" data-shop-id="10" data-iphen-id="21" data-to-marge-iphone-id="21 22 20">※要問</td>
                <td class="nodata" data-shop-id="21" data-iphen-id="21" data-to-marge-iphone-id="21 22 20">※要問</td>
                <td class="nodata" data-shop-id="16" data-iphen-id="21" data-to-marge-iphone-id="21 22 20">※要問</td>
                <td class="nodata" data-shop-id="18" data-iphen-id="21" data-to-marge-iphone-id="21 22 20">※要問</td>
                <td class="nodata" data-shop-id="12" data-iphen-id="21" data-to-marge-iphone-id="21 22 20">※要問</td>
                <td class="nodata" data-shop-id="17" data-iphen-id="21" data-to-marge-iphone-id="21 22 20">※要問</td>
                <td class="nodata" data-shop-id="3" data-iphen-id="21" data-to-marge-iphone-id="21 22 20">※要問</td>
                <td class="nodata" data-shop-id="4" data-iphen-id="21" data-to-marge-iphone-id="21 22 20">※要問</td>
{#                <td class="nodata " style="display: none !important;" data-shop-id="2" data-iphen-id="21"#}
{#                    data-to-marge-iphone-id="21 22 20">#}
{#                    ※要問#}
{#                </td>#}
                <td class="nodata" data-shop-id="5" data-iphen-id="21" data-to-marge-iphone-id="21 22 20">※要問</td>
                <td class="nodata" data-shop-id="11" data-iphen-id="21" data-to-marge-iphone-id="21 22 20">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="6" data-iphen-id="21"#}
{#                    data-to-marge-iphone-id="21 22 20">#}
{#                    ※要問#}
{#                </td>#}
                <td class="nodata" data-shop-id="15" data-iphen-id="21" data-to-marge-iphone-id="21 22 20">※要問</td>
                <td class="nodata" data-shop-id="20" data-iphen-id="21" data-to-marge-iphone-id="21 22 20">※要問</td>
            </tr>
            <tr data-color="blue">
                <td style="text-align:left;">Blue</td>
                <td class="nodata" data-shop-id="14" data-iphen-id="22">※要問</td>
                <td class="nodata" data-shop-id="1" data-iphen-id="22">※要問</td>
                <td class="nodata" data-shop-id="8" data-iphen-id="22">※要問</td>
                <td class="nodata" data-shop-id="13" data-iphen-id="22">※要問</td>
                <td class="nodata" data-shop-id="7" data-iphen-id="22">※要問</td>
                <td class="nodata" data-shop-id="9" data-iphen-id="22">※要問</td>
                <td class="nodata" data-shop-id="10" data-iphen-id="22">※要問</td>
                <td class="nodata" data-shop-id="21" data-iphen-id="22">※要問</td>
                <td class="nodata" data-shop-id="16" data-iphen-id="22">※要問</td>
                <td class="nodata" data-shop-id="18" data-iphen-id="22">※要問</td>
                <td class="nodata" data-shop-id="12" data-iphen-id="22">※要問</td>
                <td class="nodata" data-shop-id="17" data-iphen-id="22">※要問</td>
                <td class="nodata" data-shop-id="3" data-iphen-id="22">※要問</td>
                <td class="nodata" data-shop-id="4" data-iphen-id="22">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="2" data-iphen-id="22">※要問</td>#}
                <td class="nodata" data-shop-id="5" data-iphen-id="22">※要問</td>
                <td class="nodata" data-shop-id="11" data-iphen-id="22">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="6" data-iphen-id="22">※要問</td>#}
                <td class="nodata" data-shop-id="15" data-iphen-id="22">※要問</td>
                <td class="nodata" data-shop-id="20" data-iphen-id="22">※要問</td>
            </tr>
            <tr data-color="silver">
                <td style="text-align:left;">Silver</td>
                <td class="nodata" data-shop-id="14" data-iphen-id="20">※要問</td>
                <td class="nodata" data-shop-id="1" data-iphen-id="20">※要問</td>
                <td class="nodata" data-shop-id="8" data-iphen-id="20">※要問</td>
                <td class="nodata" data-shop-id="13" data-iphen-id="20">※要問</td>
                <td class="nodata" data-shop-id="7" data-iphen-id="20">※要問</td>
                <td class="nodata" data-shop-id="9" data-iphen-id="20">※要問</td>
                <td class="nodata" data-shop-id="10" data-iphen-id="20">※要問</td>
                <td class="nodata" data-shop-id="21" data-iphen-id="20">※要問</td>
                <td class="nodata" data-shop-id="16" data-iphen-id="20">※要問</td>
                <td class="nodata" data-shop-id="18" data-iphen-id="20">※要問</td>
                <td class="nodata" data-shop-id="12" data-iphen-id="20">※要問</td>
                <td class="nodata" data-shop-id="17" data-iphen-id="20">※要問</td>
                <td class="nodata" data-shop-id="3" data-iphen-id="20">※要問</td>
                <td class="nodata" data-shop-id="4" data-iphen-id="20">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="2" data-iphen-id="20">※要問</td>#}
                <td class="nodata" data-shop-id="5" data-iphen-id="20">※要問</td>
                <td class="nodata" data-shop-id="11" data-iphen-id="20">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="6" data-iphen-id="20">※要問</td>#}
                <td class="nodata" data-shop-id="15" data-iphen-id="20">※要問</td>
                <td class="nodata" data-shop-id="20" data-iphen-id="20">※要問</td>
            </tr>

            <tr>
                <td class="c"></td>

            </tr>


            <!-- 512GB -->
            <tr>
                <td class="front-num" rowspan="5" style="text-align:left;">512GB</td>
                <td class="front-num" rowspan="5" data-issue-pricing>229,800</td>
                <td class="front-num" rowspan="5"
                    data-range-shop-id="14 1 8 13 7 9 10 21 18 16 12 17 3 4 5 11 15 20"
                    data-range-iphen-id="23 24 25"
                    data-highest>
                    -

                <td class="front-num" rowspan="5" data-diff>-</td>
                <td class="front-num" rowspan="5" data-rate>-</td>
                <td class="front-num" rowspan="5"
                    data-range-shop-id="14 1 8 13 7 9 10 21 18 16 12 17 3 4 5 11 15 20"
                    data-range-iphen-id="23 24 25"
                    data-change-from-crevious-day>-
                </td>
                <td rowspan="5" class="is-hidden front-num"
                    data-range-shop-id="14 1 8 13 7 9 10 21 18 16 12 17 3 4 5 11 15 20"
                    data-range-iphen-id="23 24 25"
                    data-average>
                    -
                </td>

            </tr>
            <tr class="avg-row" data-color="all">
                <td class="text-all" colspan="1" style="text-align:left;">ALL</td>
                <td class="nodata all-price" data-shop-id="14" data-iphen-average-id="24 25 23">※要問</td>
                <td class="nodata all-price" data-shop-id="1" data-iphen-average-id="24 25 23">※要問</td>
                <td class="nodata all-price" data-shop-id="8" data-iphen-average-id="24 25 23">※要問</td>
                <td class="nodata all-price" data-shop-id="13" data-iphen-average-id="24 25 23">※要問</td>
                <td class="nodata all-price" data-shop-id="7" data-iphen-average-id="24 25 23">※要問</td>
                <td class="nodata all-price" data-shop-id="9" data-iphen-average-id="24 25 23">※要問</td>
                <td class="nodata all-price" data-shop-id="10" data-iphen-average-id="24 25 23">※要問</td>
                <td class="nodata all-price" data-shop-id="21" data-iphen-average-id="24 25 23">※要問</td>
                <td class="nodata all-price" data-shop-id="16" data-iphen-average-id="24 25 23">※要問</td>
                <td class="nodata all-price" data-shop-id="18" data-iphen-average-id="24 25 23">※要問</td>
                <td class="nodata all-price" data-shop-id="12" data-iphen-average-id="24 25 23">※要問</td>
                <td class="nodata all-price" data-shop-id="17" data-iphen-average-id="24 25 23">※要問</td>
                <td class="nodata all-price" data-shop-id="3" data-iphen-average-id="24 25 23">※要問</td>
                <td class="nodata all-price" data-shop-id="4" data-iphen-average-id="24 25 23">※要問</td>
{#                <td class="nodata  all-pric" style="display: none !important;" data-shop-id="2"#}
{#                    data-iphen-average-id="24 25 23">※要問#}
{#                </td>#}
                <td class="nodata all-price" data-shop-id="5" data-iphen-average-id="24 25 23">※要問</td>
                <td class="nodata all-price" data-shop-id="11" data-iphen-average-id="24 25 23">※要問</td>
{#                <td class="nodata  all-pric" style="display: none !important;" data-shop-id="6"#}
{#                    data-iphen-average-id="24 25 23">※要問#}
{#                </td>#}
                <td class="nodata all-price" data-shop-id="15" data-iphen-average-id="24 25 23">※要問</td>
                <td class="nodata all-price" data-shop-id="20" data-iphen-average-id="24 25 23">※要問</td>
            </tr>
            <tr data-color="orange">
                <td style="text-align:left;">Orange</td>
                <td class="nodata" data-shop-id="14" data-iphen-id="24" data-to-marge-iphone-id="24 25 23">※要問</td>
                <td class="nodata" data-shop-id="1" data-iphen-id="24" data-to-marge-iphone-id="24 25 23">※要問</td>
                <td class="nodata" data-shop-id="8" data-iphen-id="24" data-to-marge-iphone-id="24 25 23">※要問</td>
                <td class="nodata" data-shop-id="13" data-iphen-id="24" data-to-marge-iphone-id="24 25 23">※要問</td>
                <td class="nodata" data-shop-id="7" data-iphen-id="24" data-to-marge-iphone-id="24 25 23">※要問</td>
                <td class="nodata" data-shop-id="9" data-iphen-id="24" data-to-marge-iphone-id="24 25 23">※要問</td>
                <td class="nodata" data-shop-id="10" data-iphen-id="24" data-to-marge-iphone-id="24 25 23">※要問</td>
                <td class="nodata" data-shop-id="21" data-iphen-id="24" data-to-marge-iphone-id="24 25 23">※要問</td>
                <td class="nodata" data-shop-id="16" data-iphen-id="24" data-to-marge-iphone-id="24 25 23">※要問</td>
                <td class="nodata" data-shop-id="18" data-iphen-id="24" data-to-marge-iphone-id="24 25 23">※要問</td>
                <td class="nodata" data-shop-id="12" data-iphen-id="24" data-to-marge-iphone-id="24 25 23">※要問</td>
                <td class="nodata" data-shop-id="17" data-iphen-id="24" data-to-marge-iphone-id="24 25 23">※要問</td>
                <td class="nodata" data-shop-id="3" data-iphen-id="24" data-to-marge-iphone-id="24 25 23">※要問</td>
                <td class="nodata" data-shop-id="4" data-iphen-id="24" data-to-marge-iphone-id="24 25 23">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="2" data-iphen-id="24"#}
{#                    data-to-marge-iphone-id="24 25 23">#}
{#                    ※要問#}
{#                </td>#}
                <td class="nodata" data-shop-id="5" data-iphen-id="24" data-to-marge-iphone-id="24 25 23">※要問</td>
                <td class="nodata" data-shop-id="11" data-iphen-id="24" data-to-marge-iphone-id="24 25 23">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="6" data-iphen-id="24"#}
{#                    data-to-marge-iphone-id="24 25 23">#}
{#                    ※要問#}
{#                </td>#}
                <td class="nodata" data-shop-id="15" data-iphen-id="24" data-to-marge-iphone-id="24 25 23">※要問</td>
                <td class="nodata" data-shop-id="20" data-iphen-id="24" data-to-marge-iphone-id="24 25 23">※要問</td>
            </tr>
            <tr data-color="blue">
                <td style="text-align:left;">Blue</td>
                <td class="nodata" data-shop-id="14" data-iphen-id="25">※要問</td>
                <td class="nodata" data-shop-id="1" data-iphen-id="25">※要問</td>
                <td class="nodata" data-shop-id="8" data-iphen-id="25">※要問</td>
                <td class="nodata" data-shop-id="13" data-iphen-id="25">※要問</td>
                <td class="nodata" data-shop-id="7" data-iphen-id="25">※要問</td>
                <td class="nodata" data-shop-id="9" data-iphen-id="25">※要問</td>
                <td class="nodata" data-shop-id="10" data-iphen-id="25">※要問</td>
                <td class="nodata" data-shop-id="21" data-iphen-id="25">※要問</td>
                <td class="nodata" data-shop-id="16" data-iphen-id="25">※要問</td>
                <td class="nodata" data-shop-id="18" data-iphen-id="25">※要問</td>
                <td class="nodata" data-shop-id="12" data-iphen-id="25">※要問</td>
                <td class="nodata" data-shop-id="17" data-iphen-id="25">※要問</td>
                <td class="nodata" data-shop-id="3" data-iphen-id="25">※要問</td>
                <td class="nodata" data-shop-id="4" data-iphen-id="25">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="2" data-iphen-id="25">※要問</td>#}
                <td class="nodata" data-shop-id="5" data-iphen-id="25">※要問</td>
                <td class="nodata" data-shop-id="11" data-iphen-id="25">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="6" data-iphen-id="25">※要問</td>#}
                <td class="nodata" data-shop-id="15" data-iphen-id="25">※要問</td>
                <td class="nodata" data-shop-id="20" data-iphen-id="25">※要問</td>
            </tr>
            <tr data-color="silver">
                <td style="text-align:left;">Silver</td>
                <td class="nodata" data-shop-id="14" data-iphen-id="23">※要問</td>
                <td class="nodata" data-shop-id="1" data-iphen-id="23">※要問</td>
                <td class="nodata" data-shop-id="8" data-iphen-id="23">※要問</td>
                <td class="nodata" data-shop-id="13" data-iphen-id="23">※要問</td>
                <td class="nodata" data-shop-id="7" data-iphen-id="23">※要問</td>
                <td class="nodata" data-shop-id="9" data-iphen-id="23">※要問</td>
                <td class="nodata" data-shop-id="10" data-iphen-id="23">※要問</td>
                <td class="nodata" data-shop-id="21" data-iphen-id="23">※要問</td>
                <td class="nodata" data-shop-id="16" data-iphen-id="23">※要問</td>
                <td class="nodata" data-shop-id="18" data-iphen-id="23">※要問</td>
                <td class="nodata" data-shop-id="12" data-iphen-id="23">※要問</td>
                <td class="nodata" data-shop-id="17" data-iphen-id="23">※要問</td>
                <td class="nodata" data-shop-id="3" data-iphen-id="23">※要問</td>
                <td class="nodata" data-shop-id="4" data-iphen-id="23">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="2" data-iphen-id="23">※要問</td>#}
                <td class="nodata" data-shop-id="5" data-iphen-id="23">※要問</td>
                <td class="nodata" data-shop-id="11" data-iphen-id="23">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="6" data-iphen-id="23">※要問</td>#}
                <td class="nodata" data-shop-id="15" data-iphen-id="23">※要問</td>
                <td class="nodata" data-shop-id="20" data-iphen-id="23">※要問</td>
            </tr>
            <tr>
                <td class="c"></td>

            </tr>
            <!-- 1TB -->
            <tr>
                <td class="front-num" rowspan="5" style="text-align:left;">1TB</td>
                <td class="front-num" rowspan="5" data-issue-pricing>264,800</td>
                <td class="front-num" rowspan="5"
                    data-range-shop-id="14 1 8 13 7 9 10 21 18 16 12 17 3 4 5 11 15 20"
                    data-range-iphen-id="26 27 28"
                    data-highest>
                    -
                </td>
                <td class="front-num" rowspan="5" data-diff>-</td>
                <td class="front-num" rowspan="5" data-rate>-</td>
                <td class="front-num" rowspan="5"
                    data-range-shop-id="14 1 8 13 7 9 10 21 18 16 12 17 3 4 5 11 15 20"
                    data-range-iphen-id="26 27 28"
                    data-change-from-crevious-day>-
                </td>
                <td rowspan="5" class="is-hidden front-num"
                    data-range-shop-id="14 1 8 13 7 9 10 21 18 16 12 17 3 4 5 11 15 20"
                    data-range-iphen-id="26 27 28"
                    data-average>
                    -
                </td>
            </tr>
            <tr class="avg-row" data-color="ALL">
                <td class="text-all" colspan="1" style="text-align:left;">ALL</td>
                <td class="nodata all-price" data-shop-id="14" iphen-average-id="27 28 26">※要問</td>
                <td class="nodata all-price" data-shop-id="1" iphen-average-id="27 28 26">※要問</td>
                <td class="nodata all-price" data-shop-id="8" iphen-average-id="27 28 26">※要問</td>
                <td class="nodata all-price" data-shop-id="13" iphen-average-id="27 28 26">※要問</td>
                <td class="nodata all-price" data-shop-id="7" iphen-average-id="27 28 26">※要問</td>
                <td class="nodata all-price" data-shop-id="9" iphen-average-id="27 28 26">※要問</td>
                <td class="nodata all-price" data-shop-id="10" iphen-average-id="27 28 26">※要問</td>
                <td class="nodata all-price" data-shop-id="21" iphen-average-id="27 28 26">※要問</td>
                <td class="nodata all-price" data-shop-id="16" iphen-average-id="27 28 26">※要問</td>
                <td class="nodata all-price" data-shop-id="18" iphen-average-id="27 28 26">※要問</td>
                <td class="nodata all-price" data-shop-id="12" iphen-average-id="27 28 26">※要問</td>
                <td class="nodata all-price" data-shop-id="17" iphen-average-id="27 28 26">※要問</td>
                <td class="nodata all-price" data-shop-id="3" iphen-average-id="27 28 26">※要問</td>
                <td class="nodata all-price" data-shop-id="4" iphen-average-id="27 28 26">※要問</td>
{#                <td class="nodata all-price" style="display: none !important;" data-shop-id="2"#}
{#                    iphen-average-id="27 28 26">※要問#}
{#                </td>#}
                <td class="nodata all-price" data-shop-id="5" iphen-average-id="27 28 26">※要問</td>
                <td class="nodata all-price" data-shop-id="11" iphen-average-id="27 28 26">※要問</td>
{#                <td class="nodata all-price" style="display: none !important;" data-shop-id="6"#}
{#                    iphen-average-id="27 28 26">※要問#}
{#                </td>#}
                <td class="nodata all-price" data-shop-id="15" iphen-average-id="27 28 26">※要問</td>
                <td class="nodata all-price" data-shop-id="20" iphen-average-id="27 28 26">※要問</td>
            </tr>
            <tr data-color="orange">
                <td style="text-align:left;">Orange</td>
                <td class="nodata" data-shop-id="14" data-iphen-id="27" data-to-marge-iphone-id="27 28 26">※要問</td>
                <td class="nodata" data-shop-id="1" data-iphen-id="27" data-to-marge-iphone-id="27 28 26">※要問</td>
                <td class="nodata" data-shop-id="8" data-iphen-id="27" data-to-marge-iphone-id="27 28 26">※要問</td>
                <td class="nodata" data-shop-id="13" data-iphen-id="27" data-to-marge-iphone-id="27 28 26">※要問</td>
                <td class="nodata" data-shop-id="7" data-iphen-id="27" data-to-marge-iphone-id="27 28 26">※要問</td>
                <td class="nodata" data-shop-id="9" data-iphen-id="27" data-to-marge-iphone-id="27 28 26">※要問</td>
                <td class="nodata" data-shop-id="10" data-iphen-id="27" data-to-marge-iphone-id="27 28 26">※要問</td>
                <td class="nodata" data-shop-id="21" data-iphen-id="27" data-to-marge-iphone-id="27 28 26">※要問</td>
                <td class="nodata" data-shop-id="16" data-iphen-id="27" data-to-marge-iphone-id="27 28 26">※要問</td>
                <td class="nodata" data-shop-id="18" data-iphen-id="27" data-to-marge-iphone-id="27 28 26">※要問</td>
                <td class="nodata" data-shop-id="12" data-iphen-id="27" data-to-marge-iphone-id="27 28 26">※要問</td>
                <td class="nodata" data-shop-id="17" data-iphen-id="27" data-to-marge-iphone-id="27 28 26">※要問</td>
                <td class="nodata" data-shop-id="3" data-iphen-id="27" data-to-marge-iphone-id="27 28 26">※要問</td>
                <td class="nodata" data-shop-id="4" data-iphen-id="27" data-to-marge-iphone-id="27 28 26">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="2" data-iphen-id="27"#}
{#                    data-to-marge-iphone-id="27 28 26">#}
{#                    ※要問#}
{#                </td>#}
                <td class="nodata" data-shop-id="5" data-iphen-id="27" data-to-marge-iphone-id="27 28 26">※要問</td>
                <td class="nodata" data-shop-id="11" data-iphen-id="27" data-to-marge-iphone-id="27 28 26">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="6" data-iphen-id="27"#}
{#                    data-to-marge-iphone-id="27 28 26">#}
{#                    ※要問#}
{#                </td>#}
                <td class="nodata" data-shop-id="15" data-iphen-id="27" data-to-marge-iphone-id="27 28 26">※要問</td>
                <td class="nodata" data-shop-id="20" data-iphen-id="27" data-to-marge-iphone-id="27 28 26">※要問</td>
            </tr>
            <tr data-color="blue">
                <td style="text-align:left;">Blue</td>
                <td class="nodata" data-shop-id="14" data-iphen-id="28">※要問</td>
                <td class="nodata" data-shop-id="1" data-iphen-id="28">※要問</td>
                <td class="nodata" data-shop-id="8" data-iphen-id="28">※要問</td>
                <td class="nodata" data-shop-id="13" data-iphen-id="28">※要問</td>
                <td class="nodata" data-shop-id="7" data-iphen-id="28">※要問</td>
                <td class="nodata" data-shop-id="9" data-iphen-id="28">※要問</td>
                <td class="nodata" data-shop-id="10" data-iphen-id="28">※要問</td>
                <td class="nodata" data-shop-id="21" data-iphen-id="28">※要問</td>
                <td class="nodata" data-shop-id="16" data-iphen-id="28">※要問</td>
                <td class="nodata" data-shop-id="18" data-iphen-id="28">※要問</td>
                <td class="nodata" data-shop-id="12" data-iphen-id="28">※要問</td>
                <td class="nodata" data-shop-id="17" data-iphen-id="28">※要問</td>
                <td class="nodata" data-shop-id="3" data-iphen-id="28">※要問</td>
                <td class="nodata" data-shop-id="4" data-iphen-id="28">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="2" data-iphen-id="28">※要問</td>#}
                <td class="nodata" data-shop-id="5" data-iphen-id="28">※要問</td>
                <td class="nodata" data-shop-id="11" data-iphen-id="28">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="6" data-iphen-id="28">※要問</td>#}
                <td class="nodata" data-shop-id="15" data-iphen-id="28">※要問</td>
                <td class="nodata" data-shop-id="20" data-iphen-id="28">※要問</td>
            </tr>
            <tr data-color="silver">
                <td style="text-align:left;">Silver</td>
                <td class="nodata" data-shop-id="14" data-iphen-id="26">※要問</td>
                <td class="nodata" data-shop-id="1" data-iphen-id="26">※要問</td>
                <td class="nodata" data-shop-id="8" data-iphen-id="26">※要問</td>
                <td class="nodata" data-shop-id="13" data-iphen-id="26">※要問</td>
                <td class="nodata" data-shop-id="7" data-iphen-id="26">※要問</td>
                <td class="nodata" data-shop-id="9" data-iphen-id="26">※要問</td>
                <td class="nodata" data-shop-id="10" data-iphen-id="26">※要問</td>
                <td class="nodata" data-shop-id="21" data-iphen-id="26">※要問</td>
                <td class="nodata" data-shop-id="16" data-iphen-id="26">※要問</td>
                <td class="nodata" data-shop-id="18" data-iphen-id="26">※要問</td>
                <td class="nodata" data-shop-id="12" data-iphen-id="26">※要問</td>
                <td class="nodata" data-shop-id="17" data-iphen-id="26">※要問</td>
                <td class="nodata" data-shop-id="3" data-iphen-id="26">※要問</td>
                <td class="nodata" data-shop-id="4" data-iphen-id="26">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="2" data-iphen-id="26">※要問</td>#}
                <td class="nodata" data-shop-id="5" data-iphen-id="26">※要問</td>
                <td class="nodata" data-shop-id="11" data-iphen-id="26">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="6" data-iphen-id="26">※要問</td>#}
                <td class="nodata" data-shop-id="15" data-iphen-id="26">※要問</td>
                <td class="nodata" data-shop-id="20" data-iphen-id="26">※要問</td>
            </tr>
            <tr>
                <td class="c"></td>

            </tr>
            <!-- 2TB -->
            <tr>
                <td class="front-num" rowspan="5" style="text-align:left;">2TB</td>
                <td class="front-num" rowspan="5" data-issue-pricing>329,800</td>
                <td class="front-num" rowspan="5"
                    data-range-shop-id="14 1 8 13 7 9 10 21 18 16 12 17 3 4 5 11 15 20"
                    data-range-iphen-id="29 30 31"
                    data-highest>
                    -
                </td>
                <td class="front-num" rowspan="5" data-diff>-</td>
                <td class="front-num" rowspan="5" data-rate>-</td>
                <td class="front-num" rowspan="5"
                    data-range-shop-id="14 1 8 13 7 9 10 21 18 16 12 17 3 4 5 11 15 20"
                    data-range-iphen-id="29 30 31"
                    data-change-from-crevious-day>-
                </td>
                <td rowspan="5" class="is-hidden front-num"
                    data-range-shop-id="14 1 8 13 7 9 10 21 18 16 12 17 3 4 5 11 15 20"
                    data-range-iphen-id="29 30 31"
                    data-average>
                    -
                </td>
            </tr>
            <tr class="avg-row" data-color="All">
                <td class="text-all" colspan="1" style="text-align:left;">ALL</td>
                <td class="nodata all-price" data-shop-id="14" data-iphen-average-id="30 31 29">※要問</td>
                <td class="nodata all-price" data-shop-id="1" data-iphen-average-id="30 31 29">※要問</td>
                <td class="nodata all-price" data-shop-id="8" data-iphen-average-id="30 31 29">※要問</td>
                <td class="nodata all-price" data-shop-id="13" data-iphen-average-id="30 31 29">※要問</td>
                <td class="nodata all-price" data-shop-id="7" data-iphen-average-id="30 31 29">※要問</td>
                <td class="nodata all-price" data-shop-id="9" data-iphen-average-id="30 31 29">※要問</td>
                <td class="nodata all-price" data-shop-id="10" data-iphen-average-id="30 31 29">※要問</td>
                <td class="nodata all-price" data-shop-id="21" data-iphen-average-id="30 31 29">※要問</td>
                <td class="nodata all-price" data-shop-id="16" data-iphen-average-id="30 31 29">※要問</td>
                <td class="nodata all-price" data-shop-id="18" data-iphen-average-id="30 31 29">※要問</td>
                <td class="nodata all-price" data-shop-id="12" data-iphen-average-id="30 31 29">※要問</td>
                <td class="nodata all-price" data-shop-id="17" data-iphen-average-id="30 31 29">※要問</td>
                <td class="nodata all-price" data-shop-id="3" data-iphen-average-id="30 31 29">※要問</td>
                <td class="nodata all-price" data-shop-id="4" data-iphen-average-id="30 31 29">※要問</td>
{#                <td class="nodata all-price" style="display: none !important;" data-shop-id="2"#}
{#                    data-iphen-average-id="30 31 29">※要問#}
{#                </td>#}
                <td class="nodata all-price" data-shop-id="5" data-iphen-average-id="30 31 29">※要問</td>
                <td class="nodata all-price" data-shop-id="11" data-iphen-average-id="30 31 29">※要問</td>
{#                <td class="nodata all-price" style="display: none !important;" data-shop-id="6"#}
{#                    data-iphen-average-id="30 31 29">※要問#}
{#                </td>#}
                <td class="nodata all-price" data-shop-id="15" data-iphen-average-id="30 31 29">※要問</td>
                <td class="nodata all-price" data-shop-id="20" data-iphen-average-id="30 31 29">※要問</td>
            </tr>
            <tr data-color="orange">
                <td style="text-align:left;">Orange</td>
                <td class="nodata" data-shop-id="14" data-iphen-id="30" data-to-marge-iphone-id="30 31 29">※要問</td>
                <td class="nodata" data-shop-id="1" data-iphen-id="30" data-to-marge-iphone-id="30 31 29">※要問</td>
                <td class="nodata" data-shop-id="8" data-iphen-id="30" data-to-marge-iphone-id="30 31 29">※要問</td>
                <td class="nodata" data-shop-id="13" data-iphen-id="30" data-to-marge-iphone-id="30 31 29">※要問</td>
                <td class="nodata" data-shop-id="7" data-iphen-id="30" data-to-marge-iphone-id="30 31 29">※要問</td>
                <td class="nodata" data-shop-id="9" data-iphen-id="30" data-to-marge-iphone-id="30 31 29">※要問</td>
                <td class="nodata" data-shop-id="10" data-iphen-id="30" data-to-marge-iphone-id="30 31 29">※要問</td>
                <td class="nodata" data-shop-id="21" data-iphen-id="30" data-to-marge-iphone-id="30 31 29">※要問</td>
                <td class="nodata" data-shop-id="16" data-iphen-id="30" data-to-marge-iphone-id="30 31 29">※要問</td>
                <td class="nodata" data-shop-id="18" data-iphen-id="30" data-to-marge-iphone-id="30 31 29">※要問</td>
                <td class="nodata" data-shop-id="12" data-iphen-id="30" data-to-marge-iphone-id="30 31 29">※要問</td>
                <td class="nodata" data-shop-id="17" data-iphen-id="30" data-to-marge-iphone-id="30 31 29">※要問</td>
                <td class="nodata" data-shop-id="3" data-iphen-id="30" data-to-marge-iphone-id="30 31 29">※要問</td>
                <td class="nodata" data-shop-id="4" data-iphen-id="30" data-to-marge-iphone-id="30 31 29">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="2" data-iphen-id="30"#}
{#                    data-to-marge-iphone-id="30 31 29">#}
{#                    ※要問#}
{#                </td>#}
                <td class="nodata" data-shop-id="5" data-iphen-id="30" data-to-marge-iphone-id="30 31 29">※要問</td>
                <td class="nodata" data-shop-id="11" data-iphen-id="30" data-to-marge-iphone-id="30 31 29">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="6" data-iphen-id="30"#}
{#                    data-to-marge-iphone-id="30 31 29">#}
{#                    ※要問#}
{#                </td>#}
                <td class="nodata" data-shop-id="15" data-iphen-id="30" data-to-marge-iphone-id="30 31 29">※要問</td>
                <td class="nodata" data-shop-id="20" data-iphen-id="30" data-to-marge-iphone-id="30 31 29">※要問</td>
            </tr>
            <tr data-color="blue">
                <td style="text-align:left;">Blue</td>
                <td class="nodata" data-shop-id="14" data-iphen-id="31">※要問</td>
                <td class="nodata" data-shop-id="1" data-iphen-id="31">※要問</td>
                <td class="nodata" data-shop-id="8" data-iphen-id="31">※要問</td>
                <td class="nodata" data-shop-id="13" data-iphen-id="31">※要問</td>
                <td class="nodata" data-shop-id="7" data-iphen-id="31">※要問</td>
                <td class="nodata" data-shop-id="9" data-iphen-id="31">※要問</td>
                <td class="nodata" data-shop-id="10" data-iphen-id="31">※要問</td>
                <td class="nodata" data-shop-id="21" data-iphen-id="31">※要問</td>
                <td class="nodata" data-shop-id="16" data-iphen-id="31">※要問</td>
                <td class="nodata" data-shop-id="18" data-iphen-id="31">※要問</td>
                <td class="nodata" data-shop-id="12" data-iphen-id="31">※要問</td>
                <td class="nodata" data-shop-id="17" data-iphen-id="31">※要問</td>
                <td class="nodata" data-shop-id="3" data-iphen-id="31">※要問</td>
                <td class="nodata" data-shop-id="4" data-iphen-id="31">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="2" data-iphen-id="31">※要問</td>#}
                <td class="nodata" data-shop-id="5" data-iphen-id="31">※要問</td>
                <td class="nodata" data-shop-id="11" data-iphen-id="31">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="6" data-iphen-id="31">※要問</td>#}
                <td class="nodata" data-shop-id="15" data-iphen-id="31">※要問</td>
                <td class="nodata" data-shop-id="20" data-iphen-id="31">※要問</td>
            </tr>
            <tr data-color="silver">
                <td style="text-align:left;">Silver</td>
                <td class="nodata" data-shop-id="14" data-iphen-id="29">※要問</td>
                <td class="nodata" data-shop-id="1" data-iphen-id="29">※要問</td>
                <td class="nodata" data-shop-id="8" data-iphen-id="29">※要問</td>
                <td class="nodata" data-shop-id="13" data-iphen-id="29">※要問</td>
                <td class="nodata" data-shop-id="7" data-iphen-id="29">※要問</td>
                <td class="nodata" data-shop-id="9" data-iphen-id="29">※要問</td>
                <td class="nodata" data-shop-id="10" data-iphen-id="29">※要問</td>
                <td class="nodata" data-shop-id="21" data-iphen-id="29">※要問</td>
                <td class="nodata" data-shop-id="16" data-iphen-id="29">※要問</td>
                <td class="nodata" data-shop-id="18" data-iphen-id="29">※要問</td>
                <td class="nodata" data-shop-id="12" data-iphen-id="29">※要問</td>
                <td class="nodata" data-shop-id="17" data-iphen-id="29">※要問</td>
                <td class="nodata" data-shop-id="3" data-iphen-id="29">※要問</td>
                <td class="nodata" data-shop-id="4" data-iphen-id="29">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="2" data-iphen-id="29">※要問</td>#}
                <td class="nodata" data-shop-id="5" data-iphen-id="29">※要問</td>
                <td class="nodata" data-shop-id="11" data-iphen-id="29">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="6" data-iphen-id="29">※要問</td>#}
                <td class="nodata" data-shop-id="15" data-iphen-id="29">※要問</td>
                <td class="nodata" data-shop-id="20" data-iphen-id="29">※要問</td>
            </tr>

            </tbody>
        </table>
    </div>

    <div class="model-gap"></div>

    <!-- ================= iPhone 17 Pro ================= -->
    <div class="model-section">
        <!--       <div class="model-header">iPhone 17 Pro</div> -->
        <table>
            <thead class="thead-zero">
            <tr class="">
                <th class="col-model">機種</th>
                <th class="col-capacity">容量</th>
                <th class="col-num">定価</th>
                <th class="col-num">最高</th>
                　
                <th class="col-num">差額</th>
                <th class="col-num">買取率</th>
                <th class="col-num  is-hidden">平均値</th>
                <th class="col-num">前日比</th>
                <th class="col-color">カラー</th>
                <!-- Stores -->
                <th class="shop-col shop-head shop-買取商店">買取商店</th>
                <th class="shop-col shop-head shop-海峡通信">海峡通信</th>
                <th class="shop-col shop-head shop-買取１丁目">買取１丁目</th>
                <th class="shop-col shop-head shop-モバイルミックス">モバイルミックス</th>
                <th class="shop-col shop-head shop-森森買取">森森買取</th>
                <th class="shop-col shop-head shop-買取ルデヤ">買取ルデヤ</th>
                <th class="shop-col shop-head shop-買取Wiki">買取Wiki</th>
                <th class="shop-col shop-head shop-買取ホムラ">買取ホムラ</th>
                <th class="shop-col shop-head shop-ドラゴンモバイル-">ドラゴンモバイル-</th>
                <th class="shop-col shop-head shop-モバステ-">モバステ-</th>
                <th class="shop-col shop-head shop-アキモバ-">アキモバ-</th>
                <th class="shop-col shop-head shop-トゥインクル">トゥインクル</th>
                <th class="shop-col shop-head shop-家電市場">家電市場</th>
                <th class="shop-col shop-head shop-買取楽園">買取楽園</th>
{#                <th class="shop-col shop-head shop-買取当番">買取当番</th>#}
                <th class="shop-col shop-head shop-携帯空間">携帯空間</th>
                <th class="shop-col shop-head shop-ゲストモバイル">ゲストモバイル</th>
{#                <th class="shop-col shop-head shop-買取オク">買取オク</th>#}
                <th class="shop-col shop-head shop-毎日買取">毎日買取</th>
                <th class="shop-col shop-head shop-MobileZone">Mobile Zone</th>
            </tr>
            </thead>
            <tbody>
            <!-- 256GB -->
            <tr>
                <td class="front-name" rowspan="17" style="text-align: center;">17 Pro</td>
                <td class="front-num" rowspan="5" style="text-align:left;">256GB</td>
                <td class="front-num" rowspan="5" data-issue-pricing>179,800</td>
                <td class="front-num" rowspan="5"
                    data-range-shop-id="14 1 8 13 7 9 10 21 18 16 12 17 3 4 5 11 15 20"
                    data-range-iphen-id="11 12 13"
                    data-highest>
                    -
                </td>
                <td class="front-num" rowspan="5" data-diff>-</td>
                <td class="front-num" rowspan="5" data-rate>-</td>
                <td class="front-num" rowspan="5"
                    data-range-shop-id="14 1 8 13 7 9 10 21 18 16 12 17 3 4 5 11 15 20"
                    data-range-iphen-id="11 12 13"
                    data-change-from-crevious-day>-
                </td>
                <td rowspan="5" class="is-hidden front-num"
                    data-range-shop-id="14 1 8 13 7 9 10 21 18 16 12 17 3 4 5 11 15 20"
                    data-range-iphen-id="11 12 13"
                    data-average>
                    -
                </td>
            </tr>
            <tr class="avg-row" data-color="All">
                <td class="text-all" colspan="1" style="text-align:left;">ALL</td>
                <td class="nodata all-price" data-shop-id="14" data-iphen-average-id="12 13 11">※要問</td>
                <td class="nodata all-price" data-shop-id="1" data-iphen-average-id="12 13 11">※要問</td>
                <td class="nodata all-price" data-shop-id="8" data-iphen-average-id="12 13 11">※要問</td>
                <td class="nodata all-price" data-shop-id="13" data-iphen-average-id="12 13 11">※要問</td>
                <td class="nodata all-price" data-shop-id="7" data-iphen-average-id="12 13 11">※要問</td>
                <td class="nodata all-price" data-shop-id="9" data-iphen-average-id="12 13 11">※要問</td>
                <td class="nodata all-price" data-shop-id="10" data-iphen-average-id="12 13 11">※要問</td>
                <td class="nodata all-price" data-shop-id="21" data-iphen-average-id="12 13 11">※要問</td>
                <td class="nodata all-price" data-shop-id="16" data-iphen-average-id="12 13 11">※要問</td>
                <td class="nodata all-price" data-shop-id="18" data-iphen-average-id="12 13 11">※要問</td>
                <td class="nodata all-price" data-shop-id="12" data-iphen-average-id="12 13 11">※要問</td>
                <td class="nodata all-price" data-shop-id="17" data-iphen-average-id="12 13 11">※要問</td>
                <td class="nodata all-price" data-shop-id="3" data-iphen-average-id="12 13 11">※要問</td>
                <td class="nodata all-price" data-shop-id="4" data-iphen-average-id="12 13 11">※要問</td>
{#                <td class="nodata all-price" style="display: none !important;" data-shop-id="2"#}
{#                    data-iphen-average-id="12 13 11">※要問#}
{#                </td>#}
                <td class="nodata all-price" data-shop-id="5" data-iphen-average-id="12 13 11">※要問</td>
                <td class="nodata all-price" data-shop-id="11" data-iphen-average-id="12 13 11">※要問</td>
{#                <td class="nodata all-price" style="display: none !important;" data-shop-id="6"#}
{#                    data-iphen-average-id="12 13 11">※要問#}
{#                </td>#}
                <td class="nodata all-price" data-shop-id="15" data-iphen-average-id="12 13 11">※要問</td>
                <td class="nodata all-price" data-shop-id="20" data-iphen-average-id="12 13 11">※要問</td>
            </tr>
            <tr data-color="orange">
                <td style="text-align:left;">Orange</td>
                <td class="nodata" data-shop-id="14" data-iphen-id="12" data-to-marge-iphone-id="12 13 11">※要問</td>
                <td class="nodata" data-shop-id="1" data-iphen-id="12" data-to-marge-iphone-id="12 13 11">※要問</td>
                <td class="nodata" data-shop-id="8" data-iphen-id="12" data-to-marge-iphone-id="12 13 11">※要問</td>
                <td class="nodata" data-shop-id="13" data-iphen-id="12" data-to-marge-iphone-id="12 13 11">※要問</td>
                <td class="nodata" data-shop-id="7" data-iphen-id="12" data-to-marge-iphone-id="12 13 11">※要問</td>
                <td class="nodata" data-shop-id="9" data-iphen-id="12" data-to-marge-iphone-id="12 13 11">※要問</td>
                <td class="nodata" data-shop-id="10" data-iphen-id="12" data-to-marge-iphone-id="12 13 11">※要問</td>
                <td class="nodata" data-shop-id="21" data-iphen-id="12" data-to-marge-iphone-id="12 13 11">※要問</td>
                <td class="nodata" data-shop-id="16" data-iphen-id="12" data-to-marge-iphone-id="12 13 11">※要問</td>
                <td class="nodata" data-shop-id="18" data-iphen-id="12" data-to-marge-iphone-id="12 13 11">※要問</td>
                <td class="nodata" data-shop-id="12" data-iphen-id="12" data-to-marge-iphone-id="12 13 11">※要問</td>
                <td class="nodata" data-shop-id="17" data-iphen-id="12" data-to-marge-iphone-id="12 13 11">※要問</td>
                <td class="nodata" data-shop-id="3" data-iphen-id="12" data-to-marge-iphone-id="12 13 11">※要問</td>
                <td class="nodata" data-shop-id="4" data-iphen-id="12" data-to-marge-iphone-id="12 13 11">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="2" data-iphen-id="12"#}
{#                    data-to-marge-iphone-id="12 13 11">#}
{#                    ※要問#}
{#                </td>#}
                <td class="nodata" data-shop-id="5" data-iphen-id="12" data-to-marge-iphone-id="12 13 11">※要問</td>
                <td class="nodata" data-shop-id="11" data-iphen-id="12" data-to-marge-iphone-id="12 13 11">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="6" data-iphen-id="12"#}
{#                    data-to-marge-iphone-id="12 13 11">#}
{#                    ※要問#}
{#                </td>#}
                <td class="nodata" data-shop-id="15" data-iphen-id="12" data-to-marge-iphone-id="12 13 11">※要問</td>
                <td class="nodata" data-shop-id="20" data-iphen-id="12" data-to-marge-iphone-id="12 13 11">※要問</td>
            </tr>
            <tr data-color="blue">
                <td style="text-align:left;">Blue</td>
                <td class="nodata" data-shop-id="14" data-iphen-id="13">※要問</td>
                <td class="nodata" data-shop-id="1" data-iphen-id="13">※要問</td>
                <td class="nodata" data-shop-id="8" data-iphen-id="13">※要問</td>
                <td class="nodata" data-shop-id="13" data-iphen-id="13">※要問</td>
                <td class="nodata" data-shop-id="7" data-iphen-id="13">※要問</td>
                <td class="nodata" data-shop-id="9" data-iphen-id="13">※要問</td>
                <td class="nodata" data-shop-id="10" data-iphen-id="13">※要問</td>
                <td class="nodata" data-shop-id="21" data-iphen-id="13">※要問</td>
                <td class="nodata" data-shop-id="16" data-iphen-id="13">※要問</td>
                <td class="nodata" data-shop-id="18" data-iphen-id="13">※要問</td>
                <td class="nodata" data-shop-id="12" data-iphen-id="13">※要問</td>
                <td class="nodata" data-shop-id="17" data-iphen-id="13">※要問</td>
                <td class="nodata" data-shop-id="3" data-iphen-id="13">※要問</td>
                <td class="nodata" data-shop-id="4" data-iphen-id="13">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="2" data-iphen-id="13">※要問</td>#}
                <td class="nodata" data-shop-id="5" data-iphen-id="13">※要問</td>
                <td class="nodata" data-shop-id="11" data-iphen-id="13">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="6" data-iphen-id="13">※要問</td>#}
                <td class="nodata" data-shop-id="15" data-iphen-id="13">※要問</td>
                <td class="nodata" data-shop-id="20" data-iphen-id="13">※要問</td>
            </tr>
            <tr data-color="silver">
                <td style="text-align:left;">Silver</td>
                <td class="nodata" data-shop-id="14" data-iphen-id="11">※要問</td>
                <td class="nodata" data-shop-id="1" data-iphen-id="11">※要問</td>
                <td class="nodata" data-shop-id="8" data-iphen-id="11">※要問</td>
                <td class="nodata" data-shop-id="13" data-iphen-id="11">※要問</td>
                <td class="nodata" data-shop-id="7" data-iphen-id="11">※要問</td>
                <td class="nodata" data-shop-id="9" data-iphen-id="11">※要問</td>
                <td class="nodata" data-shop-id="10" data-iphen-id="11">※要問</td>
                <td class="nodata" data-shop-id="21" data-iphen-id="11">※要問</td>
                <td class="nodata" data-shop-id="16" data-iphen-id="11">※要問</td>
                <td class="nodata" data-shop-id="18" data-iphen-id="11">※要問</td>
                <td class="nodata" data-shop-id="12" data-iphen-id="11">※要問</td>
                <td class="nodata" data-shop-id="17" data-iphen-id="11">※要問</td>
                <td class="nodata" data-shop-id="3" data-iphen-id="11">※要問</td>
                <td class="nodata" data-shop-id="4" data-iphen-id="11">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="2" data-iphen-id="11">※要問</td>#}
                <td class="nodata" data-shop-id="5" data-iphen-id="11">※要問</td>
                <td class="nodata" data-shop-id="11" data-iphen-id="11">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="6" data-iphen-id="11">※要問</td>#}
                <td class="nodata" data-shop-id="15" data-iphen-id="11">※要問</td>
                <td class="nodata" data-shop-id="20" data-iphen-id="11">※要問</td>
            </tr>
            <tr>
                <td class="c"></td>

            </tr>
            <!-- 512GB -->
            <tr>
                <td class="front-num" rowspan="5" style="text-align:left;">512GB</td>
                <td class="front-num" rowspan="5" data-issue-pricing>214,800</td>
                <td class="front-num" rowspan="5"
                    data-range-shop-id="14 1 8 13 7 9 10 21 18 16 12 17 3 4 5 11 15 20"
                    data-range-iphen-id="14 15 16"
                    data-highest>
                    -
                </td>
                <td class="front-num" rowspan="5" data-diff>-</td>
                <td class="front-num" rowspan="5" data-rate>-</td>
                <td class="front-num" rowspan="5"
                    data-range-shop-id="14 1 8 13 7 9 10 21 18 16 12 17 3 4 5 11 15 20"
                    data-range-iphen-id="14 15 16"
                    data-change-from-crevious-day>-
                </td>
                <td rowspan="5" class="is-hidden front-num"
                    data-range-shop-id="14 1 8 13 7 9 10 21 18 16 12 17 3 4 5 11 15 20"
                    data-range-iphen-id="14 15 16"
                    data-average>
                    -
                </td>
            </tr>
            <tr class="avg-row" data-color="All">
                <td class="text-all" colspan="1" style="text-align:left;">ALL</td>
                <td class="nodata all-price" data-shop-id="14" data-iphen-average-id="15 16 14">※要問</td>
                <td class="nodata all-price" data-shop-id="1" data-iphen-average-id="15 16 14">※要問</td>
                <td class="nodata all-price" data-shop-id="8" data-iphen-average-id="15 16 14">※要問</td>
                <td class="nodata all-price" data-shop-id="13" data-iphen-average-id="15 16 14">※要問</td>
                <td class="nodata all-price" data-shop-id="7" data-iphen-average-id="15 16 14">※要問</td>
                <td class="nodata all-price" data-shop-id="9" data-iphen-average-id="15 16 14">※要問</td>
                <td class="nodata all-price" data-shop-id="10" data-iphen-average-id="15 16 14">※要問</td>
                <td class="nodata all-price" data-shop-id="21" data-iphen-average-id="15 16 14">※要問</td>
                <td class="nodata all-price" data-shop-id="16" data-iphen-average-id="15 16 14">※要問</td>
                <td class="nodata all-price" data-shop-id="18" data-iphen-average-id="15 16 14">※要問</td>
                <td class="nodata all-price" data-shop-id="12" data-iphen-average-id="15 16 14">※要問</td>
                <td class="nodata all-price" data-shop-id="17" data-iphen-average-id="15 16 14">※要問</td>
                <td class="nodata all-price" data-shop-id="3" data-iphen-average-id="15 16 14">※要問</td>
                <td class="nodata all-price" data-shop-id="4" data-iphen-average-id="15 16 14">※要問</td>
{#                <td class="nodata all-price" style="display: none !important;" data-shop-id="2"#}
{#                    data-iphen-average-id="15 16 14">※要問#}
{#                </td>#}
                <td class="nodata all-price" data-shop-id="5" data-iphen-average-id="15 16 14">※要問</td>
                <td class="nodata all-price" data-shop-id="11" data-iphen-average-id="15 16 14">※要問</td>
{#                <td class="nodata all-price" style="display: none !important;" data-shop-id="6"#}
{#                    data-iphen-average-id="15 16 14">※要問#}
{#                </td>#}
                <td class="nodata all-price" data-shop-id="15" data-iphen-average-id="15 16 14">※要問</td>
                <td class="nodata all-price" data-shop-id="20" data-iphen-average-id="15 16 14">※要問</td>
            </tr>
            <tr data-color="orange">
                <td style="text-align:left;">Orange</td>
                <td class="nodata" data-shop-id="14" data-iphen-id="15" data-to-marge-iphone-id="15 16 14">※要問</td>
                <td class="nodata" data-shop-id="1" data-iphen-id="15" data-to-marge-iphone-id="15 16 14">※要問</td>
                <td class="nodata" data-shop-id="8" data-iphen-id="15" data-to-marge-iphone-id="15 16 14">※要問</td>
                <td class="nodata" data-shop-id="13" data-iphen-id="15" data-to-marge-iphone-id="15 16 14">※要問</td>
                <td class="nodata" data-shop-id="7" data-iphen-id="15" data-to-marge-iphone-id="15 16 14">※要問</td>
                <td class="nodata" data-shop-id="9" data-iphen-id="15" data-to-marge-iphone-id="15 16 14">※要問</td>
                <td class="nodata" data-shop-id="10" data-iphen-id="15" data-to-marge-iphone-id="15 16 14">※要問</td>
                <td class="nodata" data-shop-id="21" data-iphen-id="15" data-to-marge-iphone-id="15 16 14">※要問</td>
                <td class="nodata" data-shop-id="16" data-iphen-id="15" data-to-marge-iphone-id="15 16 14">※要問</td>
                <td class="nodata" data-shop-id="18" data-iphen-id="15" data-to-marge-iphone-id="15 16 14">※要問</td>
                <td class="nodata" data-shop-id="12" data-iphen-id="15" data-to-marge-iphone-id="15 16 14">※要問</td>
                <td class="nodata" data-shop-id="17" data-iphen-id="15" data-to-marge-iphone-id="15 16 14">※要問</td>
                <td class="nodata" data-shop-id="3" data-iphen-id="15" data-to-marge-iphone-id="15 16 14">※要問</td>
                <td class="nodata" data-shop-id="4" data-iphen-id="15" data-to-marge-iphone-id="15 16 14">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="2" data-iphen-id="15"#}
{#                    data-to-marge-iphone-id="15 16 14">#}
{#                    ※要問#}
{#                </td>#}
                <td class="nodata" data-shop-id="5" data-iphen-id="15" data-to-marge-iphone-id="15 16 14">※要問</td>
                <td class="nodata" data-shop-id="11" data-iphen-id="15" data-to-marge-iphone-id="15 16 14">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="6" data-iphen-id="15"#}
{#                    data-to-marge-iphone-id="15 16 14">#}
{#                    ※要問#}
{#                </td>#}
                <td class="nodata" data-shop-id="15" data-iphen-id="15" data-to-marge-iphone-id="15 16 14">※要問</td>
                <td class="nodata" data-shop-id="20" data-iphen-id="15" data-to-marge-iphone-id="15 16 14">※要問</td>
            </tr>
            <tr data-color="blue">
                <td style="text-align:left;">Blue</td>
                <td class="nodata" data-shop-id="14" data-iphen-id="16">※要問</td>
                <td class="nodata" data-shop-id="1" data-iphen-id="16">※要問</td>
                <td class="nodata" data-shop-id="8" data-iphen-id="16">※要問</td>
                <td class="nodata" data-shop-id="13" data-iphen-id="16">※要問</td>
                <td class="nodata" data-shop-id="7" data-iphen-id="16">※要問</td>
                <td class="nodata" data-shop-id="9" data-iphen-id="16">※要問</td>
                <td class="nodata" data-shop-id="10" data-iphen-id="16">※要問</td>
                <td class="nodata" data-shop-id="21" data-iphen-id="16">※要問</td>
                <td class="nodata" data-shop-id="16" data-iphen-id="16">※要問</td>
                <td class="nodata" data-shop-id="18" data-iphen-id="16">※要問</td>
                <td class="nodata" data-shop-id="12" data-iphen-id="16">※要問</td>
                <td class="nodata" data-shop-id="17" data-iphen-id="16">※要問</td>
                <td class="nodata" data-shop-id="3" data-iphen-id="16">※要問</td>
                <td class="nodata" data-shop-id="4" data-iphen-id="16">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="2" data-iphen-id="16">※要問</td>#}
                <td class="nodata" data-shop-id="5" data-iphen-id="16">※要問</td>
                <td class="nodata" data-shop-id="11" data-iphen-id="16">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="6" data-iphen-id="16">※要問</td>#}
                <td class="nodata" data-shop-id="15" data-iphen-id="16">※要問</td>
                <td class="nodata" data-shop-id="20" data-iphen-id="16">※要問</td>
            </tr>
            <tr data-color="silver">
                <td style="text-align:left;">Silver</td>
                <td class="nodata" data-shop-id="14" data-iphen-id="14">※要問</td>
                <td class="nodata" data-shop-id="1" data-iphen-id="14">※要問</td>
                <td class="nodata" data-shop-id="8" data-iphen-id="14">※要問</td>
                <td class="nodata" data-shop-id="13" data-iphen-id="14">※要問</td>
                <td class="nodata" data-shop-id="7" data-iphen-id="14">※要問</td>
                <td class="nodata" data-shop-id="9" data-iphen-id="14">※要問</td>
                <td class="nodata" data-shop-id="10" data-iphen-id="14">※要問</td>
                <td class="nodata" data-shop-id="21" data-iphen-id="14">※要問</td>
                <td class="nodata" data-shop-id="16" data-iphen-id="14">※要問</td>
                <td class="nodata" data-shop-id="18" data-iphen-id="14">※要問</td>
                <td class="nodata" data-shop-id="12" data-iphen-id="14">※要問</td>
                <td class="nodata" data-shop-id="17" data-iphen-id="14">※要問</td>
                <td class="nodata" data-shop-id="3" data-iphen-id="14">※要問</td>
                <td class="nodata" data-shop-id="4" data-iphen-id="14">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="2" data-iphen-id="14">※要問</td>#}
                <td class="nodata" data-shop-id="5" data-iphen-id="14">※要問</td>
                <td class="nodata" data-shop-id="11" data-iphen-id="14">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="6" data-iphen-id="14">※要問</td>#}
                <td class="nodata" data-shop-id="15" data-iphen-id="14">※要問</td>
                <td class="nodata" data-shop-id="20" data-iphen-id="14">※要問</td>
            </tr>
            <tr>
                <td class="c"></td>

            </tr>
            <!-- 1TB -->
            <tr>
                <td class="front-num" rowspan="5" style="text-align:left;">1TB</td>
                <td class="front-num" rowspan="5" data-issue-pricing>249,800</td>
                <td class="front-num" rowspan="5"
                    data-range-shop-id="14 1 8 13 7 9 10 21 18 16 12 17 3 4 5 11 15 20"
                    data-range-iphen-id="17 18 19"
                    data-highest>
                    -
                </td>
                <td class="front-num" rowspan="5" data-diff>-</td>
                <td class="front-num" rowspan="5" data-rate>-</td>
                <td class="front-num" rowspan="5"
                    data-range-shop-id="14 1 8 13 7 9 10 21 18 16 12 17 3 4 5 11 15 20"
                    data-range-iphen-id="17 18 19"
                    data-change-from-crevious-day>-
                </td>
                <td rowspan="5" class="is-hidden front-num"
                    data-range-shop-id="14 1 8 13 7 9 10 21 18 16 12 17 3 4 5 11 15 20"
                    data-range-iphen-id="17 18 19"
                    data-average>
                    -
                </td>
            </tr>
            <tr class="avg-row" data-color="All">
                <td class="text-all" colspan="1" style="text-align:left;">ALL</td>
                <td class="nodata all-price" data-shop-id="14" data-iphen-average-id="18 19 17">※要問</td>
                <td class="nodata all-price" data-shop-id="1" data-iphen-average-id="18 19 17">※要問</td>
                <td class="nodata all-price" data-shop-id="8" data-iphen-average-id="18 19 17">※要問</td>
                <td class="nodata all-price" data-shop-id="13" data-iphen-average-id="18 19 17">※要問</td>
                <td class="nodata all-price" data-shop-id="7" data-iphen-average-id="18 19 17">※要問</td>
                <td class="nodata all-price" data-shop-id="9" data-iphen-average-id="18 19 17">※要問</td>
                <td class="nodata all-price" data-shop-id="10" data-iphen-average-id="18 19 17">※要問</td>
                <td class="nodata all-price" data-shop-id="21" data-iphen-average-id="18 19 17">※要問</td>
                <td class="nodata all-price" data-shop-id="16" data-iphen-average-id="18 19 17">※要問</td>
                <td class="nodata all-price" data-shop-id="18" data-iphen-average-id="18 19 17">※要問</td>
                <td class="nodata all-price" data-shop-id="12" data-iphen-average-id="18 19 17">※要問</td>
                <td class="nodata all-price" data-shop-id="17" data-iphen-average-id="18 19 17">※要問</td>
                <td class="nodata all-price" data-shop-id="3" data-iphen-average-id="18 19 17">※要問</td>
                <td class="nodata all-price" data-shop-id="4" data-iphen-average-id="18 19 17">※要問</td>
{#                <td class="nodata all-price" style="display: none !important;" data-shop-id="2"#}
{#                    data-iphen-average-id="18 19 17">※要問#}
{#                </td>#}
                <td class="nodata all-price" data-shop-id="5" data-iphen-average-id="18 19 17">※要問</td>
                <td class="nodata all-price" data-shop-id="11" data-iphen-average-id="18 19 17">※要問</td>
{#                <td class="nodata all-price" style="display: none !important;" data-shop-id="6"#}
{#                    data-iphen-average-id="18 19 17">※要問#}
{#                </td>#}
                <td class="nodata all-price" data-shop-id="15" data-iphen-average-id="18 19 17">※要問</td>
                <td class="nodata all-price" data-shop-id="20" data-iphen-average-id="18 19 17">※要問</td>
            </tr>
            <tr data-color="orange">
                <td style="text-align:left;">Orange</td>
                <td class="nodata" data-shop-id="14" data-iphen-id="18" data-to-marge-iphone-id="18 19 17">※要問</td>
                <td class="nodata" data-shop-id="1" data-iphen-id="18" data-to-marge-iphone-id="18 19 17">※要問</td>
                <td class="nodata" data-shop-id="8" data-iphen-id="18" data-to-marge-iphone-id="18 19 17">※要問</td>
                <td class="nodata" data-shop-id="13" data-iphen-id="18" data-to-marge-iphone-id="18 19 17">※要問</td>
                <td class="nodata" data-shop-id="7" data-iphen-id="18" data-to-marge-iphone-id="18 19 17">※要問</td>
                <td class="nodata" data-shop-id="9" data-iphen-id="18" data-to-marge-iphone-id="18 19 17">※要問</td>
                <td class="nodata" data-shop-id="10" data-iphen-id="18" data-to-marge-iphone-id="18 19 17">※要問</td>
                <td class="nodata" data-shop-id="21" data-iphen-id="18" data-to-marge-iphone-id="18 19 17">※要問</td>
                <td class="nodata" data-shop-id="16" data-iphen-id="18" data-to-marge-iphone-id="18 19 17">※要問</td>
                <td class="nodata" data-shop-id="18" data-iphen-id="18" data-to-marge-iphone-id="18 19 17">※要問</td>
                <td class="nodata" data-shop-id="12" data-iphen-id="18" data-to-marge-iphone-id="18 19 17">※要問</td>
                <td class="nodata" data-shop-id="17" data-iphen-id="18" data-to-marge-iphone-id="18 19 17">※要問</td>
                <td class="nodata" data-shop-id="3" data-iphen-id="18" data-to-marge-iphone-id="18 19 17">※要問</td>
                <td class="nodata" data-shop-id="4" data-iphen-id="18" data-to-marge-iphone-id="18 19 17">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="2" data-iphen-id="18"#}
{#                    data-to-marge-iphone-id="18 19 17">#}
{#                    ※要問#}
{#                </td>#}
                <td class="nodata" data-shop-id="5" data-iphen-id="18" data-to-marge-iphone-id="18 19 17">※要問</td>
                <td class="nodata" data-shop-id="11" data-iphen-id="18" data-to-marge-iphone-id="18 19 17">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="6" data-iphen-id="18"#}
{#                    data-to-marge-iphone-id="18 19 17">#}
{#                    ※要問#}
{#                </td>#}
                <td class="nodata" data-shop-id="15" data-iphen-id="18" data-to-marge-iphone-id="18 19 17">※要問</td>
                <td class="nodata" data-shop-id="20" data-iphen-id="18" data-to-marge-iphone-id="18 19 17">※要問</td>
            </tr>
            <tr data-color="blue">
                <td style="text-align:left;">Blue</td>
                <td class="nodata" data-shop-id="14" data-iphen-id="19">※要問</td>
                <td class="nodata" data-shop-id="1" data-iphen-id="19">※要問</td>
                <td class="nodata" data-shop-id="8" data-iphen-id="19">※要問</td>
                <td class="nodata" data-shop-id="13" data-iphen-id="19">※要問</td>
                <td class="nodata" data-shop-id="7" data-iphen-id="19">※要問</td>
                <td class="nodata" data-shop-id="9" data-iphen-id="19">※要問</td>
                <td class="nodata" data-shop-id="10" data-iphen-id="19">※要問</td>
                <td class="nodata" data-shop-id="21" data-iphen-id="19">※要問</td>
                <td class="nodata" data-shop-id="16" data-iphen-id="19">※要問</td>
                <td class="nodata" data-shop-id="18" data-iphen-id="19">※要問</td>
                <td class="nodata" data-shop-id="12" data-iphen-id="19">※要問</td>
                <td class="nodata" data-shop-id="17" data-iphen-id="19">※要問</td>
                <td class="nodata" data-shop-id="3" data-iphen-id="19">※要問</td>
                <td class="nodata" data-shop-id="4" data-iphen-id="19">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="2" data-iphen-id="19">※要問</td>#}
                <td class="nodata" data-shop-id="5" data-iphen-id="19">※要問</td>
                <td class="nodata" data-shop-id="11" data-iphen-id="19">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="6" data-iphen-id="19">※要問</td>#}
                <td class="nodata" data-shop-id="15" data-iphen-id="19">※要問</td>
                <td class="nodata" data-shop-id="20" data-iphen-id="19">※要問</td>
            </tr>
            <tr data-color="silver">
                <td style="text-align:left;">Silver</td>
                <td class="nodata" data-shop-id="14" data-iphen-id="17">※要問</td>
                <td class="nodata" data-shop-id="1" data-iphen-id="17">※要問</td>
                <td class="nodata" data-shop-id="8" data-iphen-id="17">※要問</td>
                <td class="nodata" data-shop-id="13" data-iphen-id="17">※要問</td>
                <td class="nodata" data-shop-id="7" data-iphen-id="17">※要問</td>
                <td class="nodata" data-shop-id="9" data-iphen-id="17">※要問</td>
                <td class="nodata" data-shop-id="10" data-iphen-id="17">※要問</td>
                <td class="nodata" data-shop-id="21" data-iphen-id="17">※要問</td>
                <td class="nodata" data-shop-id="16" data-iphen-id="17">※要問</td>
                <td class="nodata" data-shop-id="18" data-iphen-id="17">※要問</td>
                <td class="nodata" data-shop-id="12" data-iphen-id="17">※要問</td>
                <td class="nodata" data-shop-id="17" data-iphen-id="17">※要問</td>
                <td class="nodata" data-shop-id="3" data-iphen-id="17">※要問</td>
                <td class="nodata" data-shop-id="4" data-iphen-id="17">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="2" data-iphen-id="17">※要問</td>#}
                <td class="nodata" data-shop-id="5" data-iphen-id="17">※要問</td>
                <td class="nodata" data-shop-id="11" data-iphen-id="17">※要問</td>
{#                <td class="nodata" style="display: none !important;" data-shop-id="6" data-iphen-id="17">※要問</td>#}
                <td class="nodata" data-shop-id="15" data-iphen-id="17">※要問</td>
                <td class="nodata" data-shop-id="20" data-iphen-id="17">※要問</td>
            </tr>
            </tbody>
        </table>
    </div>

    <div class="model-gap"></div>


    <!-- ================= iPhone Air ================= -->
    <div class="model-section">
        <!--       <div class="model-header">iPhone Air</div> -->
        <table>
            <thead class="thead-zero">
            <tr>
                <th class="col-model">機種</th>
                <th class="col-capacity">容量</th>
                <th class="col-num">定価</th>
                <th class="col-num">最高</th>
                　
                <th class="col-num">差額</th>
                <th class="col-num">買取率</th>
                <th class="col-num  is-hidden">平均値</th>
                <th class="col-num">前日比</th>
                <th class="col-color">カラー</th>
                <!-- Stores -->
                <th class="shop-col shop-head shop-買取商店">買取商店</th>
                <th class="shop-col shop-head shop-海峡通信">海峡通信</th>
                <th class="shop-col shop-head shop-買取１丁目">買取１丁目</th>
                <th class="shop-col shop-head shop-モバイルミックス">モバイルミックス</th>
                <th class="shop-col shop-head shop-森森買取">森森買取</th>
                <th class="shop-col shop-head shop-買取ルデヤ">買取ルデヤ</th>
                <th class="shop-col shop-head shop-買取Wiki">買取Wiki</th>
                <th class="shop-col shop-head shop-買取ホムラ">買取ホムラ</th>
                <th class="shop-col shop-head shop-ドラゴンモバイル-">ドラゴンモバイル-</th>
                <th class="shop-col shop-head shop-モバステ-">モバステ-</th>
                <th class="shop-col shop-head shop-アキモバ-">アキモバ-</th>
                <th class="shop-col shop-head shop-トゥインクル">トゥインクル</th>
                <th class="shop-col shop-head shop-家電市場">家電市場</th>
                <th class="shop-col shop-head shop-買取楽園">買取楽園</th>
{#                <th class="shop-col shop-head shop-買取当番">買取当番</th>#}
                <th class="shop-col shop-head shop-携帯空間">携帯空間</th>
                <th class="shop-col shop-head shop-ゲストモバイル">ゲストモバイル</th>
{#                <th class="shop-col shop-head shop-買取オク">買取オク</th>#}
                <th class="shop-col shop-head shop-毎日買取">毎日買取</th>
                <th class="shop-col shop-head shop-MobileZone">Mobile Zone</th>
            </tr>
            </thead>

            <tbody>
            <tr>

                <td class="front-name" rowspan="3" style="text-align: center;">Air</td>
                <td class="front-num" style="text-align:left;">256GB</td>
                <td class="front-num" rowspan="1" data-issue-pricing>159,800</td>
                <td class="front-num" rowspan="1"
                    data-range-shop-id="14 1 8 13 7 9 10 21 18 16 12 17 3 4 5 11 15 20"
                    data-range-iphen-id="32 33 34 35"
                    data-highest>
                    -
                </td>
                <td class="front-num" rowspan="1" data-diff>-</td>
                <td class="front-num" rowspan="1" data-rate>-</td>
                <td class="front-num" rowspan="1"
                    data-range-shop-id="14 1 8 13 7 9 10 21 18 16 12 17 3 4 5 11 15 20"
                    data-range-iphen-id="32 33 34 35"
                    data-change-from-crevious-day>-
                </td>
                <td rowspan="1" class="is-hidden front-num"
                    data-range-shop-id="14 1 8 13 7 9 10 21 18 16 12 17 3 4 5 11 15 20"
                    data-range-iphen-id="32 33 34 35"
                    data-average>
                    -
                </td>
                <td class="text-all" style="text-align:left;">ALL</td>
                <td class="nodata all-price" data-shop-id="14" data-iphen-average-id="32 33 34 35">※要問</td>
                <td class="nodata all-price" data-shop-id="1" data-iphen-average-id="32 33 34 35">※要問</td>
                <td class="nodata all-price" data-shop-id="8" data-iphen-average-id="32 33 34 35">※要問</td>
                <td class="nodata all-price" data-shop-id="13" data-iphen-average-id="32 33 34 35">※要問</td>
                <td class="nodata all-price" data-shop-id="7" data-iphen-average-id="32 33 34 35">※要問</td>
                <td class="nodata all-price" data-shop-id="9" data-iphen-average-id="32 33 34 35">※要問</td>
                <td class="nodata all-price" data-shop-id="10" data-iphen-average-id="32 33 34 35">※要問</td>
                <td class="nodata all-price" data-shop-id="21" data-iphen-average-id="32 33 34 35">※要問</td>
                <td class="nodata all-price" data-shop-id="16" data-iphen-average-id="32 33 34 35">※要問</td>
                <td class="nodata all-price" data-shop-id="18" data-iphen-average-id="32 33 34 35">※要問</td>
                <td class="nodata all-price" data-shop-id="12" data-iphen-average-id="32 33 34 35">※要問</td>
                <td class="nodata all-price" data-shop-id="17" data-iphen-average-id="32 33 34 35">※要問</td>
                <td class="nodata all-price" data-shop-id="3" data-iphen-average-id="32 33 34 35">※要問</td>
                <td class="nodata all-price" data-shop-id="4" data-iphen-average-id="32 33 34 35">※要問</td>
{#                <td class="nodata all-price" style="display: none !important;" data-shop-id="2"#}
{#                    data-iphen-average-id="32 33 34 35">※要問#}
{#                </td>#}
                <td class="nodata all-price" data-shop-id="5" data-iphen-average-id="32 33 34 35">※要問</td>
                <td class="nodata all-price" data-shop-id="11" data-iphen-average-id="32 33 34 35">※要問</td>
{#                <td class="nodata all-price" style="display: none !important;" data-shop-id="6"#}
{#                    data-iphen-average-id="32 33 34 35">※要問#}
{#                </td>#}
                <td class="nodata all-price" data-shop-id="15" data-iphen-average-id="32 33 34 35">※要問</td>
                <td class="nodata all-price" data-shop-id="20" data-iphen-average-id="32 33 34 35">※要問</td>
            </tr>

            <tr>
                <td class="front-num" style="text-align:left;">512GB</td>
                <td class="front-num" rowspan="1" data-issue-pricing>194,800</td>
                <td class="front-num" rowspan="1"
                    data-range-shop-id="14 1 8 13 7 9 10 21 18 16 12 17 3 4 5 11 15 20"
                    data-range-iphen-id="36 37 38 39"
                    data-highest>
                    -
                </td>
                <td class="front-num" rowspan="1" data-diff>-</td>
                <td class="front-num" rowspan="1" data-rate>-</td>
                <td class="front-num" rowspan="1"
                    data-range-shop-id="14 1 8 13 7 9 10 21 18 16 12 17 3 4 5 11 15 20"
                    data-range-iphen-id="36 37 38 39"
                    data-change-from-crevious-day>-
                </td>
                <td rowspan="1" class="is-hidden front-num"
                    data-range-shop-id="14 1 8 13 7 9 10 21 18 16 12 17 3 4 5 11 15 20"
                    data-range-iphen-id="36 37 38 39"
                    data-average>
                    -
                </td>
                <td class="text-all" style="text-align:left;">ALL</td>
                <td class="nodata all-price" data-shop-id="14" data-iphen-average-id="36 37 38 39">※要問</td>
                <td class="nodata all-price" data-shop-id="1" data-iphen-average-id="36 37 38 39">※要問</td>
                <td class="nodata all-price" data-shop-id="8" data-iphen-average-id="36 37 38 39">※要問</td>
                <td class="nodata all-price" data-shop-id="13" data-iphen-average-id="36 37 38 39">※要問</td>
                <td class="nodata all-price" data-shop-id="7" data-iphen-average-id="36 37 38 39">※要問</td>
                <td class="nodata all-price" data-shop-id="9" data-iphen-average-id="36 37 38 39">※要問</td>
                <td class="nodata all-price" data-shop-id="10" data-iphen-average-id="36 37 38 39">※要問</td>
                <td class="nodata all-price" data-shop-id="21" data-iphen-average-id="36 37 38 39">※要問</td>
                <td class="nodata all-price" data-shop-id="16" data-iphen-average-id="36 37 38 39">※要問</td>
                <td class="nodata all-price" data-shop-id="18" data-iphen-average-id="36 37 38 39">※要問</td>
                <td class="nodata all-price" data-shop-id="12" data-iphen-average-id="36 37 38 39">※要問</td>
                <td class="nodata all-price" data-shop-id="17" data-iphen-average-id="36 37 38 39">※要問</td>
                <td class="nodata all-price" data-shop-id="3" data-iphen-average-id="36 37 38 39">※要問</td>
                <td class="nodata all-price" data-shop-id="4" data-iphen-average-id="36 37 38 39">※要問</td>
{#                <td class="nodata all-price" style="display: none !important;" data-shop-id="2"#}
{#                    data-iphen-average-id="36 37 38 39">※要問#}
{#                </td>#}
                <td class="nodata all-price" data-shop-id="5" data-iphen-average-id="36 37 38 39">※要問</td>
                <td class="nodata all-price" data-shop-id="11" data-iphen-average-id="36 37 38 39">※要問</td>
{#                <td class="nodata all-price" style="display: none !important;" data-shop-id="6"#}
{#                    data-iphen-average-id="36 37 38 39">※要問#}
{#                </td>#}
                <td class="nodata all-price" data-shop-id="15" data-iphen-average-id="36 37 38 39">※要問</td>
                <td class="nodata all-price" data-shop-id="20" data-iphen-average-id="36 37 38 39">※要問</td>
            </tr>

            <tr>
                <td class="front-num" style="text-align:left;">1T</td>
                <td class="front-num" rowspan="1" data-issue-pricing>229,800</td>
                <td class="front-num" rowspan="1"
                    data-range-shop-id="14 1 8 13 7 9 10 21 18 16 12 17 3 4 5 11 15 20"
                    data-range-iphen-id="40 41 42 43"
                    data-highest>
                    -
                </td>
                <td class="front-num" rowspan="1" data-diff>-</td>
                <td class="front-num" rowspan="1" data-rate>-</td>
                <td class="front-num" rowspan="1"
                    data-range-shop-id="14 1 8 13 7 9 10 21 18 16 12 17 3 4 5 11 15 20"
                    data-range-iphen-id="40 41 42 43"
                    data-change-from-crevious-day>-
                </td>
                <td rowspan="1" class="is-hidden front-num"
                    data-range-shop-id="14 1 8 13 7 9 10 21 18 16 12 17 3 4 5 11 15 20"
                    data-range-iphen-id="40 41 42 43"
                    data-average>
                    -
                </td>
                <td class="text-all" style="text-align:left;">ALL</td>
                <td class="nodata all-price" data-shop-id="14" data-iphen-average-id="40 41 42 43">※要問</td>
                <td class="nodata all-price" data-shop-id="1" data-iphen-average-id="40 41 42 43">※要問</td>
                <td class="nodata all-price" data-shop-id="8" data-iphen-average-id="40 41 42 43">※要問</td>
                <td class="nodata all-price" data-shop-id="13" data-iphen-average-id="40 41 42 43">※要問</td>
                <td class="nodata all-price" data-shop-id="7" data-iphen-average-id="40 41 42 43">※要問</td>
                <td class="nodata all-price" data-shop-id="9" data-iphen-average-id="40 41 42 43">※要問</td>
                <td class="nodata all-price" data-shop-id="10" data-iphen-average-id="40 41 42 43">※要問</td>
                <td class="nodata all-price" data-shop-id="21" data-iphen-average-id="40 41 42 43">※要問</td>
                <td class="nodata all-price" data-shop-id="16" data-iphen-average-id="40 41 42 43">※要問</td>
                <td class="nodata all-price" data-shop-id="18" data-iphen-average-id="40 41 42 43">※要問</td>
                <td class="nodata all-price" data-shop-id="12" data-iphen-average-id="40 41 42 43">※要問</td>
                <td class="nodata all-price" data-shop-id="17" data-iphen-average-id="40 41 42 43">※要問</td>
                <td class="nodata all-price" data-shop-id="3" data-iphen-average-id="40 41 42 43">※要問</td>
                <td class="nodata all-price" data-shop-id="4" data-iphen-average-id="40 41 42 43">※要問</td>
{#                <td class="nodata all-price" style="display: none !important;" data-shop-id="2"#}
{#                    data-iphen-average-id="40 41 42 43">※要問#}
{#                </td>#}
                <td class="nodata all-price" data-shop-id="5" data-iphen-average-id="40 41 42 43">※要問</td>
                <td class="nodata all-price" data-shop-id="11" data-iphen-average-id="40 41 42 43">※要問</td>
{#                <td class="nodata all-price" style="display: none !important;" data-shop-id="6"#}
{#                    data-iphen-average-id="40 41 42 43">※要問#}
{#                </td>#}
                <td class="nodata all-price" data-shop-id="15" data-iphen-average-id="40 41 42 43">※要問</td>
                <td class="nodata all-price" data-shop-id="20" data-iphen-average-id="40 41 42 43">※要問</td>
            </tr>


            </tbody>
        </table>
    </div>

    <!-- ================= iPhone 17 ================= -->
    <div class="model-section">
        <!--       <div class="model-header">iPhone 17</div> -->
        <table>
            <thead class="thead-zero">
            <tr>
                <th class="col-model">機種</th>
                <th class="col-capacity">容量</th>
                <th class="col-num">定価</th>
                <th class="col-num">最高</th>
                　
                <th class="col-num">差額</th>
                <th class="col-num">買取率</th>
                <th class="col-num is-hidden">平均値</th>
                <th class="col-num">前日比</th>
                <th class="col-color">カラー</th>
                <!-- Stores -->
                <th class="shop-col shop-head shop-買取商店">買取商店</th>
                <th class="shop-col shop-head shop-海峡通信">海峡通信</th>
                <th class="shop-col shop-head shop-買取１丁目">買取１丁目</th>
                <th class="shop-col shop-head shop-モバイルミックス">モバイルミックス</th>
                <th class="shop-col shop-head shop-森森買取">森森買取</th>
                <th class="shop-col shop-head shop-買取ルデヤ">買取ルデヤ</th>
                <th class="shop-col shop-head shop-買取Wiki">買取Wiki</th>
                <th class="shop-col shop-head shop-買取ホムラ">買取ホムラ</th>
                <th class="shop-col shop-head shop-ドラゴンモバイル-">ドラゴンモバイル-</th>
                <th class="shop-col shop-head shop-モバステ-">モバステ-</th>
                <th class="shop-col shop-head shop-アキモバ-">アキモバ-</th>
                <th class="shop-col shop-head shop-トゥインクル">トゥインクル</th>
                <th class="shop-col shop-head shop-家電市場">家電市場</th>
                <th class="shop-col shop-head shop-買取楽園">買取楽園</th>
{#                <th class="shop-col shop-head shop-買取当番">買取当番</th>#}
                <th class="shop-col shop-head shop-携帯空間">携帯空間</th>
                <th class="shop-col shop-head shop-ゲストモバイル">ゲストモバイル</th>
{#                <th class="shop-col shop-head shop-買取オク">買取オク</th>#}
                <th class="shop-col shop-head shop-毎日買取">毎日買取</th>
                <th class="shop-col shop-head shop-MobileZone">Mobile Zone</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td class="front-name" rowspan="2" style="text-align: center;">17</td>
                <td class="front-num" style="text-align:left;">256GB</td>
                <td class="front-num" rowspan="1" data-issue-pricing>129,800</td>
                <td class="front-num" rowspan="1"
                    data-range-shop-id="14 1 8 13 7 9 10 21 18 16 12 17 3 4 5 11 15 20"
                    data-range-iphen-id="1 2 3 4 5"
                    data-highest>
                    -
                </td>
                <td class="front-num" rowspan="1" data-diff>-</td>
                <td class="front-num" rowspan="1" data-rate>-</td>
                <td class="front-num" rowspan="1"
                    data-range-shop-id="14 1 8 13 7 9 10 21 18 16 12 17 3 4 5 11 15 20"
                    data-range-iphen-id="1 2 3 4 5"
                    data-change-from-crevious-day>-
                </td>
                <td rowspan="1" class="is-hidden front-num"
                    data-range-shop-id="14 1 8 13 7 9 10 21 18 16 12 17 3 4 5 11 15 20"
                    data-range-iphen-id="1 2 3 4 5"
                    data-average>
                    -
                </td>

                <td class="text-all" style="text-align:left;">ALL</td>
                <td class="nodata all-price" data-shop-id="14" data-iphen-average-id="1 2 3 4 5">※要問</td>
                <td class="nodata all-price" data-shop-id="1" data-iphen-average-id="1 2 3 4 5">※要問</td>
                <td class="nodata all-price" data-shop-id="8" data-iphen-average-id="1 2 3 4 5">※要問</td>
                <td class="nodata all-price" data-shop-id="13" data-iphen-average-id="1 2 3 4 5">※要問</td>
                <td class="nodata all-price" data-shop-id="7" data-iphen-average-id="1 2 3 4 5">※要問</td>
                <td class="nodata all-price" data-shop-id="9" data-iphen-average-id="1 2 3 4 5">※要問</td>
                <td class="nodata all-price" data-shop-id="10" data-iphen-average-id="1 2 3 4 5">※要問</td>
                <td class="nodata all-price" data-shop-id="21" data-iphen-average-id="1 2 3 4 5">※要問</td>
                <td class="nodata all-price" data-shop-id="16" data-iphen-average-id="1 2 3 4 5">※要問</td>
                <td class="nodata all-price" data-shop-id="18" data-iphen-average-id="1 2 3 4 5">※要問</td>
                <td class="nodata all-price" data-shop-id="12" data-iphen-average-id="1 2 3 4 5">※要問</td>
                <td class="nodata all-price" data-shop-id="17" data-iphen-average-id="1 2 3 4 5">※要問</td>
                <td class="nodata all-price" data-shop-id="3" data-iphen-average-id="1 2 3 4 5">※要問</td>
                <td class="nodata all-price" data-shop-id="4" data-iphen-average-id="1 2 3 4 5">※要問</td>
{#                <td class="nodata all-price" style="display: none !important;" data-shop-id="2"#}
{#                    data-iphen-average-id="1 2 3 4 5">※要問#}
{#                </td>#}
                <td class="nodata all-price" data-shop-id="5" data-iphen-average-id="1 2 3 4 5">※要問</td>
                <td class="nodata all-price" data-shop-id="11" data-iphen-average-id="1 2 3 4 5">※要問</td>
{#                <td class="nodata all-price" style="display: none !important;" data-shop-id="6"#}
{#                    data-iphen-average-id="1 2 3 4 5">※要問#}
{#                </td>#}
                <td class="nodata all-price" data-shop-id="15" data-iphen-average-id="1 2 3 4 5">※要問</td>
                <td class="nodata all-price" data-shop-id="20" data-iphen-average-id="1 2 3 4 5">※要問</td>
            </tr>

            <tr>
                <td class="front-num" style="text-align:left;">512GB</td>
                <td class="front-num" rowspan="1" data-issue-pricing>164,800</td>
                <td class="front-num" rowspan="1"
                    data-range-shop-id="14 1 8 13 7 9 10 21 18 16 12 17 3 4 5 11 15 20"
                    data-range-iphen-id="6 7 8 9 10"
                    data-highest>
                    -
                </td>
                <td class="front-num" rowspan="1" data-diff>-</td>
                <td class="front-num" rowspan="1" data-rate>-</td>
                <td class="front-num" rowspan="1"
                    data-range-shop-id="14 1 8 13 7 9 10 21 18 16 12 17 3 4 5 11 15 20"
                    data-range-iphen-id="6 7 8 9 10"
                    data-change-from-crevious-day>-
                </td>
                <td rowspan="1" class="is-hidden front-num"
                    data-range-shop-id="14 1 8 13 7 9 10 21 18 16 12 17 3 4 5 11 15 20"
                    data-range-iphen-id="6 7 8 9 10"
                    data-average>
                    -
                </td>
                <td class="text-all" style="text-align:left;">ALL</td>
                <td class="nodata all-price" data-shop-id="14" data-iphen-average-id="6 7 8 9 10">※要問</td>
                <td class="nodata all-price" data-shop-id="1" data-iphen-average-id="6 7 8 9 10">※要問</td>
                <td class="nodata all-price" data-shop-id="8" data-iphen-average-id="6 7 8 9 10">※要問</td>
                <td class="nodata all-price" data-shop-id="13" data-iphen-average-id="6 7 8 9 10">※要問</td>
                <td class="nodata all-price" data-shop-id="7" data-iphen-average-id="6 7 8 9 10">※要問</td>
                <td class="nodata all-price" data-shop-id="9" data-iphen-average-id="6 7 8 9 10">※要問</td>
                <td class="nodata all-price" data-shop-id="10" data-iphen-average-id="6 7 8 9 10">※要問</td>
                <td class="nodata all-price" data-shop-id="21" data-iphen-average-id="6 7 8 9 10">※要問</td>
                <td class="nodata all-price" data-shop-id="16" data-iphen-average-id="6 7 8 9 10">※要問</td>
                <td class="nodata all-price" data-shop-id="18" data-iphen-average-id="6 7 8 9 10">※要問</td>
                <td class="nodata all-price" data-shop-id="12" data-iphen-average-id="6 7 8 9 10">※要問</td>
                <td class="nodata all-price" data-shop-id="17" data-iphen-average-id="6 7 8 9 10">※要問</td>
                <td class="nodata all-price" data-shop-id="3" data-iphen-average-id="6 7 8 9 10">※要問</td>
                <td class="nodata all-price" data-shop-id="4" data-iphen-average-id="6 7 8 9 10">※要問</td>
{#                <td class="nodata all-price" style="display: none !important;" data-shop-id="2"#}
{#                    data-iphen-average-id="6 7 8 9 10">※要問#}
{#                </td>#}
                <td class="nodata all-price" data-shop-id="5" data-iphen-average-id="6 7 8 9 10">※要問</td>
                <td class="nodata all-price" data-shop-id="11" data-iphen-average-id="6 7 8 9 10">※要問</td>
{#                <td class="nodata all-price" style="display: none !important;" data-shop-id="6"#}
{#                    data-iphen-average-id="6 7 8 9 10">※要問#}
{#                </td>#}
                <td class="nodata all-price" data-shop-id="15" data-iphen-average-id="6 7 8 9 10">※要問</td>
                <td class="nodata all-price" data-shop-id="20" data-iphen-average-id="6 7 8 9 10">※要問</td>
            </tr>

            <tr>
                <td class="dc"></td>
                <td class="dc"></td>
                <td class="dc"></td>
                <td class="dc"></td>
                <td class="dc"></td>
                <td class="dc"></td>
                <td class="dc"></td>
                <td class="dc"></td>
                <td class="dc"></td>
                <td class="dc"></td>
                <td class="dc"></td>
                <td class="dc"></td>
                <td class="dc"></td>
                <td class="dc"></td>
                <td class="dc"></td>
                <td class="dc"></td>
                <td class="dc"></td>
                <td class="dc"></td>
                <td class="dc"></td>
                <td class="dc"></td>
                <td class="dc"></td>
                <td class="dc" colspan="5">※データの正確性、および完全性は保証致しません。</td>

            </tr>

            </tbody>
        </table>
    </div>

    <div class="model-gap"></div>


</div>
<details style="margin:30px">
    <summary class="muted">店舗ごとの件数／フィルタ後件数／開始・終了時刻）</summary>
</details>
<script>
    (() => {
        const BASE_LINE_PRICE = 10000
        const SHOP_COLOR_RULES = [
            {match: /買取商店/, color: "#DD1133", shop_id: 14, order: 1},
            {match: /海峡通信/, color: "#478CD8", shop_id: 1, order: 2},
            {match: /買取一丁目/, color: "#B41524", shop_id: 8, order: 3},
            {match: /モバイルミックス/, color: "#DD1133", shop_id: 13, order: 4},
            {match: /森森買取/, color: "#278C46", shop_id: 7, order: 5},
            {match: /買取ルデヤ/, color: "#2DA9E8", shop_id: 9, order: 6},
            {match: /買取wiki/, color: "#E71534", shop_id: 10, order: 7},
            {match: /買取ホムラ/, color: "#F27474", shop_id: 21, order: 8},
            {match: /ドラゴンモバイル/, color: "#3952A6", shop_id: 16, order: 9},
            {match: /モバステ/, color: "#E60012", shop_id: 18, order: 10},
            {match: /アキモバ/, color: "#20AECC", shop_id: 12, order: 11},
            {match: /トゥインクル/, color: "#0EC7D9", shop_id: 17, order: 12},
            {match: /家電市場/, color: "#FFF100", shop_id: 3, order: 13},
            {match: /買取楽園/, color: "#DA7C66", shop_id: 4, order: 14},
            {match: /買取当番/, color: "#1C4473", shop_id: 2, order: 15},
            {match: /携帯空間/, color: "#0049A8", shop_id: 5, order: 16},
            {match: /ゲストモバイル/, color: "#34C6F6", shop_id: 11, order: 17},
            {match: /買取オク/, color: "#033F68", shop_id: 6, order: 18},
            {match: /毎日買取/, color: "#C30D23", shop_id: 15, order: 19},
            {match: /Mobile Zone/, color: "#f50620", shop_id: 20, order: 20},
        ];

        const API_BASE = '/AppleStockChecker';
        const ENDPOINT_SHOPS = `${API_BASE}/secondhand-shops/`;
        const SHOPS_INDEX = new Map(); // shopId -> shopName

        // ---------- Helpers ----------
        const $id = (id) => document.getElementById(id);
        const $q = (sel, root = document) => root.querySelector(sel);
        const $qa = (sel, root = document) => Array.from(root.querySelectorAll(sel));

        (function injectStyles() {
            if ($id('psta-row-styles')) return;
            const css = `
      .psta-max   { background:#00ff00 !important; color:#b42318 !important; } /* 最高：绿底+红字 */
      .psta-min   { color:#b42318 !important; }                                 /* 最低：红字 */
      .psta-close { background:#00ff00 !important; }                             /* 最接近平均：绿底 */
      .is-hidden  { display:none !important; }                                   /* 列隐藏 */
    `;
            const style = document.createElement('style');
            style.id = 'psta-row-styles';
            style.textContent = css;
            document.head.appendChild(style);
        })();

        // ---------- 服务器ID -> 本地ID（可选映射） ----------
        const SERVER_TO_LOCAL_SHOP = {
            7: 11, 10: 12, 16: 13, 12: 14, 21: 15, 9: 16, 8: 17, 1: 18,
            14: 21, 18: 20, 17: 21, 4: 22, 2: 23, 5: 24, 11: 25, 6: 26,
            15: 27, 13: 28
        };
        const SERVER_TO_LOCAL_IPHEN = {
            1: 143, 2: 144, 3: 145, 4: 146, 5: 147, 6: 148, 7: 149, 8: 150, 9: 151, 10: 152,
            11: 153, 12: 154, 13: 155, 14: 156, 15: 157, 16: 158, 17: 159, 18: 160, 19: 161, 20: 162,
            21: 163, 22: 164, 23: 165, 24: 166, 25: 167, 26: 168, 27: 169, 28: 170, 29: 171, 30: 172,
            31: 173, 32: 174, 33: 175, 34: 176, 35: 177, 36: 178, 37: 179, 38: 180, 39: 181, 40: 182,
            41: 183, 42: 184, 43: 185
        };


        function resetPageToInitialState() {
            try {
                // 1) 移除极值类
                document.querySelectorAll('.psta-max, .psta-min, .psta-close').forEach(el => {
                    el.classList.remove('psta-max', 'psta-min', 'psta-close');
                });

                // 2) 恢复隐藏列的表头和单元格
                document.querySelectorAll('.is-hidden').forEach(el => el.classList.remove('is-hidden'));

                // 3) 删除我们自动插入的 spacer 行（如果存在）
                document.querySelectorAll('tr.group-gap').forEach(tr => tr.remove());

                // 4) 恢复替换文本（优先 data-orig-text）
                document.querySelectorAll('td[data-orig-text]').forEach(td => {
                    td.textContent = td.dataset.origText;
                    delete td.dataset.origText;
                });

                // 5) 对于店铺数据格，重置 dataset.v / nodata / replaced / 样式
                const shopCells = document.querySelectorAll('td[data-shop-id][data-iphen-id], td[data-shop-id][data-iphen-average-id], td[data-shop-id][iphen-average-id]');
                shopCells.forEach(td => {
                    // 优先还原初始文本（如果你在渲染初始表时保存了 data-initial-text）
                    if (td.dataset.initialText != null) {
                        td.textContent = td.dataset.initialText;
                    } else if (td.dataset.origText != null) {
                        td.textContent = td.dataset.origText;
                    } else {
                        // 若没有原始备份则用占位（根据你的页面初始样式调整）
                        td.textContent = '-';
                    }

                    // 清理所有运行时标记
                    delete td.dataset.v;
                    td.classList.remove('nodata');
                    td.style.color = '';
                    td.style.background = '';
                    td.style.fontWeight = '';
                    td.removeAttribute('rowspan'); // 若某些单元格被改了 rowspan，谨慎移除（视情况保留）
                    // 如果你有自定义 data-replaced 等，也清除
                    delete td.dataset.replaced;
                    delete td.dataset.hidden;
                });

                // 6) 清理统计 / 行级单元格（data-highest, data-average, data-diff, data-rate, data-change-from-crevious-day）
                document.querySelectorAll('td[data-highest], td[data-average], td[data-diff], td[data-rate], td[data-change-from-crevious-day]').forEach(td => {
                    td.textContent = '-';
                    delete td.dataset.v;
                    td.style.color = '';
                });

                // 7) 恢复 updated/caption/main title（按需）
                const updatedAtEl = document.getElementById('updated-at');
                if (updatedAtEl) updatedAtEl.textContent = '';

                const caption = document.getElementById('range-caption');
                if (caption) caption.textContent = '';

                // 如果你希望把主标题恢复为页面加载时的值，需要事先保存 originalMainTitle（参见下）
                if (window._psta_original_main_title) {
                    const mt = document.getElementById('main-title') ||
                        Array.from(document.querySelectorAll('h4')).find(h => /買取相場/.test(h.textContent));
                    if (mt) mt.textContent = window._psta_original_main_title;
                }

                // 8) 还原任何被 hide/replace 的列（兜底函数）
                if (typeof window.restoreAllShopColumns === 'function') {
                    try {
                        window.restoreAllShopColumns();
                    } catch (e) { /* ignore */
                    }
                }
                if (typeof window.restoreReplacedTexts === 'function') {
                    try {
                        window.restoreReplacedTexts();
                    } catch (e) { /* ignore */
                    }
                }

                {#console.log('[PSTA] page reset to initial state.');#}
            } catch (err) {
                console.warn('[PSTA] resetPageToInitialState error:', err);
            }
        }


        function restoreMergedColorRows() {
            try {
                // 1) 恢复所有被标记为合并源的单元格（repTd）
                document.querySelectorAll('td[data-to-marge-iphone-id][data-merged="1"]').forEach(repTd => {
                    // 移除 merged 标志并还原 rowspan / 文本等
                    repTd.removeAttribute('data-merged');
                    if (repTd.hasAttribute('rowspan')) {
                        try {
                            repTd.removeAttribute('rowspan');
                        } catch (e) {
                        }
                    }
                    // 若存在备份原文则还原
                    if (repTd.dataset.origText != null) {
                        repTd.textContent = repTd.dataset.origText;
                        delete repTd.dataset.origText;
                    } else if (repTd.dataset.initialText != null) {
                        repTd.textContent = repTd.dataset.initialText;
                    }
                    // 清理值标记（可选）
                    delete repTd.dataset.v;
                    repTd.classList.remove('nodata');
                    repTd.style.background = '';
                    repTd.style.color = '';
                    repTd.style.fontWeight = '';
                });

                // 2) 恢复所有被隐藏的单元格（兼容 is-hidden / aria-hidden）
                // 只恢复那些可能是 merge 时隐藏的店铺格（通过 data-shop-id/data-iphen-id 判断）
                const hiddenSelector = 'td.is-hidden[aria-hidden="true"], td.is-hidden, td[aria-hidden="true"]';
                document.querySelectorAll(hiddenSelector).forEach(td => {
                    // 仅针对具备 shop/iphon 标志的单元格进行复原，避免误操作其他隐藏元素
                    if (!td.hasAttribute('data-shop-id') && !td.hasAttribute('data-iphen-id') && !td.hasAttribute('data-iphen-average-id')) return;

                    td.classList.remove('is-hidden');
                    td.removeAttribute('aria-hidden');

                    // 如果存在 data-orig-text，优先还原
                    if (td.dataset.origText != null) {
                        td.textContent = td.dataset.origText;
                        delete td.dataset.origText;
                    } else if (td.dataset.initialText != null) {
                        td.textContent = td.dataset.initialText;
                    } else {
                        td.textContent = '※要問';
                    }

                    // 清理运行时样式/标记
                    td.classList.remove('nodata');
                    delete td.dataset.v;
                    td.style.background = '';
                    td.style.color = '';
                    td.style.fontWeight = '';
                });

                // 3) 兜底：如果有残余的 data-merged（未设置值 '1'），也统一清理
                document.querySelectorAll('td[data-merged]').forEach(td => {
                    delete td.dataset.merged;
                });

                {#console.log('[PSTA] restoreMergedColorRows: restored merged rows/hidden cells.');#}
            } catch (err) {
                console.warn('[PSTA] restoreMergedColorRows error:', err);
            }
        }

        (function cacheInitialMainTitle() {
            const mt = document.getElementById('main-title') ||
                Array.from(document.querySelectorAll('h4')).find(h => /買取相場/.test(h.textContent));
            if (mt && !window._psta_original_main_title) window._psta_original_main_title = mt.textContent.trim();
        })();

        (function () {
            const SNAP_KEY = '__psta_initial_snapshot__';
            // 需要快照/恢复的选择器：所有可能被修改的单元格与表头
            const SNAP_SEL = [
                'td[data-shop-id][data-iphen-id]',
                'td[data-shop-id][data-iphen-average-id]',
                'td[data-highest][data-range-shop-id][data-range-iphen-id]',
                'td[data-average][data-range-shop-id][data-range-iphen-id]',
                'td[data-change-from-crevious-day]',
                'th.shop-col',
                '#shops label' // 店铺列表 label（名称颜色等）
            ].join(',');

            // 将初始状态保存在 window 上（内存），避免污染 localStorage / DOM
            function captureInitialFormat() {
                if (window[SNAP_KEY]) return; // 已经快照过了就跳过
                const nodes = Array.from(document.querySelectorAll(SNAP_SEL));
                const snap = [];
                for (const n of nodes) {
                    snap.push({
                        // 使用 dataset.__psta_snap_id__ 作为回溯索引（可选）
                        selector: computeSelectorForNode(n),
                        outerHTML: n.outerHTML,        // 完整快照（恢复最保守）
                        innerHTML: n.innerHTML,
                        textContent: n.textContent,
                        className: n.className,
                        rowSpan: n.getAttribute && n.getAttribute('rowspan'),
                        dataset: Object.assign({}, n.dataset)
                    });
                }
                // 也快照 shops 面板（checkbox 状态除外，仅文本/样式）
                const shops = Array.from(document.querySelectorAll('#shops label'));
                snap.push({_shops: shops.map(l => ({outerHTML: l.outerHTML, text: l.textContent, html: l.innerHTML}))});

                window[SNAP_KEY] = snap;
                {#console.log('[PSTA] initial format snapshot captured:', snap.length, 'nodes');#}
            }

            // 计算一个可用于查找该节点的简单选择器（尽量稳定）
            function computeSelectorForNode(n) {
                if (!(n instanceof Element)) return null;
                // 优先使用 id
                if (n.id) return `#${n.id}`;
                // 使用 data-shop-id + data-iphen-id 这种组合（本脚本常用）
                if (n.hasAttribute && n.hasAttribute('data-shop-id') && (n.hasAttribute('data-iphen-id') || n.hasAttribute('data-iphone-id'))) {
                    const sid = n.getAttribute('data-shop-id');
                    const ip = n.getAttribute('data-iphen-id') || n.getAttribute('data-iphone-id');
                    return `td[data-shop-id="${sid}"][data-iphen-id="${ip}"], td[data-shop-id="${sid}"][data-iphone-id="${ip}"]`;
                }
                // 表头
                if (n.className && n.className.includes('shop-col') && n.textContent) {
                    return `th.shop-col:contains(${CSS.escape ? CSS.escape(n.textContent.trim()) : n.textContent.trim()})`;
                }
                // 兜底：用 tagName + index
                const idx = Array.prototype.indexOf.call(n.parentElement ? n.parentElement.children : [], n);
                return `${n.tagName.toLowerCase()}:nth-child(${idx + 1})`;
            }

            // 恢复：尽量还原 outerHTML -> 但不完全 replace，以免断开事件绑定（尽量保守恢复属性/内容/类）
            function restoreInitialFormat() {
                const snap = window[SNAP_KEY];
                if (!snap) {
                    console.warn('[PSTA] no initial snapshot found; captureInitialFormat() should be called at load.');
                    return;
                }

                // 恢复 shops panel（如果存在）
                const shopsSnap = snap.find(s => s._shops);
                if (shopsSnap && document.getElementById('shops')) {
                    const box = document.getElementById('shops');
                    // 直接重写 innerHTML 为初始快照中的 outerHTML 集合（safe since we captured at load)
                    box.innerHTML = shopsSnap._shops.map(s => s.outerHTML).join('');
                }

                // 恢复各个单元格
                for (const entry of snap) {
                    if (entry._shops) continue;
                    const sel = entry.selector;
                    if (!sel) continue;
                    // 使用 querySelectorAll 以兼容多个匹配（例如含 or 的选择器）
                    let nodes;
                    try {
                        nodes = Array.from(document.querySelectorAll(sel));
                    } catch (e) {
                        // 如果 selector 不是标准 CSS（例如 :contains），则使用备选匹配策略
                        nodes = [];
                    }
                    if (!nodes.length) {
                        // 兜底：尝试按 dataset 比对恢复（若 snapshot 包含 dataset）
                        const maybe = Array.from(document.querySelectorAll('td[data-shop-id]')).filter(n => {
                            // 比对 dataset 中的关键字段是否一致
                            const ds = entry.dataset || {};
                            if (ds.shopId && n.dataset.shopId !== ds.shopId) return false;
                            if ((ds.iphenId || ds.iphoneId) && (n.dataset.iphenId !== (ds.iphenId || ds.iphoneId)) && n.dataset.iphoneId !== (ds.iphenId || ds.iphoneId)) return false;
                            return true;
                        });
                        nodes = maybe;
                    }

                    for (const n of nodes) {
                        try {
                            // 最保守的恢复：还原 className / innerHTML / textContent / rowspan / dataset v
                            n.className = entry.className || '';
                            if (entry.rowSpan != null) {
                                if (entry.rowSpan === null) n.removeAttribute('rowspan'); else n.setAttribute('rowspan', entry.rowSpan);
                            }
                            // 恢复 dataset 原始键（谨慎覆盖运行时产生的 dataset.*）
                            if (entry.dataset) {
                                for (const k of Object.keys(entry.dataset)) {
                                    try {
                                        n.dataset[k] = entry.dataset[k];
                                    } catch {
                                    }
                                }
                            }
                            // 恢复内容（优先 innerHTML）
                            if (entry.innerHTML != null) n.innerHTML = entry.innerHTML;
                            else if (entry.textContent != null) n.textContent = entry.textContent;
                            // 移除运行时标记
                            n.classList.remove('is-hidden', 'psta-max', 'psta-min', 'psta-close', 'nodata');
                            delete n.dataset.merged;
                            // 若有 data-orig-text 恢复它并删除
                            if (n.dataset.origText != null) {
                                n.textContent = n.dataset.origText;
                                delete n.dataset.origText;
                            }
                        } catch (err) {
                            console.warn('[PSTA] restore node failed for selector', sel, err);
                        }
                    }
                }

                // 额外恢复：移除全局可能添加的样式改变（如果你动态添加 style id）
                const injected = document.getElementById('psta-row-styles');
                if (injected) {
                    // 不移除样式表（你可能想保留它），但如果确实要回到页面初始样式，可注释掉下一行
                    // injected.remove();
                }

                {#console.log('[PSTA] initial formatting restored.');#}
            }

            // 暴露给全局（方便调试）
            window.captureInitialFormat = captureInitialFormat;
            window.restoreInitialFormat = restoreInitialFormat;

            // 自动在 DOMContentLoaded 时快照一次（只做一次）
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', () => {
                    try {
                        captureInitialFormat();
                    } catch (e) {
                        console.warn(e);
                    }
                });
            } else {
                try {
                    captureInitialFormat();
                } catch (e) {
                    console.warn(e);
                }
            }
        })();

        function buildMaxInWindow(rows) {
            const m = new Map();
            for (const x of rows) {
                const sKey = serverToMatchShop(Number(x.shop_id));
                const iKey = serverToMatchIphen(Number(x.iphone_id));
                if (!Number.isFinite(sKey) || !Number.isFinite(iKey)) continue;
                const k = `${sKey}-${iKey}`;
                const price = Number(x.New_Product_Price);
                if (!Number.isFinite(price)) continue;
                const cur = m.get(k);
                if (cur == null || price > cur) m.set(k, price);
            }
            return m;
        }


        const RULE_INDEX_BY_ID = new Map(
            (Array.isArray(SHOP_COLOR_RULES) ? SHOP_COLOR_RULES : []).map(r => [String(r.shop_id), r])
        );

        function findRuleForShop(sname, sid) {
            const name = String(sname ?? '').trim();
            const byName = SHOP_COLOR_RULES.find(r => {
                try {
                    return new RegExp(r.match.source, 'i').test(name);
                } catch {
                    return false;
                }
            });
            if (byName) return byName;

            // 兜底：按 shop_id 匹配
            const byId = RULE_INDEX_BY_ID.get(String(sid));
            return byId || null;
        }


        function highlightRowExtremes() {
            // 兼容 data-iphone-id 与 data-iphen-id
            const ROW_SHOP_CELL_SEL = 'td[data-shop-id][data-iphen-average-id],td[data-shop-id][iphen-average-id]';
            let affected = 0;

            // 将单元格解析为数值（去掉逗号/货币等；※要問/nodata/隐藏替换 一律跳过）
            const parseCellNumber = (td) => {
                try {
                    if (!td || !(td instanceof HTMLElement)) return null;

                    // 跳过显式隐藏（包括 inline style "display: none !important"）
                    const cs = window.getComputedStyle ? getComputedStyle(td) : null;
                    if (cs && (cs.display === 'none' || cs.visibility === 'hidden' || cs.opacity === '0')) return null;

                    // 传统 class / dataset 标记的“无数据 / 被隐藏 / 被替换”的情况
                    if (td.classList.contains('nodata')) return null;
                    if (td.dataset.hidden === '1' || td.dataset.replaced === '1') return null;

                    // 取值（优先 dataset.v，再用文本）
                    const raw = td.dataset?.v ?? td.textContent ?? '';
                    const s = String(raw).trim();

                    // 跳过各种特殊文本
                    if (!s) return null;
                    const low = s.toLowerCase();
                    if (s === '※要問' || s === '要問' || s === '—' || s === '-' || low === 'n/a' || low === '要確認') return null;

                    // 清理货币符号、逗号、空白后转数值（兼容全角符号）
                    const norm = s.replace(/[,\s\u3000¥￥円]/g, '').replace(/（.*?）/g, '');
                    const n = Number(norm);

                    return Number.isFinite(n) ? n : null;
                } catch (e) {
                    // 容错：若任何异常都视为不可用
                    return null;
                }
            };

            document.querySelectorAll('tr').forEach(tr => {
                const cells = Array.from(tr.querySelectorAll(ROW_SHOP_CELL_SEL));
                if (!cells.length) return;

                // 先清除旧标记（仅店铺格）
                cells.forEach(td => td.classList.remove('psta-max', 'psta-min', 'psta-close'));

                // 收集有效数字
                const items = [];
                for (const td of cells) {
                    const v = parseCellNumber(td);
                    if (v != null) items.push({td, v});
                }
                if (!items.length) return;

                // 行内平均：优先取本行 data-average（若有），否则求平均
                let avgVal = NaN;
                const avgCell = tr.querySelector('td[data-average]');
                if (avgCell) {
                    const avg = parseCellNumber(avgCell);
                    if (avg != null) avgVal = avg;
                }
                if (!Number.isFinite(avgVal)) {
                    avgVal = items.reduce((s, x) => s + x.v, 0) / items.length;
                }

                // 正确计算极值（注意属性名是 .v）
                const nums = items.map(x => x.v);
                const maxVal = Math.max(...nums); // 行内最大
                const minVal = Math.min(...nums); // 行内最小
                console.log("maxVal----------------------------------", maxVal)

                // 距平均最近的差值（允许并列）
                let bestDiff = Infinity;
                for (const it of items) {
                    const d = Math.abs(it.v - avgVal);
                    if (d < bestDiff) bestDiff = d;
                }

                // 使用 epsilon 来处理浮点微差或类型问题
                const EPS = 1;

                // 打标（并列也都会被标）
                for (const it of items) {
                    if (Math.abs(it.v - maxVal) <= EPS) it.td.classList.add('psta-max');
                    console.log("it.v:", it.v, "<------>maxVal:", maxVal)
                    {#if (Math.abs(it.v - minVal) <= EPS) it.td.classList.add('psta-min');#}
                    // 若需要标“最接近平均”的格，取消下一行注释：
                    // if (Math.abs(it.v - avgVal) <= bestDiff + EPS) it.td.classList.add('psta-close');
                }


                affected++;
            });

            {#console.log(`[PSTA] row extremes highlighted on ${affected} row(s).`);#}
        }

        const LS_KEY = 'useLocalIdMap';
        const isMappingEnabled = () => localStorage.getItem(LS_KEY) === 'true';
        const setMappingEnabled = v => localStorage.setItem(LS_KEY, v ? 'true' : 'false');

        function injectToggle() {
            const fieldset = document.querySelector('fieldset legend')?.parentElement || document.body;
            const container = document.createElement('div');
            Object.assign(container.style, {
                display: 'inline-flex',
                alignItems: 'center',
                gap: '8px',
                marginLeft: '12px'
            });

            const label = document.createElement('label');
            label.style.cursor = 'pointer';
            label.title = '开启：DOM中的服务器ID将映射为本地ID再匹配（本地调试用）';

            const cb = document.createElement('input');
            cb.type = 'checkbox';
            cb.id = 'toggle-local-map';
            cb.checked = isMappingEnabled();

            const span = document.createElement('span');
            span.textContent = '本地ID映射';
            span.style.userSelect = 'none';

            label.appendChild(cb);
            label.appendChild(span);
            container.appendChild(label);

            const btnArea = fieldset.querySelector('.row4 > div:nth-child(3)') || fieldset;
            btnArea.appendChild(container);

            cb.addEventListener('change', () => {
                setMappingEnabled(cb.checked);
                {#console.log('[PSTA] Local ID Mapping =', cb.checked);#}
            });
        }

        injectToggle();


        const input = $id('start');            // <input type="datetime-local" id="start">
        const btnPick = $id('pick-time');        // 「選択時刻」按钮（可选）
        const btnNew = $id('latest');           // 「最新」按钮（可选）
        const caption = $id('range-caption');    // 可选
        const updatedAtEl = $id('updated-at');       // 可选

        // ---------- 时间 & 请求 ----------
        const fmt = new Intl.DateTimeFormat('sv-SE', {
            year: 'numeric', month: '2-digit', day: '2-digit',
            hour: '2-digit', minute: '2-digit', second: '2-digit',
            hour12: false, timeZone: 'Asia/Tokyo'
        });
        const toIsoTZ = d => fmt.format(d).replace(' ', 'T') + '+09:00';
        const enc = encodeURIComponent;
        const floorToMinute = d => new Date(Math.floor(d.getTime() / 60000) * 60000);

        function formatDisplayJP(d) {
            const z = new Intl.DateTimeFormat('ja-JP', {
                timeZone: 'Asia/Tokyo', year: 'numeric', month: '2-digit', day: '2-digit',
                hour: '2-digit', minute: '2-digit', hour12: false
            }).formatToParts(d).reduce((acc, p) => (acc[p.type] = p.value, acc), {});
            return `${z.year}/${z.month}/${z.day} ${z.hour}時${z.minute}分`;
        }

        async function fetchRows(start, end) {
            const url = `${API_BASE}/purchasing-time-analyses-psta-compact/?start=${enc(toIsoTZ(start))}&end=${enc(toIsoTZ(end))}`;
            const r = await fetch(url, {headers: {'Accept': 'application/json'}});
            if (!r.ok) throw new Error(`HTTP ${r.status}`);
            return r.json();
        }

        function buildClosestByRef(rows, refTs) {
            const m = new Map(); // key `${shop}-${iphone}`
            for (const x of rows) {
                const k = `${x.shop_id}-${x.iphone_id}`;
                const ts = Date.parse(x.Timestamp_Time);
                if (!Number.isFinite(ts)) continue;
                const cur = m.get(k);
                if (!cur || Math.abs(ts - refTs) < Math.abs(cur.ts - refTs)) {
                    m.set(k, {price: x.New_Product_Price, ts});
                }
            }
            return m;
        }

        function findBasePriceInRow(tr) {
            if (!tr) return NaN;
            // 优先找带 data-issue-pricing 的单元格
            const direct = tr.querySelector('td[data-issue-pricing]');
            if (direct) {
                const v = parseNumText(direct.textContent || direct.dataset.v);
                return Number.isFinite(v) ? v : NaN;
            }

            // 兜底：向前找第一个数字（遇到店铺列停止）
            const tds = Array.from(tr.querySelectorAll('td'));
            let lastNum = NaN;
            for (const td of tds) {
                if (td.hasAttribute('data-shop-id')) break;
                const v = parseNumText(td.textContent);
                if (Number.isFinite(v)) lastNum = v;
            }

            return Number.isFinite(lastNum) ? lastNum : NaN;

        }

        function filterOutBelowHalf(closest) {
            const res = new Map();
            // 把所有店铺单元的查询缓存一下，减少 DOM 扫描成本
            const shopCells = Array.from(document.querySelectorAll('td[data-shop-id][data-iphen-id]'));
            for (const [key, val] of closest.entries()) {
                {#console.log([key, val])#}
                const [sKeyStr, iKeyStr] = String(key).split('-');
                const sKey = Number(sKeyStr), iKey = Number(iKeyStr);
                if (!Number.isFinite(sKey) || !Number.isFinite(iKey)) continue;

                // 在 DOM 中找与之对应的 td（server->match 映射已应用到 map 的 key）
                const candidateTd = shopCells.find(td => {
                    const srv = Number(td.getAttribute('data-shop-id'));
                    const iph = Number(td.getAttribute('data-iphen-id') || td.getAttribute('data-iphone-id'));
                    return Number.isFinite(srv) && Number.isFinite(iph) &&
                        serverToMatchShop(srv) === sKey && serverToMatchIphen(iph) === iKey;
                });

                let belowHalf = false;
                if (candidateTd) {
                    const tr = candidateTd.parentElement;
                    {#const basePrice = findBasePriceInRow(tr);#}
                    const basePrice = BASE_LINE_PRICE;
                    if (Number.isFinite(basePrice)) {
                        const price = Number(val.price);
                        {#console.log("price:", price)#}
                        if (Number.isFinite(price) && price < basePrice) {
                            belowHalf = true;
                            // 标记 DOM：清 dataset.v，显示※要問，并加 nodata class
                            candidateTd.dataset.v = '';
                            candidateTd.textContent = '※要問';
                            candidateTd.classList.add('nodata');
                            {#console.log("price:", price, ";basePrice:", basePrice)#}
                        }
                    }
                }

                if (!belowHalf) {
                    // 保留原 entry（不修改）
                    res.set(key, val);
                } else {
                    // 如果被剔除，也为了安全起见尽量移除其 dataset.v
                    // （candidateTd 可能为 undefined，此时跳过）
                }
            }
            return res;
        }

        const serverToMatchShop = id => isMappingEnabled() ? (SERVER_TO_LOCAL_SHOP[id] ?? id) : id;
        const serverToMatchIphen = id => isMappingEnabled() ? (SERVER_TO_LOCAL_IPHEN[id] ?? id) : id;

        const nfJPY = new Intl.NumberFormat('ja-JP');
        const nfPct = new Intl.NumberFormat('ja-JP', {style: 'percent', maximumFractionDigits: 0});
        const formatWithPlus = v => (v > 0 ? `+${nfJPY.format(v)}` : nfJPY.format(v));

        const parseIds = s => [...new Set(String(s || '').trim().split(/\s+/).map(Number).filter(Number.isFinite))];
        const parseNumText = t => {
            const n = Number(String(t || '').replace(/[^\d.-]/g, ''));
            return Number.isFinite(n) ? n : NaN;
        };

        function fillSingles(closest) {
            const cells = document.querySelectorAll('td[data-shop-id][data-iphen-id]');
            let ok = 0;
            for (const td of cells) {
                const sSrv = Number(td.dataset.shopId);
                const iSrv = Number(td.dataset.iphenId);
                const sKey = serverToMatchShop(sSrv);
                const iKey = serverToMatchIphen(iSrv);
                const rec = closest.get(`${sKey}-${iKey}`);
                if (rec && Number.isFinite(rec.price)) {
                    td.dataset.v = String(rec.price);
                    td.textContent = nfJPY.format(rec.price);
                    td.classList.remove('nodata');
                    ok++;
                } else {
                    td.dataset.v = '';
                    td.textContent = '※要問';
                    td.classList.add('nodata');

                }
            }
            {#console.log(`[PSTA] singles filled: ${ok}/${cells.length} (map=${isMappingEnabled()})`);#}
        }

        function fillSinglesSelective(closest, shopIdSet) {
            const cells = document.querySelectorAll('td[data-shop-id][data-iphen-id]');
            let ok = 0;
            for (const td of cells) {
                const sSrv = Number(td.dataset.shopId);
                if (!shopIdSet.has(sSrv)) continue;
                if (td.dataset.v) continue;
                const iSrv = Number(td.dataset.iphenId);
                const sKey = serverToMatchShop(sSrv);
                const iKey = serverToMatchIphen(iSrv);
                const rec = closest.get(`${sKey}-${iKey}`);
                if (rec && Number.isFinite(rec.price)) {
                    td.dataset.v = String(rec.price);
                    td.textContent = nfJPY.format(rec.price);
                    td.classList.remove('nodata');
                    ok++;
                }
            }
            {#console.log(`[PSTA] singles backfilled for ${ok} cell(s) across ${shopIdSet.size} shop(s).`);#}
        }

        const toHundredsRound = v => Math.round(v / 100) * 100; // 百位以下四舍五入

        {#function fillAverages(closest) {#}
        {#    const cells = document.querySelectorAll('td[data-shop-id][data-iphen-average-id], td[data-shop-id][iphen-average-id]');#}
        {#    let ok = 0;#}
        {#    for (const td of cells) {#}
        {#        const sSrv = Number(td.dataset.shopId);#}
        {#        const raw = td.getAttribute('data-iphen-average-id') || td.getAttribute('iphen-average-id') || '';#}
        {#        const iSrvList = parseIds(raw);#}
        {#        const sKey = serverToMatchShop(sSrv);#}
        {#        const iKeys = [...new Set(iSrvList.map(serverToMatchIphen))];#}
        {##}
        {#        let sum = 0, n = 0;#}
        {#        for (const iKey of iKeys) {#}
        {#            const rec = closest.get(`${sKey}-${iKey}`);#}
        {#            if (rec && Number.isFinite(rec.price)) {#}
        {#                sum += rec.price;#}
        {#                n++;#}
        {#            }#}
        {#        }#}
        {#        if (n) {#}
        {#            const avg = Math.round(sum / n);#}
        {#            const avg100 = toHundredsRound(avg);#}
        {#            td.dataset.v = String(avg100);#}
        {#            td.textContent = nfJPY.format(avg100);#}
        {#            td.classList.remove('nodata');#}
        {#            ok++;#}
        {#        } else {#}
        {#            td.dataset.v = '';#}
        {#            td.textContent = '※要問';#}
        {#        }#}
        {#    }#}
        {#    console.log(`[PSTA] averages filled: ${ok}/${cells.length} (map=${isMappingEnabled()})`);#}
        //#}

        function fillAverages(closest) {
            const cells = document.querySelectorAll('td[data-shop-id][data-iphen-average-id], td[data-shop-id][iphen-average-id]');
            let ok = 0;
            for (const td of cells) {
                const sSrv = Number(td.dataset.shopId);
                const raw = td.getAttribute('data-iphen-average-id') || td.getAttribute('iphen-average-id') || '';
                const iSrvList = parseIds(raw);
                const sKey = serverToMatchShop(sSrv);
                const iKeys = [...new Set(iSrvList.map(serverToMatchIphen))];

                const values = [];
                for (const iKey of iKeys) {
                    const rec = closest.get(`${sKey}-${iKey}`);
                    if (rec && Number.isFinite(rec.price)) {
                        values.push(Number(rec.price));
                    }
                }

                if (values.length > 0) {
                    // 计算最大/最小，并按百位四舍五入显示（与平均一致的口径）
                    const rawMax = Math.max(...values);
                    const rawMin = Math.min(...values);
                    const max100 = toHundredsRound(rawMax);
                    const min100 = toHundredsRound(rawMin);

                    td.dataset.v_max = String(max100);
                    td.dataset.v_min = String(min100);
                    // 兼容旧逻辑：保留 dataset.v 为最大（如果其他代码依赖）
                    td.dataset.v = String(max100);

                    td.textContent = `${nfJPY.format(max100)}`;
                    td.classList.remove('nodata');
                    ok++;
                } else {
                    // 无有效数据
                    delete td.dataset.v_max;
                    delete td.dataset.v_min;
                    td.dataset.v = '';
                    td.textContent = '※要問';
                    td.classList.add('nodata');
                }
            }
            {#console.log(`[PSTA] averages (now extremes) filled: ${ok}/${cells.length} (map=${isMappingEnabled()})`);#}
        }

        function recalcRangeCells(closest) {
            let rowsDone = 0;

            document.querySelectorAll('td[data-highest][data-range-shop-id][data-range-iphen-id]').forEach(highCell => {
                const tr = highCell.parentElement;

                const shopsSrv = parseIds(highCell.dataset.rangeShopId);
                const iphsSrv = parseIds(highCell.dataset.rangeIphenId);
                const shopsKey = [...new Set(shopsSrv.map(serverToMatchShop))];
                const iphsKey = [...new Set(iphsSrv.map(serverToMatchIphen))];

                const vals = [];
                for (const s of shopsKey) {
                    for (const i of iphsKey) {
                        const rec = closest.get(`${s}-${i}`);
                        if (rec && Number.isFinite(rec.price)) vals.push(rec.price);
                    }
                }

                const highest = vals.length ? Math.max(...vals) : null;
                const average = vals.length ? Math.round(vals.reduce((a, b) => a + b, 0) / vals.length) : null;

                // 最高（B）
                if (highest != null) {
                    highCell.dataset.v = String(highest);
                    highCell.textContent = nfJPY.format(highest);
                } else {
                    highCell.dataset.v = '';
                    highCell.textContent = '-';
                }

                // 定価：假设为 highCell 前一个 <td>
                const baseCell = highCell.previousElementSibling;
                const basePrice = baseCell ? parseNumText(baseCell.textContent) : NaN;

                // 差額（C）= highest - 定価
                const diffCell = tr.querySelector('td[data-diff]');
                if (diffCell) {
                    if (highest != null && Number.isFinite(basePrice)) {
                        const diffVal = highest - basePrice;
                        diffCell.dataset.v = String(diffVal);
                        diffCell.textContent = formatWithPlus(diffVal);
                        diffCell.style.color = diffVal > 0 ? '#2727ff' : (diffVal < 0 ? '#b42318' : '');
                    } else {
                        diffCell.dataset.v = '';
                        diffCell.textContent = '-';
                        diffCell.style.color = '';
                    }
                }

                // 買取率（D）= highest / 定価
                const rateCell = tr.querySelector('td[data-rate]');
                if (rateCell) {
                    if (highest != null && Number.isFinite(basePrice) && basePrice > 0) {
                        const ratio = highest / basePrice - 1; // 计算变化率 (相对于 basePrice 的增减百分比)
                        const formattedRatio = (ratio >= 0 ? '+' : '') + (ratio * 100).toFixed(2) + '%';
                        rateCell.dataset.v = formattedRatio;
                        rateCell.textContent = formattedRatio; // 使用相同的格式，忽略 nfPct 假设其格式不一致
                        rateCell.style.color = ratio >= 0 ? '#2727ff' : '#b42318';
                    } else {
                        rateCell.dataset.v = '';
                        rateCell.textContent = '-';
                        rateCell.style.color = '';
                    }
                }

                // 平均（E）
                const avgCell = tr.querySelector('td[data-average][data-range-shop-id][data-range-iphen-id]') ||
                    tr.querySelector('td[data-average]');
                if (avgCell) {
                    if (average != null) {
                        avgCell.dataset.v = String(average);
                        avgCell.textContent = nfJPY.format(average);
                    } else {
                        avgCell.dataset.v = '';
                        avgCell.textContent = '-';
                    }
                }

                rowsDone++;
            });

            {#console.log(`[PSTA] range highest/diff/rate/average recalculated for ${rowsDone} row(s).`);#}
        }

        function getShopsWithNoAnyData() {
            const shops = new Map(); // sSrv -> { total, hasValue }
            const cells = document.querySelectorAll('td[data-shop-id][data-iphen-id]');
            for (const td of cells) {
                const sSrv = Number(td.dataset.shopId);
                const st = shops.get(sSrv) || {total: 0, hasValue: false};
                st.total += 1;
                if (td.dataset.v) st.hasValue = true;
                shops.set(sSrv, st);
            }
            const missing = [...shops.entries()]
                .filter(([, st]) => st.total > 0 && !st.hasValue)
                .map(([sSrv]) => sSrv);
            return new Set(missing);
        }

        function mergeClosestMaps(primary, fallback) {
            const res = new Map(primary);
            for (const [k, v] of fallback.entries()) {
                if (!res.has(k)) res.set(k, v);
            }
            return res;
        }

        async function loadShops() {
            const box = $id('shops');
            if (!box) return;
            box.innerHTML = '';
            SHOPS_INDEX.clear();

            try {
                const resp = await fetch(ENDPOINT_SHOPS);
                if (!resp.ok) {
                    const txt = await resp.text().catch(() => '');
                    throw new Error(`HTTP ${resp.status} ${resp.statusText} ${txt.slice(0, 200)}`);
                }
                const payload = await resp.json();
                const items = Array.isArray(payload) ? payload
                    : Array.isArray(payload?.results) ? payload.results
                        : Array.isArray(payload?.items) ? payload.items : [];

                const pending = [];
                let invalidCount = 0;

                for (const s of items) {
                    const sidRaw = s?.id ?? s?.shop_id ?? s?.pk ?? s?.ID ?? s?.Id;
                    const sid = Number(sidRaw);
                    if (!Number.isFinite(sid)) {
                        invalidCount++;
                        {#console.warn('[shops] skip invalid id:', s);#}
                        continue;
                    }

                    const sname = s?.name ?? s?.shop_name ?? s?.display_name ?? String(sid);

                    // 根据规则计算排序键 & 颜色
                    const rule = findRuleForShop(sname, sid);
                    const order = Number.isFinite(rule?.order) ? rule.order : 9999;
                    const color = rule?.color || '';

                    // 组装 DOM（先不插入，放到 pending 等排序后再 append）
                    const label = document.createElement('label');
                    label.title = sname;

                    const input = document.createElement('input');
                    input.type = 'checkbox';
                    input.value = String(sid);
                    input.dataset.name = sname;
                    input.dataset.shopId = String(sid);
                    input.id = `shop_${sid}`;

                    const span = document.createElement('span');
                    span.textContent = sname;
                    if (color) span.style.color = color; // 店铺名着色

                    label.appendChild(input);
                    label.appendChild(span);

                    // 保存以备排序
                    pending.push({order, name: sname, node: label, sid});

                    SHOPS_INDEX.set(sid, sname);
                }

                // 按 order 升序；同 order 内按日文友好排序（可改成 sid 升序）
                pending.sort((a, b) => (a.order - b.order) ||
                    a.name.localeCompare(b.name, 'ja', {sensitivity: 'base', numeric: true}));

                // 一次性插入 DOM
                const frag = document.createDocumentFragment();
                for (const {node} of pending) frag.appendChild(node);
                box.appendChild(frag);

                const errEl = document.getElementById('err');
                if (items.length === 0 && errEl) errEl.textContent = '店舗リストが空です（API 応答を確認してください）';
                if (invalidCount > 0) console.warn(`[shops] skipped ${invalidCount} invalid entries (missing id)`);

            } catch (e) {
                console.error(e);
                $id('err') && ($id('err').textContent = '店舗の読み込みに失敗しました（CORS / 認証 / 応答形式を確認）');
            }
        }

        function formatYmdJST(d) {
            const parts = new Intl.DateTimeFormat('ja-JP', {
                timeZone: 'Asia/Tokyo',
                year: 'numeric', month: '2-digit', day: '2-digit'
            }).formatToParts(d).reduce((acc, p) => (acc[p.type] = p.value, acc), {});
            return `${parts.year}${parts.month}${parts.day}`;
        }

        function updateMainTitleDate(end) {
            // 格式化日期为 YYYYMMDD
            const ymd = formatYmdJST(end);
            // 格式化时间为 HHMM（例如 18時56分 -> 1856）
            const time = end.toLocaleTimeString('ja-JP', {
                hour: '2-digit',
                minute: '2-digit',
                hour12: false
            }).replace(':', '');

            // 查找标题元素
            const el = document.getElementById('main-title') ||
                Array.from(document.querySelectorAll('h4')).find(h => /買取相場/.test(h.textContent));
            if (!el) return;

            // 获取当前标题并去除首尾空格
            const txt = el.textContent.trim();
            el.textContent = `iPhone17 買取相場${ymd}${time}`;

            // 替换末尾的 8 位日期，或追加日期+时间
            // if (/\d{8}(?!.*\d)/.test(txt)) {

            // } else {
            //     el.textContent = `${txt}${ymd}${time}`;
            // }
        }

        async function fillChangeFromPreviousDay(endBase) {
            // —— 1) 生成昨日窗口 —— //
            const y = new Date(endBase.getTime()); // copy
            y.setDate(y.getDate() - 1);

            // 昨日 19:50 ~ 20:10 (JST local dates used)
            const startPrev = new Date(y.getFullYear(), y.getMonth(), y.getDate(), 19, 50, 0);
            const endPrev = new Date(y.getFullYear(), y.getMonth(), y.getDate(), 20, 10, 0);

            // —— 2) 拉取昨日窗口数据并计算昨日最高 —— //
            const rowsPrev = await fetchRows(startPrev, endPrev);
            const maxPrevMap = buildMaxInWindow(rowsPrev); // key = "shopKey-iphoneKey" -> 最高价

            // —— 3) 目标单元格列表 —— //
            const changeCells = Array.from(document.querySelectorAll(
                'td[data-change-from-crevious-day][data-range-shop-id][data-range-iphen-id]'
            ));
            if (!changeCells.length) {
                console.log('[PSTA] no change-from-previous-day cells found.');
                return;
            }

            // —— 4) 决定“当前窗口”时间长度 —— //
            // 优先使用 runWithEnd 写入的 window 长度（毫秒），否则回退 25 分钟
            const defaultWindowMs = 25 * 60 * 1000;
            const windowMs = (typeof window._PSTA_windowMs === 'number' && window._PSTA_windowMs > 0)
                ? window._PSTA_windowMs
                : defaultWindowMs;

            // —— 5) 预检测：是否需要从后端再拉一次“当前窗口”数据（当行内 data-highest 不存在或为空时才拉） —— //
            let needCurrFetch = false;
            for (const cell of changeCells) {
                const tr = cell.parentElement;
                const highCell = tr.querySelector('td[data-highest]');
                const curVal = highCell ? Number(highCell.dataset.v) : NaN;
                if (!Number.isFinite(curVal)) {
                    needCurrFetch = true;
                    break;
                }
            }

            // 如果需要，拉取当前窗口（以 endBase 为 end，长度使用 windowMs）数据并计算每个组合的最高（一次性复用）
            let currMaxMap = null;
            if (needCurrFetch) {
                const end = floorToMinute(endBase);
                const start = new Date(end.getTime() - windowMs);
                try {
                    const rowsCur = await fetchRows(start, end);
                    currMaxMap = buildMaxInWindow(rowsCur); // key = "shopKey-iphoneKey" -> 当前窗口最高价
                } catch (e) {
                    console.warn('[PSTA] failed to fetch current-window rows for change calc:', e);
                    currMaxMap = null;
                }
            }

            // 用于格式化
            const fmt = new Intl.NumberFormat('ja-JP');

            // —— 6) 对每个单元格计算并显示差值（currentMax - prevMax） —— //
            let done = 0;
            for (const cell of changeCells) {
                const tr = cell.parentElement;

                // a) 解析本格子的店铺/机型集合（DOM 存的是服务器 ID；映射到匹配 ID）
                const shopsSrv = (cell.getAttribute('data-range-shop-id') || '').trim().split(/\s+/).map(Number).filter(Number.isFinite);
                const iphsSrv = (cell.getAttribute('data-range-iphen-id') || '').trim().split(/\s+/).map(Number).filter(Number.isFinite);
                const shopsKey = [...new Set(shopsSrv.map(serverToMatchShop))];
                const iphsKey = [...new Set(iphsSrv.map(serverToMatchIphen))];

                // b) 获取当前窗口的最高值（跨店/跨机型取最大）
                let currentMax = null;
                // 优先尝试从同一行的 data-highest 单元格读取（recalcRangeCells 已填）
                const highCell = tr.querySelector('td[data-highest][data-range-shop-id][data-range-iphen-id]') || tr.querySelector('td[data-highest]');
                if (highCell) {
                    const hv = Number(highCell.dataset.v);
                    if (Number.isFinite(hv)) currentMax = hv;
                }

                // 若 DOM 中没有可用值，则尝试从 currMaxMap 获取（如果我们已拉取过）
                if (currentMax == null && currMaxMap) {
                    for (const s of shopsKey) {
                        for (const i of iphsKey) {
                            const k = `${s}-${i}`;
                            const p = currMaxMap.get(k);
                            if (Number.isFinite(p)) {
                                if (currentMax == null || p > currentMax) currentMax = p;
                            }
                        }
                    }
                }

                // c) 获取昨日窗口的最高值（prevMax）
                let prevMax = null;
                for (const s of shopsKey) {
                    for (const i of iphsKey) {
                        const k = `${s}-${i}`;
                        const p = maxPrevMap.get(k);
                        if (Number.isFinite(p)) {
                            if (prevMax == null || p > prevMax) prevMax = p;
                        }
                    }
                }

                // d) 计算差值并显示（currentMax - prevMax）
                if (currentMax != null && prevMax != null && Number.isFinite(currentMax) && Number.isFinite(prevMax)) {
                    const diff = Number(currentMax) - Number(prevMax);
                    cell.dataset.v = String(diff);
                    cell.textContent = (diff > 0 ? `+${fmt.format(diff)}` : fmt.format(diff));
                    cell.style.color = diff > 0 ? '#2727ff' : (diff < 0 ? '#b42318' : '');
                    done++;
                } else {
                    cell.dataset.v = '';
                    cell.textContent = '-';
                    cell.style.color = '';
                }
            }

            {#console.log(`[PSTA] change-from-previous-day (using current-window max vs prev-day max) filled for ${done}/${changeCells.length} cell(s).`);#}
        }

        // ---------- 合并相同价格的 iphone 行格（基于 data-to-marge-iphone-id） ----------
        (function injectMergeStyles() {
            if (document.getElementById('psta-merge-styles')) return;
            const css = `
      .merged-cell { font-weight: 700 !important; opacity: 1 !important; }
    `;
            const style = document.createElement('style');
            style.id = 'psta-merge-styles';
            style.textContent = css;
            document.head.appendChild(style);
        })();


        function injectMergeStyles() {
            if (document.getElementById('psta-merge-styles')) return;
            const css = `
      .merged-cell { font-weight: 700 !important; opacity: 1 !important; }
    `;
            const style = document.createElement('style');
            style.id = 'psta-merge-styles';
            style.textContent = css;
            document.head.appendChild(style);
        };

        function _getCellCompareValue(td) {
            if (!td) return null;
            // 优先 dataset.v
            if (td.dataset && td.dataset.v) return String(td.dataset.v).trim();
            // 否则使用文本
            const raw = (td.textContent || '').trim();
            if (!raw) return null;
            // 标准化数字格式中的逗号与货币符
            const num = raw.replace(/[,¥円\s]/g, '');
            // 如果是纯数字（可能含 + 号），返回数字的规范字符串
            if (/^[+\-]?\d+(\.\d+)?$/.test(num)) return String(Number(num));
            // 否则返回原始文本（例如 "※要問"）
            return raw;
        }

        function _findCellsForShopAndIphen(shopId, iphenId) {
            return Array.from(document.querySelectorAll(`td[data-shop-id="${String(shopId)}"][data-iphen-id="${String(iphenId)}"], td[data-shop-id="${String(shopId)}"][data-iphone-id="${String(iphenId)}"]`));
        }

        function mergeColorRowGroups() {
            // 对每个 model-section 表逐个处理
            $qa('.model-section table').forEach(table => {
                // 需要 buildShopHeaderIndexMap（你脚本中已有）
                const {map: headerIndexMap} = buildShopHeaderIndexMap(table);

                // 找到 “ALL平均” 行（优先匹配 data 中含 ALL平均 文本或 data-color="all"）
                const allRow = Array.from(table.tBodies[0].rows).find(r => {
                    const firstTd = r.querySelector('td');
                    if (!firstTd) return false;
                    const txt = (firstTd.textContent || '').trim();
                    if (/ALL平均/.test(txt) || /全平均|ALL/.test(txt)) return true;
                    if (r.dataset && r.dataset.color === 'all') return true;
                    return false;
                });

                // 收集每行的 "merge key"：该行所有 shop 列上 data-to-marge-iphone-id 的规范化字符串（排序后）
                const rows = Array.from(table.tBodies[0].rows);
                const rowKeys = rows.map(r => {
                    const keys = new Set();
                    r.querySelectorAll('td[data-to-marge-iphone-id], td[data-iphen-id][data-to-marge-iphone-id]').forEach(td => {
                        const raw = (td.getAttribute('data-to-marge-iphone-id') || '').trim();
                        if (raw) {
                            const ev = raw.split(/\s+/).map(s => s.trim()).filter(Boolean).sort().join(' ');
                            if (ev) keys.add(ev);
                        }
                    });
                    // 可能存在行没有任何 data-to-marge-iphone-id -> 返回 ''（无法参与分组）
                    const arr = [...keys].sort();
                    return arr.length ? arr.join('|') : '';
                });

                // 形成 key -> [rowIndex...] 映射（只收集 key 非空的行）
                const groups = new Map();
                rowKeys.forEach((k, idx) => {
                    if (!k) return;
                    if (!groups.has(k)) groups.set(k, []);
                    groups.get(k).push(idx);
                });

                // 对每个组处理合并逻辑
                for (const [k, idxs] of groups.entries()) {
                    if (idxs.length < 2) continue; // 至少两行，才有合并意义

                    // 取组内行集合
                    const groupRows = idxs.map(i => rows[i]);

                    // 针对每个 shop column id（headerIndexMap 的 key）
                    for (const shopIdStr of Array.from(headerIndexMap.keys())) {
                        const idx = headerIndexMap.get(shopIdStr);
                        if (idx == null) continue;

                        // 在每行按 index 找到对应的 td[data-shop-id]
                        const cells = groupRows.map(r => {
                            const shopCells = Array.from(r.querySelectorAll('td[data-shop-id]'));
                            return shopCells[idx] || null;
                        });

                        // 若任一行缺失该列单元格，则无法合并该列
                        if (cells.some(c => !c)) continue;

                        // 取 dataset.v（字符串）；若 undefined -> '' 也当作字符串比较
                        const vals = cells.map(c => (c.dataset && c.dataset.v != null) ? String(c.dataset.v) : '');
                        const allEqual = vals.every(v => v === vals[0]);
                        if (!allEqual) continue; // 值不全等则跳过

                        // 找到 allRow 对应的 shop 单元格（必须存在并且 data-iphen-average-id 相匹配）
                        let allRowShopCell = null;
                        if (allRow) {
                            // allRow 的 shop 单元格通常带有 data-iphen-average-id 属性
                            const candidate = allRow.querySelector(`td[data-shop-id="${shopIdStr}"][data-iphen-average-id]`);
                            if (candidate) allRowShopCell = candidate;
                        }

                        // 要求 allRowShopCell 存在且其 dataset.v 与 vals[0] 相等（按你要求）
                        if (!allRowShopCell) continue;
                        const allV = (allRowShopCell.dataset && allRowShopCell.dataset.v != null) ? String(allRowShopCell.dataset.v) : '';
                        if (allV !== vals[0]) continue; // 如果 all 行的 data-v 不同则不合并（按你的规则）

                        // 执行合并：保留第一行的该单元格，设置 rowspan，改文字 & dataset.v；删除其它行该列单元格
                        const keeper = cells[0];
                        // 设置显示文本与 data
                        keeper.textContent = '全色';
                        keeper.dataset.v = allV;
                        // 可视样式：去掉 nodata（若存在），并可加一个 class
                        keeper.classList.remove('nodata');
                        keeper.classList.add('merged-all-colors');

                        // 设置 rowspan = 组内行数（注意：若该 keeper 原先已有 rowspan，覆盖）
                        keeper.setAttribute('rowspan', String(groupRows.length));

                        // 删除其它 rows 的对应单元格（从 DOM 中移除）
                        for (let j = 1; j < cells.length; j++) {
                            const c = cells[j];
                            if (!c) continue;
                            // 移除节点（比隐藏更稳妥，避免表格空位）
                            c.parentElement && c.parentElement.removeChild(c);
                        }
                    } // end per shopId
                } // end per group
            }); // end per table
        }

        function mergeColorRows2() {
            // 遍历每个 model-section table
            $qa('.model-section table').forEach(table => {
                const tbody = table.tBodies[0];
                if (!tbody) return;

                // 把行收集成数组（顺序重要）
                const rows = Array.from(tbody.rows);

                // 以每个行内带 data-to-marge-iphone-id 的单元格作为“合并代表”
                for (const row of rows) {
                    // 可能一行有多个这样的单元格（通常只会有一个），逐一处理
                    const reps = Array.from(row.querySelectorAll('td[data-to-marge-iphone-id]'));
                    for (const rep of reps) {
                        // 如果已经被作为其他合并的一部分删除/移动，则跳过
                        if (!rep.isConnected) continue;
                        // 如果已经被标记为合并代表过，跳过（避免重复）
                        if (rep.dataset.merged === '1') continue;

                        const shopId = String(rep.dataset.shopId || rep.getAttribute('data-shop-id') || '');
                        if (!shopId) continue;

                        // 要合并的 iphone id 列表（服务器 id，空格分隔）
                        const groupIds = String(rep.getAttribute('data-to-marge-iphone-id') || '')
                            .trim().split(/\s+/).filter(Boolean).map(id => String(id));

                        if (!groupIds.length) continue;

                        // 代表格当前显示文本（注意 trim）
                        const repText = (rep.textContent || '').trim();

                        // 收集要合并到代表格的其它行的单元格（按 rows 顺序）
                        const targets = [];

                        for (const otherRow of rows) {
                            if (otherRow === row) continue; // 跳过自己
                            // 在 otherRow 中查找针对相同 shopId 且 data-iphen-id 在 groupIds 的单元格
                            const tds = Array.from(otherRow.querySelectorAll(`td[data-shop-id="${shopId}"], td[data-shop-id='${shopId}']`));
                            // 可能一行里有多个 shop 对应列（理论上只有一个），检查每个是否属于 groupIds
                            for (const td of tds) {
                                const iphen = String(td.dataset.iphenId || td.getAttribute('data-iphen-id') || td.getAttribute('data-iphone-id') || '').trim();
                                if (!iphen) continue;
                                // 如果 this td 的 iphen id 在 groupIds 中（直接匹配），则把它视为 candidate
                                if (groupIds.includes(iphen)) {
                                    // 仅在文本完全相等时才合并（与示例需求一致）
                                    if (((td.textContent || '').trim()) === repText) {
                                        targets.push({row: otherRow, td});
                                    } else {
                                        // 如果文本不相等，则此代表无法合并所有行 -> 取消合并尝试
                                        targets.length = 0;
                                        break;
                                    }
                                }
                            }
                            // 如果中途发现不匹配导致 targets 被清空，则可提前 break
                            if (targets.length === 0 && otherRow !== row) {
                                // 但要确认是否当前 otherRow 实际上包含 groupIds；如果 otherRow 没有对应 iphen 就忽略
                                // 为保持简单：继续遍历（不过上面当发现不等会清空，导致不会合并）
                            }
                        }

                        // 计算实际将被合并的行数：包括代表本身 + targets.length（但需要确认targets中至少含有 groupIds 中的其它行）
                        // 为避免错误合并，只在 targets.length >= 1 时执行合并（即至少与其它 1 行相同）
                        if (targets.length >= 1) {
                            // 确定要跨的总行数：要合并的 unique 行数（代表 + target rows）
                            const uniqRows = new Set(targets.map(t => t.row));
                            const totalRows = 1 + uniqRows.size;

                            // 把代表单元格设置为 “全色”（按你的需求）并设置 rowspan
                            rep.textContent = '全色';
                            rep.setAttribute('rowspan', String(totalRows));
                            rep.dataset.merged = '1';

                            // 从其它行中移除被合并的单元格（从 DOM 中删除，避免列对齐问题）
                            // 注意：如果你更想隐藏（保留 DOM），可以改为 td.classList.add('is-hidden')
                            for (const t of targets) {
                                // 安全检查：如果 td 仍在 DOM，则删除
                                if (t.td && t.td.isConnected) {
                                    t.td.parentElement && t.td.parentElement.removeChild(t.td);
                                }
                            }

                            // 因为我们删除了其它行的单元格，表格的列可能错位 —— 但通常你是通过 data-shop-id 定位单元格而不是通过列索引
                            // 如需在视觉上保留空位，可在被删除位置插入占位 td（但通常不必要）
                        }
                    }
                }
            });
            {#console.log('[PSTA] mergeColorRows: merge pass completed.');#}
        }

        function mergeColorRowsByValue() {
            const TABLES = Array.from(document.querySelectorAll('.model-section table'));
            let totalMergedGroups = 0;

            for (const table of TABLES) {
                const tbody = table.tBodies[0];
                if (!tbody) continue;
                const rows = Array.from(tbody.rows);

                // helpers: read iphen id from a td
                const getIpId = td => {
                    if (!td) return '';
                    return String(td.dataset.iphenId ?? td.getAttribute('data-iphen-id') ?? td.getAttribute('data-iphone-id') ?? '').trim();
                };
                // helper: numeric dataset.v
                const getNumV = td => {
                    if (!td) return null;
                    const v = td.dataset.v;
                    if (v == null) return null;
                    const n = Number(String(v).replace(/[^\d.-]/g, ''));
                    return Number.isFinite(n) ? n : null;
                };

                // 逐行看有没有 data-to-marge-iphone-id 的代表单元格
                for (const repRow of rows) {
                    const reps = Array.from(repRow.querySelectorAll('td[data-to-marge-iphone-id]'));
                    for (const rep of reps) {
                        // 已合并过或不在 DOM 则跳过
                        if (!rep.isConnected || rep.dataset.merged === '1') continue;

                        // 代表 shop id 与 numeric value（必须存在）
                        const repShop = String(rep.dataset.shopId ?? rep.getAttribute('data-shop-id') ?? '').trim();
                        const repVal = getNumV(rep);
                        if (!repShop || repVal == null) continue; // 无数值则不合并

                        // 解析要合并的 iphone id 列表（字符串形式的 id）
                        const groupIds = String(rep.getAttribute('data-to-marge-iphone-id') || '')
                            .trim().split(/\s+/).filter(Boolean).map(String);
                        if (!groupIds.length) continue;

                        // targetsByRow: Map row -> array of tds to remove in that row
                        const targetsByRow = new Map();

                        // 扫描表中所有其它行（包含 repRow 本身的其它列也可被考虑，但通常不需要）
                        for (const otherRow of rows) {
                            if (!otherRow.isConnected) continue;
                            if (otherRow === repRow) continue; // 不把自己当作目标行

                            // 在 otherRow 中找出 data-iphen-id / data-iphone-id 在 groupIds 中的所有单元格
                            const candidateTds = Array.from(otherRow.querySelectorAll('td[data-iphen-id], td[data-iphone-id]'));

                            for (const td of candidateTds) {
                                const ipid = getIpId(td);
                                if (!groupIds.includes(ipid)) continue;

                                const tdVal = getNumV(td);
                                if (tdVal == null) continue; // 没数值不合并

                                // **严格数值相等**时才视为可以合并
                                if (tdVal === repVal) {
                                    // 保存到该行的目标集合（避免同一行重复计数）
                                    const arr = targetsByRow.get(otherRow) || [];
                                    arr.push(td);
                                    targetsByRow.set(otherRow, arr);
                                }
                            }
                        }

                        // 若至少找到一行目标，则执行合并：设置 rep 文本 + rowspan，并移除目标单元格
                        if (targetsByRow.size > 0) {
                            // 计算需要跨的行数 = 1 (代表本行) + targetsByRow.size (不同的其它行数)
                            const rowspan = 1 + targetsByRow.size;

                            // 改写代表单元格
                            rep.textContent = '全色';
                            rep.setAttribute('rowspan', String(rowspan));
                            rep.dataset.merged = '1';

                            // 从每个目标行删除那些单元格
                            for (const [r, tds] of targetsByRow.entries()) {
                                // 为安全起见，从后向前删除
                                for (let i = tds.length - 1; i >= 0; --i) {
                                    const td = tds[i];
                                    if (td && td.isConnected) {
                                        td.parentElement && td.parentElement.removeChild(td);
                                    }
                                }
                            }

                            totalMergedGroups++;
                        }
                    }
                }
            }

            {#console.log(`[PSTA] mergeColorRowsByValue: merged ${totalMergedGroups} group(s).`);#}
        }

        {#function parseCellPriceForMerge(td) {#}
        {#    if (!td) return null;#}
        {#    // 如果被标记为 nodata 或 dataset.v 为空，则视为不可用#}
        {#    if (td.classList.contains('nodata')) return null;#}
        {#    const dv = td.dataset?.v;#}
        {#    if (dv != null && String(dv).trim() !== '') {#}
        {#        const n = Number(String(dv).replace(/[^\d.-]/g, ''));#}
        {#        return Number.isFinite(n) ? n : null;#}
        {#    }#}
        {#    const txt = (td.textContent || '').trim();#}
        {#    if (!txt) return null;#}
        {#    if (txt === '※要問' || txt === '要問' || txt === '-' || txt === '—') return null;#}
        {#    const n = Number(txt.replace(/[,\s¥円]/g, ''));#}
        {#    return Number.isFinite(n) ? n : null;#}

        //}

        // ---------- 将 source shop 列的数据复制到 target shop 列 ----------
        function copyShopColumn(sourceId, targetId) {
            if (!sourceId || !targetId) return 0;
            sourceId = String(sourceId);
            targetId = String(targetId);

            // all source tds
            const srcTds = Array.from(document.querySelectorAll(`td[data-shop-id="${sourceId}"]`));
            let copied = 0;

            // 辅助：尝试用多种方式匹配对应的 target 单元格
            function findMatchingTarget(srcTd) {
                if (!srcTd) return null;
                const table = srcTd.closest('table') || document;
                // 优先按 data-iphen-id / data-iphone-id 精确匹配
                const iphenId = srcTd.getAttribute('data-iphen-id') || srcTd.getAttribute('data-iphone-id');
                if (iphenId) {
                    const t = table.querySelector(`td[data-shop-id="${targetId}"][data-iphen-id="${iphenId}"], td[data-shop-id="${targetId}"][data-iphone-id="${iphenId}"]`);
                    if (t) return t;
                }
                // 次级：按 data-iphen-average-id（整个列表匹配）
                const avgAttr = srcTd.getAttribute('data-iphen-average-id') || srcTd.getAttribute('iphen-average-id');
                if (avgAttr) {
                    // 找 target 中相同属性值的单元格
                    const t = table.querySelector(`td[data-shop-id="${targetId}"][data-iphen-average-id="${CSS.escape(avgAttr)}"], td[data-shop-id="${targetId}"][iphen-average-id="${CSS.escape(avgAttr)}"]`);
                    if (t) return t;
                }
                // 兜底：如果在同一行存在 target 的任意单元格，就返回同 index 的 cell（尝试按 index 对齐）
                const row = srcTd.parentElement;
                if (row && row instanceof HTMLTableRowElement) {
                    const srcCells = Array.from(row.querySelectorAll('td'));
                    const idx = srcCells.indexOf(srcTd);
                    if (idx >= 0) {
                        // 找出该 table 中对应位置的 target 列（如果存在）
                        const tableRoot = row.closest('table');
                        if (tableRoot) {
                            // 在所有行中找与 idx 对应的单元格并检查其 data-shop-id
                            const exampleRow = tableRoot.tBodies[0]?.rows[0] || tableRoot.querySelector('tr');
                            if (exampleRow) {
                                const candidate = exampleRow.cells[idx];
                                if (candidate && candidate.getAttribute('data-shop-id') === targetId) {
                                    // 找到同列的目标单元格（在当前 row 中）
                                    const targetRowCell = row.cells[idx];
                                    if (targetRowCell && targetRowCell.getAttribute('data-shop-id') === targetId) return targetRowCell;
                                }
                            }
                        }
                    }
                }
                // 找不到对应 target
                return null;
            }

            for (const src of srcTds) {
                const tgt = findMatchingTarget(src);
                if (!tgt) continue;

                // 备份目标原始文本（便于恢复）
                if (!tgt.dataset.origText) tgt.dataset.origText = tgt.textContent?.trim() ?? '';

                // 复制 dataset.v (注意空串视为无值)
                if (typeof src.dataset.v !== 'undefined' && src.dataset.v !== '') {
                    tgt.dataset.v = src.dataset.v;
                } else {
                    // 清空目标的 dataset.v（如果 source 无值）
                    delete tgt.dataset.v;
                }

                // 复制显示文本（保持原始文本备份）
                // 只有当 source 的文本可见或我们判定要覆盖时才改写 target.textContent
                if (typeof src.textContent !== 'undefined') {
                    tgt.textContent = src.textContent;
                }

                // 处理 nodata 标识（如果 src 有 nodata 则给 target 标 nodata；否则移除）
                if (src.classList.contains('nodata')) {
                    tgt.classList.add('nodata');
                } else {
                    tgt.classList.remove('nodata');
                }

                // 移除隐藏状态（因为我们是用 source 数据覆盖 target，要让它可见供后续计算）
                if (tgt.classList.contains('is-hidden')) tgt.classList.remove('is-hidden');
                if (tgt.getAttribute('aria-hidden') === 'true') tgt.removeAttribute('aria-hidden');

                // 复制 data-orig-text（如果 source 有）
                if (typeof src.dataset.origText !== 'undefined') {
                    tgt.dataset.origText = src.dataset.origText;
                }

                // 如果 source 有 dataset.merged 等合并标记，不直接复制合并标记（合并逻辑由 mergeColorRows 处理）
                // 仅确保 target 的数值与文本与 source 保持一致

                copied++;
            }

            {#console.log(`[PSTA] copyShopColumn: copied ${copied} cells from shop ${sourceId} -> ${targetId}`);#}
            return copied;
        }


        function parseCellPriceForMerge(td) {
            if (!td || !(td instanceof HTMLElement)) return null;

            // 如果被隐藏或 aria-hidden，则视为不可合并
            if (td.classList.contains('is-hidden') || td.getAttribute('aria-hidden') === 'true') return null;
            if (td.dataset.hidden === '1' || td.dataset.replaced === '1') return null;

            // 优先 dataset.v，再退回到文本内容
            const raw = (td.dataset && typeof td.dataset.v !== 'undefined' && td.dataset.v !== '') ? td.dataset.v : td.textContent;
            if (raw == null) return null;
            const s0 = String(raw).trim();
            if (!s0) return null;

            const lower = s0.toLowerCase();
            const PLACEHOLDERS = new Set(['', '-', '—', '–', '--', 'n/a', 'na']);
            if (PLACEHOLDERS.has(lower)) return null;

            // 尝试解析数字（去掉千分符、日元符号等）
            const numericAttempt = Number(String(s0).replace(/[^\d.-]/g, ''));
            if (Number.isFinite(numericAttempt)) {
                // 即便是 0 也返回数字 0（后续合并逻辑会把 0 视为要问并显示 ※要問）
                return numericAttempt;
            }

            // 否则把原始文本（trim后）当作有效文本返回（例如 '※要問'）
            return s0;
        }

        function mergeColorRows() {
            // 1) 先恢复之前合并/隐藏的状态，保证可重复运行
            // 还原被隐藏的单元格
            for (const hid of Array.from(document.querySelectorAll('td.is-hidden[aria-hidden="true"]'))) {
                hid.classList.remove('is-hidden');
                hid.removeAttribute('aria-hidden');
                if (hid.dataset.origText != null) {
                    hid.textContent = hid.dataset.origText;
                    delete hid.dataset.origText;
                }
            }
            // 还原之前标记为 merged 的主格（移除 rowspan、merged 标记，恢复文本）
            for (const m of Array.from(document.querySelectorAll('td[data-to-marge-iphone-id]'))) {
                if (m.dataset.merged === '1' || m.dataset.mMerged === '1') {
                    if (m.dataset.origText != null) {
                        m.textContent = m.dataset.origText;
                        delete m.dataset.origText;
                    }
                    m.removeAttribute('rowspan');
                    delete m.dataset.merged;
                    delete m.dataset.mMerged;
                    m.classList.remove('nodata');
                }
            }

            // 辅助：解析单元格用于合并比较的值（返回 number | string | null）
            function parseCellPriceForMerge(td) {
                if (!td || !(td instanceof HTMLElement)) return null;
                if (td.classList.contains('is-hidden') || td.getAttribute('aria-hidden') === 'true') return null;
                if (td.dataset.hidden === '1' || td.dataset.replaced === '1') return null;

                // 优先使用 dataset.v（空串视为无值），否则用文本
                const vsrc = (td.dataset && typeof td.dataset.v !== 'undefined' && td.dataset.v !== '') ? td.dataset.v : td.textContent;
                if (vsrc == null) return null;
                const s0 = String(vsrc).trim();
                if (!s0) return null;

                const lower = s0.toLowerCase();
                const PLACEHOLDERS = new Set(['', '-', '—', '–', '--', 'n/a', 'na', '要問', '※要問']);
                if (PLACEHOLDERS.has(lower)) {
                    // 对占位文本也返回其规范文本（方便“文本相同也合并”）
                    // 统一返回 '※要問' 字符串（而不是 null），这样可以合并相同占位文本
                    return '※要問';
                }

                // 尝试解析数字（删掉千分符、日元符号等）
                const numericAttempt = Number(String(s0).replace(/[^\d.-]/g, ''));
                if (Number.isFinite(numericAttempt)) return numericAttempt;

                // 其它文本（比如 "全色" 或自定义内容）直接返回文本
                return s0;
            }

            // 2) 执行新的合并
            const candidates = Array.from(document.querySelectorAll('td[data-to-marge-iphone-id]'));
            for (const repTd of candidates) {
                // 跳过在本次循环已标记的（防重复）
                if (repTd.dataset.merged === '1' || repTd.dataset.mMerged === '1') continue;

                const shopId = repTd.dataset.shopId ?? repTd.getAttribute('data-shop-id');
                if (!shopId) continue;

                const raw = repTd.getAttribute('data-to-marge-iphone-id') || '';
                const iphenIds = raw.trim().split(/\s+/).map(s => s.trim()).filter(s => s !== '');
                if (!iphenIds.length) continue;

                const table = repTd.closest('table');
                if (!table) continue;

                // 收集要合并的所有单元格引用
                const groupCells = [];
                let allPresent = true;
                for (const ip of iphenIds) {
                    const sel = `td[data-shop-id="${shopId}"][data-iphen-id="${ip}"], td[data-shop-id="${shopId}"][data-iphone-id="${ip}"]`;
                    const td = table.querySelector(sel);
                    if (!td) {
                        allPresent = false;
                        break;
                    }
                    groupCells.push(td);
                }
                if (!allPresent) continue;

                // 解析每个格子的比较值（number | string | null）
                const values = groupCells.map(td => parseCellPriceForMerge(td));
                // 如果有 null（不可合并，例如该格被隐藏/被标记为不可用），则跳过
                if (values.some(v => v === null)) continue;

                // 检查是否全部相等（严格相等）
                const first = values[0];
                const allEqual = values.every(v => {
                    // 数字与数字比较，文本与文本比较
                    if (typeof v === 'number' && typeof first === 'number') return v === first;
                    return String(v) === String(first);
                });
                if (!allEqual) continue;

                // 到这里确定需要合并：只有在“确实合并”时才修改 repTd 和隐藏其它格
                const mergeCount = groupCells.length;

                // 备份 repTd 的原始文本（只备份一次）
                if (!repTd.dataset.origText) repTd.dataset.origText = repTd.textContent.trim();

                // 决定显示内容：
                // - 如果 first 是数字 0 -> 视为要问 (※要問)
                // - 如果 first 是数字且 >0 -> 全色（并保留 dataset.v）
                // - 如果 first 是文本（例如 '※要問'） -> 显示 '※要問'（保持 dataset.v 可选）
                if (typeof first === 'number' && first === 0) {
                    repTd.textContent = '※要問';
                    repTd.dataset.v = '';            // 视为无效数值
                    repTd.classList.add('nodata');
                } else if (typeof first === 'number') {
                    repTd.textContent = '全色';
                    repTd.dataset.v = String(first); // 保留数值
                    repTd.classList.remove('nodata');
                } else {
                    // 文本（可能已经是 '※要問'）
                    repTd.textContent = '※要問';
                    // 可以选择是否把 dataset.v 设为原文本；这里保留原值（便于后续判断）
                    repTd.dataset.v = String(first);
                    repTd.classList.add('nodata');
                }

                // 标记 merged 并设置 rowspan
                repTd.dataset.merged = '1';
                repTd.dataset.mMerged = '1';
                try {
                    repTd.setAttribute('rowspan', String(mergeCount));
                } catch (e) {
                    console.warn('[mergeColorRows] failed to set rowspan', e);
                }

                // 隐藏其它格子（仅隐藏，不改变它们的 textContent），并备份原文本
                for (const td of groupCells) {
                    if (td === repTd) continue;
                    if (!td.dataset.origText) td.dataset.origText = td.textContent.trim();
                    td.classList.add('is-hidden');
                    td.setAttribute('aria-hidden', 'true');
                }
            }

            {#console.log('[PSTA] mergeColorRows completed.');#}
        }

        // ---------- 主流程----------
        async function runWithEnd(endBase, tag, btn) {
            try {
                if (btn) {
                    btn.disabled = true;
                    btn.dataset.t = btn.textContent;
                    btn.textContent = '取得中…';
                }
                try {
                    restoreMergedColorRows();
                } catch (e) {
                    console.warn('restoreMergedColorRows failed', e);
                }

                const end = floorToMinute(endBase);
                const start = new Date(end.getTime() - 25 * 60 * 1000);
                window._PSTA_windowMs = end.getTime() - start.getTime();


                caption && (caption.textContent = `${tag}（start=${toIsoTZ(start)} / end=${toIsoTZ(end)}）`);

                // 第一次：25 分钟窗口
                const rows1 = await fetchRows(start, end);
                let map1 = buildClosestByRef(rows1, end.getTime());
                const filtered1 = filterOutBelowHalf(map1); // <-- 过滤掉 <50% 的项并在 DOM 上标记 nodata
                //if (typeof filterOutBelowHalf === 'function') {
                //    map1 = filterOutBelowHalf(map1);
                //}
                fillSingles(filtered1);
                fillAverages(filtered1);
                recalcRangeCells(filtered1);
                copyShopColumn(10, 20);
                highlightRowExtremes();
                mergeColorRows();
                //injectMergeStyles();


                // 2 天回填（仅对没有任何数据的店铺）
                const missingShops = getShopsWithNoAnyData();
                let rows2Len = 0;
                if (missingShops.size > 0) {
                    const start2d = new Date(end.getTime() - 12 * 60 * 60 * 1000);
                    {#console.log(`[PSTA] backfill: ${missingShops.size} shop(s) have no data, searching last 2 days...`);#}
                    const rows2 = await fetchRows(start2d, end);
                    rows2Len = rows2.length;
                    let map2 = buildClosestByRef(rows2, end.getTime());
                    const filtered2 = filterOutBelowHalf(map2);
                    if (typeof filterOutBelowHalf === 'function') {
                        map2 = filterOutBelowHalf(map2);
                    }
                    fillSinglesSelective(map2, missingShops);

                    const merged = mergeClosestMaps(filtered1, filtered2); // or mergeClosestMaps(filtered1, filtered2);
                    fillAverages(merged);
                    recalcRangeCells(merged);
                    copyShopColumn(10, 20);
                    highlightRowExtremes();
                    mergeColorRows();
                    //injectMergeStyles();

                    for (const sSrv of missingShops) {
                        const tds = document.querySelectorAll(`td[data-shop-id="${sSrv}"][data-iphen-id]`);
                        for (const td of tds) {
                            if (!td.dataset.v) td.textContent = '※要問';
                            if (!td.dataset.v) td.classList.add('nodata')
                        }
                    }
                }

                await fillChangeFromPreviousDay(end);

                if (updatedAtEl) updatedAtEl.textContent = `更新日時：${formatDisplayJP(end)}`;
                updateMainTitleDate(end);

                const cellsDiag = [...document.querySelectorAll('td[data-shop-id][data-iphen-id]')]
                    .slice(0, 20)
                    .map(td => {
                        const sSrv = Number(td.dataset.shopId), iSrv = Number(td.dataset.iphenId);
                        const sKey = serverToMatchShop(sSrv), iKey = serverToMatchIphen(iSrv);
                        return `${sSrv}-${iSrv}  (srv→match: ${sKey}-${iKey})`;
                    });
                {#console.log('[PSTA] key map sample:\n' + cellsDiag.join('\n'));#}
                {#console.log(`[PSTA] ${tag}: rows25m=${rows1.length}${rows2Len ? `, rows2d=${rows2Len}` : ''} (map=${isMappingEnabled()})`);#}
            } catch (e) {
                console.error(e);
                alert(e.message || 'データ取得に失敗しました');
            } finally {
                if (btn) {
                    btn.disabled = false;
                    btn.textContent = btn.dataset.t || btn.textContent;
                }
            }

        }


        btnPick?.addEventListener('click', () => {
            if (!input?.value) {
                alert('時刻を選択してください');
                return;
            }
            runWithEnd(new Date(input.value), '選択時刻', btnPick);
        });


        btnNew?.addEventListener('click', () => {
            const endMinus3m = new Date(Date.now() - 3 * 60 * 1000);
            runWithEnd(endMinus3m, '最新', btnNew);
        });

        // ---------- 店铺选择 UI（加载 + 全选/清空） ----------
        $id('select-all-btn')?.addEventListener('click', () => {
            document.querySelectorAll('#shops input[type=checkbox][data-shop-id]').forEach(cb => cb.checked = true);
        });
        $id('clear-all-btn')?.addEventListener('click', () => {
            document.querySelectorAll('#shops input[type=checkbox][data-shop-id]').forEach(cb => cb.checked = false);
        });
        loadShops();


        function getSelectedShopIds() {
            return Array.from(document.querySelectorAll('#shops input[type="checkbox"]:checked'))
                .map(cb => (cb.dataset.shopId || cb.value))
                .filter(Boolean)
                .map(String); // 统一为字符串以匹配 Map 的 key
        }

        function forEachTable(cb) {
            $qa('.model-section table').forEach(table => cb(table));
        }

        function buildShopHeaderIndexMap(table) {
            const headers = $qa('.shop-col', table.tHead || table); // 店铺列 th（表头）
            let refTr = null, max = 0;
            $qa('tbody tr', table).forEach(tr => {
                const count = tr.querySelectorAll('td[data-shop-id]').length;
                if (count > max) {
                    max = count;
                    refTr = tr;
                }
            });

            const map = new Map();
            if (refTr && headers.length) {
                const shopCells = $qa('td[data-shop-id]', refTr);
                shopCells.forEach((td, i) => map.set(String(td.getAttribute('data-shop-id')), i));
            }
            return {map, headers};
        }

        function hideSelectedShopColumns(shopIds) {
            if (!shopIds.length) return;
            forEachTable(table => {
                const {map, headers} = buildShopHeaderIndexMap(table);
                shopIds.forEach(id => {
                    // 隐藏所有数据格
                    $qa(`tbody td[data-shop-id="${id}"]`, table).forEach(td => td.classList.add('is-hidden'));
                    // 隐藏对应表头
                    const idx = map.get(String(id));
                    if (idx != null && headers[idx]) headers[idx].classList.add('is-hidden');
                });
            });
        }

        function replaceSelectedShopTexts(shopIds, text = '※要問') {
            if (!shopIds.length) return;
            forEachTable(table => {
                shopIds.forEach(id => {
                    $qa(`tbody td[data-shop-id="${id}"]`, table).forEach(td => {
                        if (!td.dataset.origText) td.dataset.origText = td.textContent.trim();
                        td.textContent = text;
                    });
                });
            });
        }

        function showSelectedShopColumns(shopIds) {
            if (!shopIds.length) return;
            forEachTable(table => {
                const {map, headers} = buildShopHeaderIndexMap(table);
                shopIds.forEach(id => {
                    // 1) 还原所有数据格（兼容服务器ID + 本地ID）
                    const sel = shopCellSelectorsFor(id); // 你之前补过的双查选择器
                    const tds = sel ? table.querySelectorAll(sel) : [];
                    tds.forEach(td => td.classList.remove('is-hidden'));

                    // 2) 还原对应表头（优先服务器ID，找不到再试本地ID）
                    const mapped = serverToMatchShop(Number(id));
                    const idx = map.get(String(id)) ?? map.get(String(mapped));
                    if (idx != null && headers[idx]) headers[idx].classList.remove('is-hidden');
                });
            });
        }

        function restoreSelectedShopTexts(shopIds) {
            if (!shopIds.length) return;
            forEachTable(table => {
                shopIds.forEach(id => {
                    const sel = shopCellSelectorsFor(id);
                    const tds = sel ? table.querySelectorAll(sel) : [];
                    tds.forEach(td => {
                        if (td.dataset.origText != null) {
                            td.textContent = td.dataset.origText;
                            delete td.dataset.origText;
                        }
                    });
                });
            });
        }


        $id('do-not-display')?.addEventListener('click', () => {
            const ids = getSelectedShopIds();
            hideSelectedShopColumns(ids);
        });
        $id('replace-text')?.addEventListener('click', () => {
            const ids = getSelectedShopIds();
            replaceSelectedShopTexts(ids, '※要問');
        });
        $id('display-again')?.addEventListener('click', () => {
            const ids = getSelectedShopIds();
            showSelectedShopColumns(ids);
        });
        $id('display-text')?.addEventListener('click', () => {
            const ids = getSelectedShopIds();
            restoreSelectedShopTexts(ids);
        });

        if (typeof window.shopCellSelectorsFor !== 'function') {
            window.shopCellSelectorsFor = function shopCellSelectorsFor(id) {
                return `tbody td[data-shop-id="${String(id)}"]`;
            };
        }

        function bindButton(id, handler) {
            const btn = $id(id);
            if (!btn) {
                console.warn(`[PSTA] button #${id} not found`);
                return;
            }
            btn.addEventListener('click', () => {
                {#console.log(`[PSTA] #${id} clicked`);#}
                if (typeof getSelectedShopIds !== 'function') {
                    console.error('[PSTA] getSelectedShopIds() not found');
                    return;
                }
                const ids = getSelectedShopIds().map(String);
                if (!ids.length) {
                    alert('店舗を選択してください');
                    return;
                }
                if (typeof handler !== 'function') {
                    console.error(`[PSTA] handler for #${id} is not a function`);
                    return;
                }
                handler(ids);
            });
        }

        (function onReady(fn) {
            if (document.readyState === 'complete' || document.readyState === 'interactive') {
                setTimeout(fn, 0);
            } else {
                document.addEventListener('DOMContentLoaded', fn);
            }
        })(() => {
            bindButton('display-again', typeof showSelectedShopColumns === 'function' ? showSelectedShopColumns : null);
            bindButton('display-text', typeof restoreSelectedShopTexts === 'function' ? restoreSelectedShopTexts : null);
            bindButton('do-not-display', typeof hideSelectedShopColumns === 'function' ? hideSelectedShopColumns : null);
            bindButton('replace-text', typeof replaceSelectedShopTexts === 'function' ? replaceSelectedShopTexts : null);
        });
    })();
</script>

<script>
    (() => {
        const btn = document.getElementById('clear-'); // 文件中图片保存按钮
        if (!btn) return console.warn('按钮 #clear- 未找到');

        // helper: 下载 blob 为文件
        function downloadBlob(blob, filename) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            a.remove();
            URL.revokeObjectURL(url);
        }

        // 隐藏选择器：clone 的时候我们会隐藏这些不想导出的节点（按钮等）
        const HIDE_SELECTOR_INSIDE_CARD = 'button, input, select, textarea, .btns, .ghost';

        btn.addEventListener('click', async () => {
            try {
                const orig = document.querySelector('.card');
                if (!orig) return alert('未找到 .card 区块');

                // 等 webfont 加载（若无则立即返回）
                if (document.fonts && document.fonts.ready) {
                    await document.fonts.ready;
                }

                // 克隆 .card 到一个离屏容器，确保样式从 <head> 生效且原节点不被影响
                const wrapper = document.createElement('div');
                Object.assign(wrapper.style, {
                    position: 'fixed',
                    left: '-9999px',
                    top: '0',
                    // 确保宽度足够（使用原始元素 scrollWidth）
                    width: orig.scrollWidth + 'px',
                    height: 'auto',
                    overflow: 'visible',
                    background: 'transparent',
                    zIndex: 99999
                });
                const clone = orig.cloneNode(true);
                // 隐藏不想出现在图片里的控件（克隆内部）
                clone.querySelectorAll(HIDE_SELECTOR_INSIDE_CARD).forEach(el => {
                    // 不能直接 remove，使用 visibility/opacity 保留布局（若想完全去除可使用 el.remove()）
                    el.style.visibility = 'hidden';
                });

                wrapper.appendChild(clone);
                document.body.appendChild(wrapper);

                // 计算正确宽高（包含克隆后的实际渲染尺寸）
                const rect = clone.getBoundingClientRect();
                const outputWidth = Math.ceil(rect.width);
                const outputHeight = Math.ceil(rect.height);

                // html2canvas 配置：提高 scale 获得更清晰的图片
                // 使用 devicePixelRatio * 1.5 或 2 以兼顾清晰度与性能
                const DPR = window.devicePixelRatio || 1;
                const scale = Math.max(2.5, Math.min(1.5, DPR * 1.5));

                const canvas = await html2canvas(clone, {
                    backgroundColor: null, // 保持透明背景时设为 null；若要白底改为 '#fff'
                    useCORS: true,         // 尝试加载跨域图片（图片服务器需允许 CORS）
                    scale: scale,
                    width: outputWidth,
                    height: outputHeight,
                    windowWidth: document.documentElement.clientWidth,
                    windowHeight: document.documentElement.clientHeight,
                    scrollX: -window.scrollX,
                    scrollY: -window.scrollY,
                    allowTaint: false,
                    imageTimeout: 20000
                });

                // 导出为 PNG（可改为 'image/jpeg'）
                canvas.toBlob(blob => {
                    downloadBlob(blob, 'price_matrix_card.png');
                }, 'image/png');

                // 清理临时 DOM（稍微延迟，确保下载已启动）
                setTimeout(() => {
                    wrapper.remove();
                }, 1000);

            } catch (err) {
                console.error('画像保存 エラー:', err);
                alert('画像保存に失敗しました。コンソールを確認してください。');
            }
        });


        // Helper: Generate image from .card element
        async function generateImage() {
            try {
                const orig = document.querySelector('.card');
                if (!orig) throw new Error('未找到 .card 区块');

                // Wait for webfonts to load (if any)
                if (document.fonts && document.fonts.ready) {
                    await document.fonts.ready;
                }

                // Clone .card to an off-screen container
                const wrapper = document.createElement('div');
                Object.assign(wrapper.style, {
                    position: 'fixed',
                    left: '-9999px',
                    top: '0',
                    width: orig.scrollWidth + 'px',
                    height: 'auto',
                    overflow: 'visible',
                    background: 'transparent',
                    zIndex: 99999
                });
                const clone = orig.cloneNode(true);
                // Hide unwanted elements in the cloned node
                const HIDE_SELECTOR_INSIDE_CARD = 'button, input, select, textarea, .btns, .ghost';
                clone.querySelectorAll(HIDE_SELECTOR_INSIDE_CARD).forEach(el => {
                    el.style.visibility = 'hidden';
                });

                wrapper.appendChild(clone);
                document.body.appendChild(wrapper);

                // Calculate dimensions
                const rect = clone.getBoundingClientRect();
                const outputWidth = Math.ceil(rect.width);
                const outputHeight = Math.ceil(rect.height);

                // html2canvas configuration
                const DPR = window.devicePixelRatio || 1;
                const scale = Math.max(2.5, Math.min(1.5, DPR * 1.5));
                const canvas = await html2canvas(clone, {
                    backgroundColor: null,
                    useCORS: true,
                    scale: scale,
                    width: outputWidth,
                    height: outputHeight,
                    windowWidth: document.documentElement.clientWidth,
                    windowHeight: document.documentElement.clientHeight,
                    scrollX: -window.scrollX,
                    scrollY: -window.scrollY,
                    allowTaint: false,
                    imageTimeout: 20000
                });

                // Clean up
                setTimeout(() => {
                    wrapper.remove();
                }, 1000);

                return canvas;
            } catch (err) {
                console.error('画像生成 エラー:', err);
                alert('画像生成に失敗しました。コンソールを確認してください。');
                throw err;
            }
        }

        // X API Credentials (REPLACE WITH YOUR ACTUAL VALUES FOR LOCAL TESTING ONLY)
        const API_KEY = 'f6TZcRNfbrSzOJBNwP9IUzRXm'; // Consumer Key
        const API_SECRET = 'JuGx8QPYfm15OEQW6u1GmmNCHL7jYaSyB5YhZyF6yQDzk6GUXq'; // Consumer Secret
        const ACCESS_TOKEN = '729569330145304577-U166soQlEk9mvDoL3O1LgdbV7VE6Qr9'; // Access Token
        const ACCESS_SECRET = 'kRDM9icdYKzbsT2BPCdJDkGOr3efjTNaxX4IFR35X6g2D'; // Access Token Secret
// OAuth 1.0a Helper Functions
        function generateNonce() {
            return Math.random().toString(36).substring(2, 15);
        }

        function generateTimestamp() {
            return Math.floor(Date.now() / 1000).toString();
        }

        function encodeRFC3986(str) {
            return encodeURIComponent(str).replace(/[!'()*]/g, c => {
                return '%' + c.charCodeAt(0).toString(16).toUpperCase();
            });
        }

        function getSignatureBaseString(method, url, params, oauthParams) {
            const allParams = {...oauthParams, ...params};
            const sortedParams = Object.keys(allParams)
                .sort()
                .map(key => `${encodeRFC3986(key)}=${encodeRFC3986(allParams[key])}`)
                .join('&');
            return `${method.toUpperCase()}&${encodeRFC3986(url)}&${encodeRFC3986(sortedParams)}`;
        }

        function hmacSHA1(key, data) {
            const crypto = window.crypto || window.msCrypto;
            if (!crypto.subtle) throw new Error('Crypto API not supported');
            return crypto.subtle.importKey('raw', new TextEncoder().encode(key), {
                name: 'HMAC',
                hash: 'SHA-1'
            }, false, ['sign'])
                .then(keyObj => crypto.subtle.sign('HMAC', keyObj, new TextEncoder().encode(data)))
                .then(signature => btoa(String.fromCharCode(...new Uint8Array(signature)))
                    .replace(/\+/g, '-').replace(/\//g, '_').replace(/=/g, ''));
        }

        async function generateOAuthHeader(method, url, params = {}) {
            const oauthParams = {
                oauth_consumer_key: API_KEY,
                oauth_nonce: generateNonce(),
                oauth_signature_method: 'HMAC-SHA1',
                oauth_timestamp: generateTimestamp(),
                oauth_token: ACCESS_TOKEN,
                oauth_version: '1.0'
            };

            const signingKey = `${encodeRFC3986(API_SECRET)}&${encodeRFC3986(ACCESS_SECRET)}`;
            const baseString = getSignatureBaseString(method, url, params, oauthParams);

            const signature = await hmacSHA1(signingKey, baseString);
            oauthParams.oauth_signature = signature;

            const headerParts = Object.keys(oauthParams)
                .sort()
                .map(key => `${encodeRFC3986(key)}="${encodeRFC3986(oauthParams[key])}"`)
                .join(', ');
            return `OAuth ${headerParts}`;
        }

        // Helper: Make authenticated X API request
        async function xApiRequest(method, endpoint, bodyParams = {}, headers = {}) {
            if (!API_KEY || API_KEY === 'YOUR_API_KEY') {
                throw new Error('Please replace API credentials with your actual values');
            }

            const url = `https://api.twitter.com/1.1/${endpoint}`;
            const authHeader = await generateOAuthHeader(method, url, bodyParams);

            const formData = new URLSearchParams(bodyParams).toString();
            const response = await fetch(url, {
                method,
                headers: {
                    'Authorization': authHeader,
                    'Content-Type': 'application/x-www-form-urlencoded',
                    ...headers
                },
                body: method !== 'GET' ? formData : undefined
            });

            if (!response.ok) {
                const errText = await response.text();
                throw new Error(`X API Error ${response.status}: ${errText}`);
            }

            return response.json();
        }

        // Save image button
        const saveBtn = document.getElementById('clear-');
        if (saveBtn) {
            saveBtn.addEventListener('click', async () => {
                try {
                    const canvas = await generateImage();
                    canvas.toBlob(blob => {
                        downloadBlob(blob, 'price_matrix_card.png');
                    }, 'image/png');
                } catch (err) {
                    // Error handled in generateImage
                }
            });
        } else {
            console.warn('按钮 #clear- 未找到');
        }

// Post to X button

        function getCsrfToken() {
            console.log("csrftoken", document.cookie.split('; ').find(row => row.startsWith('csrftoken'))?.split('=')[1])
            return document.cookie.split('; ').find(row => row.startsWith('csrftoken'))?.split('=')[1];

        }

        // Post to X button
        const postBtn = document.getElementById('clear-a');
        if (postBtn) {
            postBtn.addEventListener('click', async () => {
                try {
                    const canvas = await generateImage();
                    canvas.toBlob(async (blob) => {
                        // Convert blob to base64
                        const reader = new FileReader();
                        reader.readAsDataURL(blob);
                        reader.onloadend = async () => {
                            const base64Image = reader.result.split(',')[1]; // Remove "data:image/png;base64," prefix

                            try {
                                // Send to Django backend
                                const response = await fetch('/AppleStockChecker/post-to-x/', {
                                    method: 'POST',
                                    credentials: 'same-origin',
                                    headers: {
                                        'X-CSRFToken': getCsrfToken() // Remove if @csrf_exempt is used
                                    },
                                    body: JSON.stringify({
                                        base64Image,
                                        caption: '我的数据分析可视化 #Research'
                                    })
                                });

                                const result = await response.json();
                                if (!response.ok) {
                                    throw new Error(result.error || '发布到 X 失败');
                                }

                                alert('图片已发布到 X！');
                                {#console.log('发布成功:', result);#}
                            } catch (apiErr) {
                                console.error('X发布错误:', apiErr);
                                alert('发布到 X 失败。详细: ' + apiErr.message);
                            }
                        };
                    }, 'image/png');
                } catch (err) {
                    // Error handled in generateImage
                }
            });
        } else {
            console.warn('按钮 #clear-a 未找到');
        }


    })();


</script>


</body>
</html>
