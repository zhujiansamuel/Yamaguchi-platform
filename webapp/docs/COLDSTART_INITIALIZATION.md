# FeatureSnapshot å†·å¯åŠ¨åˆå§‹åŒ–æŒ‡å—

## é—®é¢˜èƒŒæ™¯

### å¾ªç¯ä¾èµ–é—®é¢˜

æ—¶é—´åºåˆ—ç­‰é«˜çº§ç»Ÿè®¡åŠŸèƒ½éœ€è¦æŸ¥è¯¢å†å²çš„ FeatureSnapshot æ•°æ®ï¼š

```python
# æ—¶é—´åºåˆ—è®¡ç®—éœ€è¦å†å²æ•°æ®
historical_snapshots = FeatureSnapshot.objects.filter(
    bucket__gte=start_time,
    bucket__lt=end_time,
    scope=scope,
)

if historical_snapshots.count() < min_required:
    # æ•°æ®ä¸è¶³ï¼Œæ— æ³•è®¡ç®—
    return None
```

**é—®é¢˜**ï¼šå¦‚æœ FeatureSnapshot è¡¨ä¸ºç©ºï¼Œæ°¸è¿œæ— æ³•ç”Ÿæˆæ–°æ•°æ®ã€‚

### ä¸ºä»€ä¹ˆæ­£å¸¸èšåˆæ— æ³•è§£å†³

æ­£å¸¸èšåˆï¼ˆ`batch_generate_psta_same_ts`ï¼‰éœ€è¦ï¼š
1. çª—å£å†…æœ‰ `PurchasingShopTimeAnalysis` æ•°æ®
2. æŸäº›é«˜çº§ç»Ÿè®¡éœ€è¦æŸ¥è¯¢å†å² FeatureSnapshotï¼ˆå½¢æˆå¾ªç¯ä¾èµ–ï¼‰

## è§£å†³æ–¹æ¡ˆï¼šå†·å¯åŠ¨åˆå§‹åŒ–

### æ ¸å¿ƒæ€è·¯

ä½¿ç”¨**åŸå§‹æ•°æ®å€¼ç›´æ¥å¡«å……ç»Ÿè®¡æŒ‡æ ‡**ï¼Œä¸ºåç»­è®¡ç®—æä¾›åŸºç¡€æ•°æ®ï¼š

```
æ­£å¸¸èšåˆï¼ˆéœ€è¦å†å²æ•°æ®ï¼‰:
  mean = average(çª—å£å†…æ‰€æœ‰å€¼)
  std = standard_deviation(çª—å£å†…æ‰€æœ‰å€¼)
  count = çª—å£å†…æ•°æ®ç‚¹æ•°

å†·å¯åŠ¨å¡«å……ï¼ˆä¸éœ€è¦å†å²æ•°æ®ï¼‰:
  mean = åŸå§‹å€¼
  std = 0
  count = 1
```

### ç­–ç•¥

1. ä»ç»™å®šæ—¶é—´æˆ³å¼€å§‹ï¼Œ**å¾€å‰æ¨ 40 ä¸ªè¾¹ç•Œæ—¶é—´ç‚¹**ï¼ˆ15åˆ†é’Ÿé—´éš”ï¼‰
2. å¯¹æ¯ä¸ªæ—¶é—´ç‚¹ï¼ŒæŸ¥è¯¢çª—å£å†…çš„åŸå§‹æ•°æ®ï¼ˆå»é‡ï¼šæ¯ä¸ª shopÃ—iphone å–æœ€åä¸€æ¡ï¼‰
3. å°†åŸå§‹å€¼ç›´æ¥å¡«å……ä¸ºç»Ÿè®¡æŒ‡æ ‡
4. ç”Ÿæˆ 4 ç§ç»„åˆçš„ FeatureSnapshotï¼ˆshopÃ—iphone, shopcohortÃ—iphone, shopÃ—cohort, shopcohortÃ—cohortï¼‰

## ä½¿ç”¨æ–¹æ³•

### è‡ªåŠ¨æ¨¡å¼ï¼ˆæ¨èï¼‰

```bash
# ä»æœ€è¿‘çš„è¾¹ç•Œæ—¶é—´å¼€å§‹ï¼Œå¾€å‰å¡«å…… 40 ä¸ªæ—¶é—´ç‚¹
scripts/coldstart_feature_snapshot.sh --auto
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
è‡ªåŠ¨é€‰æ‹©èµ·å§‹æ—¶é—´: 2025-10-04T01:00:00+00:00

======================================================================
FeatureSnapshot å†·å¯åŠ¨åˆå§‹åŒ–
======================================================================
èµ·å§‹æ—¶é—´: 2025-10-04T01:00:00+00:00
æ—¶é—´ç‚¹æ•°é‡: 40
æ–¹å‘: å¾€å‰æ¨ï¼ˆæœ€æ–° â†’ æœ€æ—§ï¼‰
é—´éš”: 15 åˆ†é’Ÿ
æ—¶é—´èŒƒå›´: 2025-10-03T15:15:00+00:00 â†’ 2025-10-04T01:00:00+00:00
======================================================================

[1/40] å¤„ç† bucket: 2025-10-04T01:00:00+00:00
  çª—å£: 2025-10-04T01:00:00+00:00 â†’ 2025-10-04T01:15:00+00:00
  ğŸ“Š æ‰¾åˆ° 120 ä¸ª shopÃ—iphone ç»„åˆ
  âœ… ç”Ÿæˆ 1680 æ¡ FeatureSnapshot è®°å½•
     Case1: 120, Case2: 8, Case3: 15, Case4: 1

[2/40] å¤„ç† bucket: 2025-10-04T00:45:00+00:00
  ...

======================================================================
å†·å¯åŠ¨å®Œæˆ
======================================================================
æˆåŠŸ: 40
è·³è¿‡: 0
ç”Ÿæˆçš„ FeatureSnapshot è®°å½•æ€»æ•°: 67200

å„ Case ç»Ÿè®¡:
  Case1 (shopÃ—iphone): 4800
  Case2 (shopcohortÃ—iphone): 320
  Case3 (shopÃ—cohort): 600
  Case4 (shopcohortÃ—cohort): 40
```

### æŒ‡å®šæ—¶é—´èŒƒå›´

```bash
# ä»æŒ‡å®šæ—¶é—´å¼€å§‹ï¼Œå¾€å‰å¡«å…… 40 ä¸ªæ—¶é—´ç‚¹
scripts/coldstart_feature_snapshot.sh \
  --start "2025-10-04T01:00:00+00:00" \
  --count 40

# å¡«å…… 100 ä¸ªæ—¶é—´ç‚¹
scripts/coldstart_feature_snapshot.sh \
  --start "2025-10-04T01:00:00+00:00" \
  --count 100
```

### æ¼”ä¹ æ¨¡å¼

```bash
# æŸ¥çœ‹å°†è¦å¤„ç†çš„æ—¶é—´ç‚¹ï¼Œä¸å®é™…åˆ›å»ºæ•°æ®
scripts/coldstart_feature_snapshot.sh --auto --dry-run
```

### æ£€æŸ¥çŠ¶æ€

```bash
# æ£€æŸ¥å½“å‰ FeatureSnapshot è¡¨çŠ¶æ€
scripts/coldstart_feature_snapshot.sh --check-only
```

## æ•°æ®å¡«å……ç­–ç•¥

### å•ä¸ªåŸå§‹å€¼ â†’ ç»Ÿè®¡æŒ‡æ ‡

å¯¹äºæ¯ä¸ª shopÃ—iphone ç»„åˆï¼Œå¦‚æœçª—å£å†…æœ‰åŸå§‹æ•°æ®ï¼š

```python
åŸå§‹æ•°æ®: shop=1, iphone=5, price=5699.0

å¡«å……çš„ç»Ÿè®¡æŒ‡æ ‡:
  mean: 5699.0      # ç­‰äºåŸå§‹å€¼
  median: 5699.0    # ç­‰äºåŸå§‹å€¼
  std: 0.0          # æ ‡å‡†å·®ä¸º 0ï¼ˆåªæœ‰ä¸€ä¸ªå€¼ï¼‰
  min: 5699.0       # ç­‰äºåŸå§‹å€¼
  max: 5699.0       # ç­‰äºåŸå§‹å€¼
  count: 1.0        # æ•°æ®ç‚¹æ•°ä¸º 1
  dispersion: 0.0   # ç¦»æ•£åº¦ä¸º 0
  range: 0.0        # èŒƒå›´ä¸º 0
  q25: 5699.0       # å››åˆ†ä½æ•°ç­‰äºåŸå§‹å€¼
  q75: 5699.0
  iqr: 0.0          # å››åˆ†ä½è·ä¸º 0
  cv: 0.0           # å˜å¼‚ç³»æ•°ä¸º 0
  skew: 0.0         # ååº¦ä¸º 0
  kurtosis: 0.0     # å³°åº¦ä¸º 0
```

### å»é‡ç­–ç•¥

çª—å£å†…å¦‚æœæœ‰å¤šæ¡æ•°æ®ï¼ˆåŒä¸€ shopÃ—iphoneï¼‰ï¼Œ**å–æœ€åä¸€æ¡**ï¼ˆæœ€æ–°ï¼‰ï¼š

```sql
SELECT DISTINCT ON (shop_id, iphone_id)
  shop_id, iphone_id, New_Product_Price
FROM PurchasingShopTimeAnalysis
WHERE Timestamp_Time >= bucket_start
  AND Timestamp_Time < bucket_end
ORDER BY shop_id, iphone_id, Timestamp_Time DESC
```

### åŠ æƒå¹³å‡ï¼ˆç»„åˆ Caseï¼‰

**Case 2: shopcohort Ã— iphone**

```python
# åº—é“ºç»„åˆ Ã— å•ä¸ªæœºå‹
shops_in = [1, 2, 3]  # ç»„åˆå†…çš„åº—é“º
weights = {1: 1.0, 2: 1.5, 3: 0.8}  # åº—é“ºæƒé‡

prices = {1: 5699.0, 2: 5799.0, 3: 5650.0}

weighted_avg = (1.0*5699 + 1.5*5799 + 0.8*5650) / (1.0 + 1.5 + 0.8)
            = 5725.15
```

**Case 3: shop Ã— cohort**

```python
# å•ä¸ªåº—é“º Ã— æœºå‹ç»„åˆ
iphones_in = [5, 6, 7]  # ç»„åˆå†…çš„æœºå‹
weights = {5: 1.0, 6: 0.9, 7: 1.1}  # æœºå‹æƒé‡

prices = {5: 5699.0, 6: 6299.0, 7: 7299.0}

weighted_avg = (1.0*5699 + 0.9*6299 + 1.1*7299) / (1.0 + 0.9 + 1.1)
            = 6380.97
```

**Case 4: shopcohort Ã— cohort**

```python
# åº—é“ºç»„åˆ Ã— æœºå‹ç»„åˆï¼ˆåŒé‡åŠ æƒï¼‰
weighted_avg = sum(w_shop * w_iphone * price) / sum(w_shop * w_iphone)
```

## ç”Ÿæˆçš„æ•°æ®ç‰¹å¾

### is_final æ ‡è®°

æ‰€æœ‰å†·å¯åŠ¨æ•°æ®æ ‡è®°ä¸º `is_final=True`ï¼Œè¡¨ç¤ºè¿™æ˜¯"ç¨³å®š"æ•°æ®ã€‚

### version

ä½¿ç”¨ `version="v1"`ã€‚

### scope æ ¼å¼

- `shop:1|iphone:5`
- `shopcohort:beijing|iphone:5`
- `shop:1|cohort:iphone-14-pro-max`
- `shopcohort:beijing|cohort:iphone-14-pro-max`

## ä¸æ­£å¸¸èšåˆçš„å¯¹æ¯”

| ç‰¹æ€§ | å†·å¯åŠ¨åˆå§‹åŒ– | æ­£å¸¸èšåˆ |
|------|-------------|----------|
| æ•°æ®æ¥æº | åŸå§‹ PSTA æ•°æ® | åŸå§‹ PSTA æ•°æ® |
| ç»Ÿè®¡æ–¹æ³• | å•å€¼å¡«å…… | å®Œæ•´ç»Ÿè®¡è®¡ç®— |
| å†å²ä¾èµ– | âŒ ä¸éœ€è¦ | âœ… æŸäº›åŠŸèƒ½éœ€è¦ |
| æ•°æ®å‡†ç¡®æ€§ | âš ï¸ ç®€åŒ–ï¼ˆå•å€¼ï¼‰ | âœ… å®Œæ•´ç»Ÿè®¡ |
| ç”¨é€” | å†·å¯åŠ¨ã€æä¾›åŸºç¡€æ•°æ® | æ­£å¸¸è¿è¡Œ |
| std/dispersion | æ€»æ˜¯ 0 | æ ¹æ®å®é™…æ•°æ®è®¡ç®— |
| count | æ€»æ˜¯ 1 | çª—å£å†…å®é™…æ•°æ®ç‚¹æ•° |

## ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: FeatureSnapshot è¡¨ä¸ºç©º

```bash
# 1. æ£€æŸ¥çŠ¶æ€
scripts/coldstart_feature_snapshot.sh --check-only

# è¾“å‡ºï¼šè¡¨ä¸ºç©ºï¼Œå»ºè®®æ‰§è¡Œå†·å¯åŠ¨åˆå§‹åŒ–

# 2. æ‰§è¡Œå†·å¯åŠ¨ï¼ˆå¡«å…… 40 ä¸ªæ—¶é—´ç‚¹ï¼‰
scripts/coldstart_feature_snapshot.sh --auto

# 3. ä¹‹åå¯ä»¥æ‰§è¡Œæ­£å¸¸èšåˆ
# æ­£å¸¸èšåˆä¼šç”Ÿæˆæ›´å‡†ç¡®çš„ç»Ÿè®¡æ•°æ®ï¼Œé€æ­¥æ›¿æ¢å†·å¯åŠ¨æ•°æ®
```

### åœºæ™¯ 2: æ—¶é—´åºåˆ—éœ€è¦æ›´å¤šå†å²æ•°æ®

```bash
# å½“å‰æœ‰ 10 ä¸ªæ—¶é—´ç‚¹çš„æ•°æ®ï¼Œä½†æ—¶é—´åºåˆ—éœ€è¦ 40 ä¸ª
# å¾€å‰å¡«å…… 30 ä¸ªæ—¶é—´ç‚¹

# æŸ¥è¯¢å½“å‰æœ€æ—©çš„ bucket
# å‡è®¾æ˜¯ 2025-10-04T01:00:00+00:00

# ä»æœ€æ—© bucket å¼€å§‹ï¼Œå¾€å‰å¡«å…… 30 ä¸ª
scripts/coldstart_feature_snapshot.sh \
  --start "2025-10-04T01:00:00+00:00" \
  --count 30
```

### åœºæ™¯ 3: è¡¥å……ç‰¹å®šæ—¶é—´æ®µçš„æ•°æ®

```bash
# æŸä¸ªæ—¶é—´æ®µçš„æ•°æ®ç¼ºå¤±
# ä» 2025-10-03T20:00:00 å¼€å§‹ï¼Œå¾€å‰å¡«å…… 20 ä¸ªæ—¶é—´ç‚¹

scripts/coldstart_feature_snapshot.sh \
  --start "2025-10-03T20:00:00+00:00" \
  --count 20
```

## æ•°æ®éªŒè¯

### éªŒè¯ç”Ÿæˆçš„æ•°æ®

```bash
# ä½¿ç”¨éªŒè¯è„šæœ¬
scripts/verify_feature_snapshot.sh \
  --start "2025-10-03T15:15:00+00:00" \
  --end "2025-10-04T01:00:00+00:00" \
  --verbose
```

### æ£€æŸ¥æ•°æ®ç‰¹å¾

```python
from AppleStockChecker.models import FeatureSnapshot
from datetime import datetime, timezone

# æŸ¥è¯¢å†·å¯åŠ¨ç”Ÿæˆçš„æ•°æ®
bucket = datetime(2025, 10, 4, 1, 0, 0, tzinfo=timezone.utc)
snapshots = FeatureSnapshot.objects.filter(bucket=bucket)

# å†·å¯åŠ¨æ•°æ®çš„ç‰¹å¾
for snap in snapshots.filter(name='std')[:5]:
    print(f"{snap.scope}: std={snap.value}")
    # åº”è¯¥éƒ½æ˜¯ 0.0ï¼ˆå†·å¯åŠ¨ç‰¹å¾ï¼‰

for snap in snapshots.filter(name='count')[:5]:
    print(f"{snap.scope}: count={snap.value}")
    # åº”è¯¥éƒ½æ˜¯ 1.0ï¼ˆå†·å¯åŠ¨ç‰¹å¾ï¼‰
```

### é¢„æœŸç»“æœ

å†·å¯åŠ¨æ•°æ®ç‰¹å¾ï¼š
- âœ… `std` æ€»æ˜¯ 0.0
- âœ… `count` æ€»æ˜¯ 1.0
- âœ… `mean == median == min == max`
- âœ… `dispersion == range == iqr == 0`
- âœ… `is_final` æ€»æ˜¯ True

## æ•°æ®æ¼”è¿›ç­–ç•¥

### ç¬¬ä¸€é˜¶æ®µï¼šå†·å¯åŠ¨ï¼ˆæ‰‹åŠ¨ï¼‰

```bash
# å¡«å……åˆå§‹ 40 ä¸ªæ—¶é—´ç‚¹
scripts/coldstart_feature_snapshot.sh --auto
```

ç”Ÿæˆç®€åŒ–æ•°æ®ï¼š
- std = 0
- count = 1
- æä¾›åŸºç¡€æ•°æ®ä¾›æ—¶é—´åºåˆ—ä½¿ç”¨

### ç¬¬äºŒé˜¶æ®µï¼šæ­£å¸¸èšåˆï¼ˆè‡ªåŠ¨ï¼‰

```bash
# å‘¨æœŸä»»åŠ¡æ¯åˆ†é’Ÿè¿è¡Œï¼Œåœ¨è¾¹ç•Œæ—¶é—´èšåˆ
# ç”Ÿæˆå‡†ç¡®çš„ç»Ÿè®¡æ•°æ®
```

ç”Ÿæˆå‡†ç¡®æ•°æ®ï¼š
- std = å®é™…æ ‡å‡†å·®
- count = çª—å£å†…å®é™…æ•°æ®ç‚¹æ•°
- é€æ­¥è¦†ç›–å†·å¯åŠ¨æ•°æ®

### æ•°æ®è¦†ç›–ç­–ç•¥

**FeatureSnapshot çš„ LWWï¼ˆLast Write Winsï¼‰ç­–ç•¥**ï¼š

```python
# å¦‚æœ (bucket, scope, name, version) ç›¸åŒ
# åå†™å…¥çš„æ•°æ®è¦†ç›–å…ˆå†™å…¥çš„æ•°æ®

å†·å¯åŠ¨å†™å…¥: (bucket=05:00, scope="shop:1|iphone:5", name="mean", value=5699.0)
æ­£å¸¸èšåˆå†™å…¥: (bucket=05:00, scope="shop:1|iphone:5", name="mean", value=5720.5)

ç»“æœï¼šæ­£å¸¸èšåˆçš„å€¼è¦†ç›–å†·å¯åŠ¨çš„å€¼ âœ…
```

## ä¸å…¶ä»–åˆå§‹åŒ–æ–¹å¼å¯¹æ¯”

### æ–¹å¼ 1: å†·å¯åŠ¨åˆå§‹åŒ–ï¼ˆæœ¬è„šæœ¬ï¼‰

```bash
scripts/coldstart_feature_snapshot.sh --auto
```

**ä¼˜ç‚¹**ï¼š
- âœ… ä¸ä¾èµ–å†å² FeatureSnapshot
- âœ… å¿«é€Ÿå¡«å……åŸºç¡€æ•°æ®
- âœ… ä¸ºæ—¶é—´åºåˆ—æä¾›è¶³å¤Ÿçš„å†å²ç‚¹

**ç¼ºç‚¹**ï¼š
- âš ï¸ æ•°æ®ç®€åŒ–ï¼ˆstd=0, count=1ï¼‰
- âš ï¸ éœ€è¦åç»­æ­£å¸¸èšåˆé€æ­¥æ›¿æ¢

**é€‚ç”¨åœºæ™¯**ï¼š
- FeatureSnapshot è¡¨ä¸ºç©º
- éœ€è¦å¿«é€Ÿå¯åŠ¨æ—¶é—´åºåˆ—åŠŸèƒ½
- å†å²æ•°æ®è¡¥å……

### æ–¹å¼ 2: æ­£å¸¸èšåˆåˆå§‹åŒ–

```bash
scripts/initialize_feature_snapshot.sh --auto
```

**ä¼˜ç‚¹**ï¼š
- âœ… ç”Ÿæˆå‡†ç¡®çš„ç»Ÿè®¡æ•°æ®
- âœ… å®Œæ•´çš„èšåˆé€»è¾‘

**ç¼ºç‚¹**ï¼š
- âŒ å¯èƒ½å› ä¸ºç¼ºå°‘å†å²æ•°æ®å¤±è´¥ï¼ˆå¾ªç¯ä¾èµ–ï¼‰
- âš ï¸ é€Ÿåº¦è¾ƒæ…¢ï¼ˆå®Œæ•´èšåˆè®¡ç®—ï¼‰

**é€‚ç”¨åœºæ™¯**ï¼š
- å·²æœ‰åŸºç¡€æ•°æ®ï¼ˆå†·å¯åŠ¨åï¼‰
- æ­£å¸¸è¿è¡Œæ—¶çš„å†å²æ•°æ®è¡¥å……

### æ¨èç»„åˆä½¿ç”¨

```bash
# 1. å†·å¯åŠ¨ï¼šå¿«é€Ÿå¡«å…… 40 ä¸ªåŸºç¡€æ•°æ®ç‚¹
scripts/coldstart_feature_snapshot.sh --auto

# 2. æ­£å¸¸èšåˆï¼šä»å½“å‰æ—¶é—´å¼€å§‹ï¼Œæ¯15åˆ†é’Ÿè‡ªåŠ¨èšåˆï¼ˆå‘¨æœŸä»»åŠ¡ï¼‰
# Celery Beat è‡ªåŠ¨è¿è¡Œ batch_generate_psta_same_ts

# 3. å†å²è¡¥å……ï¼šè¡¥å……å†·å¯åŠ¨ä¹‹å‰çš„æ•°æ®
scripts/initialize_feature_snapshot.sh \
  --start "2025-10-01T00:00:00+00:00" \
  --end "2025-10-03T15:00:00+00:00"
```

## å¸¸è§é—®é¢˜

### Q1: å†·å¯åŠ¨æ•°æ®ä¼šè¢«è¦†ç›–å—ï¼Ÿ

**ä¼š**ã€‚æ­£å¸¸èšåˆä¼šè¦†ç›–ç›¸åŒ (bucket, scope, name, version) çš„æ•°æ®ã€‚

```
å†·å¯åŠ¨ç”Ÿæˆ: bucket=05:00, mean=5699.0, std=0.0, count=1.0
æ­£å¸¸èšåˆç”Ÿæˆ: bucket=05:00, mean=5720.5, std=45.2, count=12.0

ç»“æœï¼šæ­£å¸¸èšåˆçš„å‡†ç¡®æ•°æ®è¦†ç›–å†·å¯åŠ¨çš„ç®€åŒ–æ•°æ® âœ…
```

### Q2: ä¸ºä»€ä¹ˆæ˜¯ 40 ä¸ªæ—¶é—´ç‚¹ï¼Ÿ

**ç»éªŒå€¼**ã€‚40 ä¸ªæ—¶é—´ç‚¹ï¼ˆ15åˆ†é’Ÿé—´éš”ï¼‰= 10 å°æ—¶å†å²æ•°æ®ï¼š
- è¶³å¤Ÿæ—¶é—´åºåˆ—è®¡ç®—ï¼ˆé€šå¸¸éœ€è¦ 20-30 ä¸ªç‚¹ï¼‰
- ä¸ä¼šè¿‡åº¦å ç”¨æ•°æ®åº“ç©ºé—´
- å¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´ï¼ˆ`--count` å‚æ•°ï¼‰

### Q3: å†·å¯åŠ¨æ•°æ®å‡†ç¡®å—ï¼Ÿ

**ä¸å®Œå…¨å‡†ç¡®**ã€‚å†·å¯åŠ¨æ•°æ®æ˜¯ç®€åŒ–çš„ï¼š
- `std=0` è¡¨ç¤º"æ²¡æœ‰ç¦»æ•£åº¦"ï¼ˆå®é™…å¯èƒ½æœ‰ï¼‰
- `count=1` è¡¨ç¤º"åªæœ‰ä¸€ä¸ªå€¼"ï¼ˆå®é™…çª—å£å†…å¯èƒ½æœ‰å¤šä¸ªï¼‰

ä½†**è¶³å¤Ÿç”¨äºå†·å¯åŠ¨**ï¼š
- æä¾›åŸºç¡€æ•°æ®ç‚¹ä¾›æ—¶é—´åºåˆ—ä½¿ç”¨
- åç»­æ­£å¸¸èšåˆä¼šç”Ÿæˆå‡†ç¡®æ•°æ®å¹¶è¦†ç›–

### Q4: çª—å£å†…æ²¡æœ‰æ•°æ®æ€ä¹ˆåŠï¼Ÿ

**è·³è¿‡**ã€‚å¦‚æœçª—å£å†…æ²¡æœ‰ PurchasingShopTimeAnalysis æ•°æ®ï¼Œè¯¥æ—¶é—´ç‚¹ä¸ç”Ÿæˆ FeatureSnapshotã€‚

```
[5/40] å¤„ç† bucket: 2025-10-03T18:00:00+00:00
  âš ï¸  çª—å£å†…æ²¡æœ‰æ•°æ®ï¼Œè·³è¿‡
```

### Q5: å¯ä»¥é‡å¤è¿è¡Œå—ï¼Ÿ

**å¯ä»¥**ã€‚è„šæœ¬ä¼šæ£€æŸ¥æ˜¯å¦å·²æœ‰æ•°æ®ï¼š

```
[1/40] å¤„ç† bucket: 2025-10-04T01:00:00+00:00
  â­ï¸  å·²æœ‰ 1680 æ¡è®°å½•ï¼Œè·³è¿‡
```

å·²æœ‰æ•°æ®çš„æ—¶é—´ç‚¹ä¼šè¢«è·³è¿‡ï¼Œä¸ä¼šé‡å¤åˆ›å»ºã€‚

### Q6: æ‰§è¡Œæ—¶é—´å¤šä¹…ï¼Ÿ

**å–å†³äºæ•°æ®é‡**ï¼š
- 40 ä¸ªæ—¶é—´ç‚¹ï¼Œæ¯ä¸ªçª—å£ 100-200 æ¡åŸå§‹æ•°æ®ï¼š1-3 åˆ†é’Ÿ
- 100 ä¸ªæ—¶é—´ç‚¹ï¼š3-10 åˆ†é’Ÿ
- ä½¿ç”¨ `bulk_create` æ‰¹é‡æ’å…¥ï¼Œæ€§èƒ½è¾ƒå¥½

## æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: ç”Ÿæˆçš„è®°å½•æ•°ä¸º 0

```
âœ… ç”Ÿæˆ 0 æ¡ FeatureSnapshot è®°å½•
```

**åŸå› **ï¼šçª—å£å†…æ²¡æœ‰æ•°æ®æˆ–æ‰€æœ‰æ•°æ®è¢«è¿‡æ»¤ã€‚

**æ£€æŸ¥**ï¼š
```python
from AppleStockChecker.models import PurchasingShopTimeAnalysis
from datetime import datetime, timezone

start = datetime(2025, 10, 4, 1, 0, 0, tzinfo=timezone.utc)
end = datetime(2025, 10, 4, 1, 15, 0, tzinfo=timezone.utc)

count = PurchasingShopTimeAnalysis.objects.filter(
    Timestamp_Time__gte=start,
    Timestamp_Time__lt=end,
    New_Product_Price__isnull=False,
).count()

print(f"çª—å£å†…æ•°æ®: {count} æ¡")
```

### é—®é¢˜ 2: Case2-4 ä¸º 0

```
Case1: 120, Case2: 0, Case3: 0, Case4: 0
```

**åŸå› **ï¼šç¼ºå°‘ ShopWeightProfile æˆ– Cohort é…ç½®ã€‚

**æ£€æŸ¥**ï¼š
```python
from AppleStockChecker.models import ShopWeightProfile, Cohort

print(f"ShopWeightProfile: {ShopWeightProfile.objects.count()}")
print(f"Cohort: {Cohort.objects.count()}")
```

### é—®é¢˜ 3: Django å¯¼å…¥é”™è¯¯

```
ModuleNotFoundError: No module named 'django'
```

**è§£å†³**ï¼šåœ¨ Docker ç¯å¢ƒä¸­è¿è¡Œï¼š
```bash
docker compose exec web python scripts/coldstart_feature_snapshot.py --auto
```

æˆ–ä½¿ç”¨åŒ…è£…è„šæœ¬ï¼ˆè‡ªåŠ¨æ£€æµ‹ç¯å¢ƒï¼‰ï¼š
```bash
scripts/coldstart_feature_snapshot.sh --auto
```

## æ€»ç»“

**å†·å¯åŠ¨åˆå§‹åŒ–è„šæœ¬**é€‚åˆï¼š
- âœ… FeatureSnapshot è¡¨ä¸ºç©ºæ—¶çš„å¿«é€Ÿå¯åŠ¨
- âœ… ä¸ºæ—¶é—´åºåˆ—æä¾›åŸºç¡€å†å²æ•°æ®
- âœ… è¡¥å……ç‰¹å®šæ—¶é—´æ®µçš„æ•°æ®

**ç‰¹ç‚¹**ï¼š
- ğŸ“Š ä½¿ç”¨åŸå§‹å€¼å¡«å……ç»Ÿè®¡æŒ‡æ ‡
- ğŸš€ å¿«é€Ÿï¼ˆä¸ä¾èµ–å¤æ‚èšåˆè®¡ç®—ï¼‰
- ğŸ”„ å¯é‡å¤è¿è¡Œï¼ˆè·³è¿‡å·²æœ‰æ•°æ®ï¼‰
- âš™ï¸ åç»­å¯è¢«æ­£å¸¸èšåˆè¦†ç›–

**æ¨èå·¥ä½œæµ**ï¼š
1. å†·å¯åŠ¨å¡«å…… 40 ä¸ªåŸºç¡€æ•°æ®ç‚¹
2. å¯åŠ¨å‘¨æœŸä»»åŠ¡è¿›è¡Œæ­£å¸¸èšåˆ
3. æ­£å¸¸èšåˆé€æ­¥è¦†ç›–å†·å¯åŠ¨æ•°æ®ï¼Œæä¾›å‡†ç¡®ç»Ÿè®¡
